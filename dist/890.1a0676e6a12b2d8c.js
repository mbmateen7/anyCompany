"use strict";(self.webpackChunkhumphree=self.webpackChunkhumphree||[]).push([[890],{6890:($,C,s)=>{s.r(C),s.d(C,{HistoryModule:()=>V});var d=s(9808),h=s(6798),b=s(2212),H=s(88),t=s(6435),_=s(2340),u=s(4312),A=s(520);let U=(()=>{class i{constructor(e){this.http=e}listing(e={}){return this.http.post(`${_.N.apiUrl+u.j.historyListing}`,e)}reorder(e={}){return this.http.post(`${_.N.apiUrl+u.j.historyReorder}`,e)}downloadHistory(e={}){return this.http.post(`${_.N.apiUrl+u.j.historyDownload}`,e)}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(A.eN))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var w=s(1136),q=s(9634),D=s(629),p=s(4182),T=s(6783),m=s(5073),P=s(8601);function J(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"i-feather",35),t.NdJ("click",function(){return t.CHM(e),t.oxw().startDate=null}),t.qZA()}}function N(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"i-feather",35),t.NdJ("click",function(){return t.CHM(e),t.oxw().endDate=null}),t.qZA()}}function M(i,r){1&i&&(t.TgZ(0,"p",30),t._UZ(1,"i-feather",45),t.qZA())}function j(i,r){1&i&&(t.TgZ(0,"p",30),t._uU(1,"-"),t.qZA())}function k(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"a",43),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(),o=n.$implicit,c=n.index;return t.oxw().addJobNote(o.id,c)}),t._UZ(1,"i-feather",46),t.qZA()}}function Y(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"a",47),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(),o=n.$implicit,c=n.index;return t.oxw().addJobNote(o.id,c)}),t._uU(1," View "),t.qZA()}}function F(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div",48)(1,"div",49)(2,"a",50),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(),o=n.$implicit,c=n.index;return t.oxw().addJobNote(o.id,c)}),t._uU(3," Add Note "),t._UZ(4,"i-feather",51),t.qZA()(),t._UZ(5,"div",52),t.TgZ(6,"div",53),t._uU(7),t.ALo(8,"date"),t.qZA()()}if(2&i){const e=t.oxw().$implicit;t.xp6(5),t.Q6J("innerHtml",e.latest_job_note.description,t.oJD),t.xp6(2),t.hij(" ",t.xi3(8,2,e.latest_job_note.created_at,"h:mm a | dd LLLL, yyyy")," ")}}function I(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"a",43),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(),o=n.$implicit,c=n.index;return t.oxw().reorder(o,c)}),t._UZ(1,"i-feather",54),t.qZA()}}function O(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"tr",36)(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td")(4,"p",30),t._uU(5),t.qZA()(),t.TgZ(6,"td")(7,"p",30),t._uU(8),t.qZA()(),t.TgZ(9,"td")(10,"p",30),t._uU(11),t.qZA()(),t.TgZ(12,"td")(13,"p",30),t._uU(14),t.qZA()(),t.TgZ(15,"td")(16,"p",30),t._uU(17),t.qZA()(),t.TgZ(18,"td"),t.YNc(19,M,2,0,"p",37),t.YNc(20,j,2,0,"p",37),t.qZA(),t.TgZ(21,"td")(22,"p",30),t._uU(23),t.qZA()(),t.TgZ(24,"td")(25,"p",30),t._uU(26),t.qZA()(),t.TgZ(27,"td")(28,"p",30),t._uU(29),t.qZA()(),t.TgZ(30,"td")(31,"p",30),t._uU(32),t.qZA()(),t.TgZ(33,"td")(34,"div",38),t.YNc(35,k,2,0,"a",39),t.YNc(36,Y,2,0,"a",40),t.YNc(37,F,9,5,"div",41),t.qZA()(),t.TgZ(38,"td")(39,"div",42),t.YNc(40,I,2,0,"a",39),t.TgZ(41,"a",43),t.NdJ("click",function(){const n=t.CHM(e),o=n.$implicit,c=n.index;return t.oxw().viewTimeline(o,c)}),t._UZ(42,"img",44),t.qZA()()()()}if(2&i){const e=r.$implicit,a=t.oxw();let n,o,c,l,g,f,Z,y,v;t.xp6(2),t.Oqu(e.work_number),t.xp6(3),t.Oqu(null!==(n=e.location)&&void 0!==n?n:"-"),t.xp6(3),t.Oqu(null!==(o=e.customer.name)&&void 0!==o?o:"-"),t.xp6(3),t.Oqu(null!==(c=e.contract)&&void 0!==c?c:"-"),t.xp6(3),t.Oqu(null!==(l=e.product.title)&&void 0!==l?l:"-"),t.xp6(3),t.Oqu(null!==(g=e.status)&&void 0!==g?g:"-"),t.xp6(2),t.Q6J("ngIf",e.fsc),t.xp6(1),t.Q6J("ngIf",!e.fsc),t.xp6(3),t.Oqu(null!==(f=e.delivery)&&void 0!==f?f:"-"),t.xp6(3),t.Oqu(null!==(Z=e.order_number)&&void 0!==Z?Z:"-"),t.xp6(3),t.Oqu(null!==(y=e.invoice_no)&&void 0!==y?y:"-"),t.xp6(3),t.Oqu(null!==(v=e.schedule_ref)&&void 0!==v?v:"-"),t.xp6(3),t.Q6J("ngIf",!e.job_notes_count),t.xp6(1),t.Q6J("ngIf",e.job_notes_count),t.xp6(1),t.Q6J("ngIf",e.job_notes_count&&e.latest_job_note.description),t.xp6(3),t.Q6J("ngIf",a._auth.checkPermissions("history","write"))}}const x=function(){return{isAnimated:!0,dateInputFormat:"DD-MMM-YYYY",containerClass:"theme-red",selectFromOtherMonth:!0}},S=[{path:"",component:(()=>{class i{constructor(e,a,n,o,c,l){this._history=e,this.datePipe=a,this._modal=n,this.router=o,this.helper=c,this._auth=l,this.histories=[],this.searchParams={search:"",start_date:"",end_date:"",page_size:10,page:1},this.pageFrom=1,this.pageTo=10,this.totalCount=10,this.modalConfig={animated:!0,keyboard:!1,backdrop:!1,ignoreBackdropClick:!0,windowClass:"modal-roles"},this.dateToday=new Date}ngOnInit(){this.getHistoryListing()}getHistoryListing(){this._history.listing(this.searchParams).subscribe(e=>{this.histories=e.data.data,this.searchParams.page_size=e.data.per_page,this.searchParams.page=e.data.current_page,this.totalPages=e.data.last_page,this.pageFrom=e.data.from,this.pageTo=e.data.to,this.totalCount=e.data.total})}searchOrder(e){this.searchParams.page=1,"search"==e&&(0==this.searchParams.search.length||this.searchParams.search.length>=3)&&this.getHistoryListing(),setTimeout(()=>{"date"==e&&(this.startDate&&this.endDate||!this.startDate&&!this.endDate)&&(this.searchParams.start_date=this.startDate?this.datePipe.transform(this.startDate,"YYYY-MM-dd"):null,this.searchParams.end_date=this.endDate?this.datePipe.transform(this.endDate,"YYYY-MM-dd"):null,this.getHistoryListing())},50)}addJobNote(e,a){this.modalConfig.windowClass="modal-roles job-notes-modal";const n=this._modal.open(b._,this.modalConfig);n.componentInstance.orderId=e,n.componentInstance.response.subscribe(o=>{o.success&&!o.close&&(this.histories[a]=o.data),o.close&&(this.getHistoryListing(),n.dismiss(),this.modalConfig.windowClass="modal-roles")})}viewTimeline(e,a){this.modalConfig.windowClass="modal-roles timeline";const n=this._modal.open(H.z,this.modalConfig);n.componentInstance.rod=e,n.componentInstance.response.subscribe(o=>{o.success&&this.router.navigate(["rod/delivery-notes",e.id]),o.data&&(this.histories[a]=o.data),n.dismiss(),this.modalConfig.windowClass="modal-roles"})}changePage(e){this.searchParams.page=e,this.getHistoryListing()}ChangePageSize(e){this.searchParams.page=1,this.searchParams.page_size=e,this.getHistoryListing()}reorder(e,a){this._history.reorder({id:e.id}).subscribe(n=>{this.histories.splice(a,1),this.helper.toastSuccess(n.message)})}downloadData(){this._history.downloadHistory(this.searchParams).subscribe(e=>{window.open(e.data.link)})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(U),t.Y36(d.uU),t.Y36(w.FF),t.Y36(h.F0),t.Y36(q.B),t.Y36(D.e))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-history"]],decls:93,vars:22,consts:[[1,"dashboard-main"],[1,"dashboard-content"],[1,"d-flex","align-items-center","mb-16","justify-content-between","mr-70"],[1,"breadcrumb"],[1,"breadcrumb-item"],["href","javascript:void(0)",1,"breadcrumb-link"],["href","javascript:void(0)",1,"breadcrumb-link","active"],[1,"d-flex"],["data-toggle","modal","data-target","#Download","href","javascript:void(0)",1,"credit-check",3,"click"],["data-feather","download",1,"download"],[1,"roles-main","delivery-list-table"],[1,"d-flex","align-items-center","justify-content-between","delivery-list-main","mb-2"],[1,"d-flex","for-media-setts"],[1,"form-group","sear-bar-roles","position-relative","mb-0"],["type","search","placeholder","Search..","id","email",1,"form-control","form-control-roles",3,"ngModel","input","ngModelChange"],["name","search",1,"search-ctm"],[1,"search-inputs","d-flex"],[1,"search-inputs","mr-10"],[1,"input-style"],[1,"type-pass"],["type","text","id","start_date","placeholder","From","name","start_date","bsDatepicker","",1,"ctm-input",3,"bsValue","bsConfig","maxDate","bsValueChange"],[1,"icon-eye","d-flex","align-items-center","justify-content-center"],["name","calendar",1,"calender"],["name","X","class","clear-filter",3,"click",4,"ngIf"],[1,"search-inputs"],["type","text","id","end_date","placeholder","To","name","end_date","bsDatepicker","",1,"ctm-input",3,"bsValue","bsConfig","minDate","bsValueChange"],[1,"tab-table"],[1,"tables-roles-main","tables-users-main"],[1,"table"],[1,"thead-ctm"],[1,"inner-cell"],["aria-hidden","true",1,"fa","fa-arrow-down"],[1,"t-body-ctm"],["class","active-row",4,"ngFor","ngForOf"],[3,"from","to","pageSize","currentPage","totalPages","total","changePage","ChangePageSize"],["name","X",1,"clear-filter",3,"click"],[1,"active-row"],["class","inner-cell",4,"ngIf"],[1,"inner-cell","view-anchor-tooltip"],["class","icon-anchor-list","href","javascript:void(0)",3,"click",4,"ngIf"],["class","view-anchor red","href","javascript:void(0)",3,"click",4,"ngIf"],["class","tooltiptext-view",4,"ngIf"],[1,"list-icons-talbe","d-flex","justify-content-center","align-items-center"],["href","javascript:void(0)",1,"icon-anchor-list",3,"click"],["src","assets/img/line-img-gray.svg","alt","img"],["name","check"],["name","plus",1,"icon-width"],["href","javascript:void(0)",1,"view-anchor","red",3,"click"],[1,"tooltiptext-view"],[1,"d-flex","align-items-center","justify-content-end"],["href","javascript:void(0)",1,"tooltip-anchor-modal",3,"click"],["name","plus",1,"icon-width","w15"],[1,"toop-hight",3,"innerHtml"],[1,"date-tooptip-iner"],["name","corner-up-left",1,"icon-width"]],template:function(e,a){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"ul",3)(4,"li",4)(5,"a",5),t._uU(6,"HISTORY"),t.qZA()(),t.TgZ(7,"li",4)(8,"a",6),t._uU(9),t.ALo(10,"date"),t.qZA()()(),t.TgZ(11,"div",7)(12,"a",8),t.NdJ("click",function(){return a.downloadData()}),t._UZ(13,"i",9),t._uU(14," Download Data"),t.qZA()()(),t.TgZ(15,"div",10)(16,"div",11)(17,"div",12)(18,"div",13)(19,"input",14),t.NdJ("input",function(){return a.searchOrder("search")})("ngModelChange",function(o){return a.searchParams.search=o}),t.qZA(),t._UZ(20,"i-feather",15),t.qZA(),t.TgZ(21,"div",16)(22,"div",17)(23,"div",18)(24,"div",19)(25,"input",20),t.NdJ("bsValueChange",function(){return a.searchOrder("date")})("bsValueChange",function(o){return a.startDate=o}),t.qZA(),t.TgZ(26,"div",21),t._UZ(27,"i-feather",22),t.qZA(),t.YNc(28,J,1,0,"i-feather",23),t.qZA()()(),t.TgZ(29,"div",24)(30,"div",18)(31,"div",19)(32,"input",25),t.NdJ("bsValueChange",function(){return a.searchOrder("date")})("bsValueChange",function(o){return a.endDate=o}),t.qZA(),t.TgZ(33,"div",21),t._UZ(34,"i-feather",22),t.qZA(),t.YNc(35,N,1,0,"i-feather",23),t.qZA()()()()()(),t.TgZ(36,"div",26)(37,"div",27)(38,"table",28)(39,"thead",29)(40,"tr")(41,"th")(42,"p",30),t._uU(43,"Work#"),t._UZ(44,"i",31),t.qZA()(),t.TgZ(45,"th")(46,"p",30),t._uU(47,"Location"),t._UZ(48,"i",31),t.qZA()(),t.TgZ(49,"th")(50,"p",30),t._uU(51,"Customer"),t._UZ(52,"i",31),t.qZA()(),t.TgZ(53,"th")(54,"p",30),t._uU(55,"Contract"),t._UZ(56,"i",31),t.qZA()(),t.TgZ(57,"th")(58,"p",30),t._uU(59,"Product"),t._UZ(60,"i",31),t.qZA()(),t.TgZ(61,"th")(62,"p",30),t._uU(63,"Status"),t._UZ(64,"i",31),t.qZA()(),t.TgZ(65,"th")(66,"p",30),t._uU(67,"FSC"),t._UZ(68,"i",31),t.qZA()(),t.TgZ(69,"th")(70,"p",30),t._uU(71,"Delivery Date"),t._UZ(72,"i",31),t.qZA()(),t.TgZ(73,"th")(74,"p",30),t._uU(75,"Order#"),t._UZ(76,"i",31),t.qZA()(),t.TgZ(77,"th")(78,"p",30),t._uU(79,"Invoice#"),t._UZ(80,"i",31),t.qZA()(),t.TgZ(81,"th")(82,"p",30),t._uU(83,"Schedule Ref"),t.qZA()(),t.TgZ(84,"th")(85,"p",30),t._uU(86,"Job Notes"),t.qZA()(),t.TgZ(87,"th")(88,"p",30),t._uU(89,"Actions"),t.qZA()()()(),t.TgZ(90,"tbody",32),t.YNc(91,O,43,16,"tr",33),t.qZA()()(),t.TgZ(92,"app-pagination",34),t.NdJ("changePage",function(o){return a.changePage(o)})("ChangePageSize",function(o){return a.ChangePageSize(o)}),t.qZA()()()()()),2&e&&(t.xp6(9),t.hij("Week ",t.xi3(10,17,a.dateToday,"ww"),""),t.xp6(10),t.Q6J("ngModel",a.searchParams.search),t.xp6(6),t.Q6J("bsValue",a.startDate)("bsConfig",t.DdM(20,x))("maxDate",a.endDate),t.xp6(3),t.Q6J("ngIf",a.startDate),t.xp6(4),t.Q6J("bsValue",a.endDate)("bsConfig",t.DdM(21,x))("minDate",a.startDate),t.xp6(3),t.Q6J("ngIf",a.endDate),t.xp6(56),t.Q6J("ngForOf",a.histories),t.xp6(1),t.Q6J("from",a.pageFrom)("to",a.pageTo)("pageSize",a.searchParams.page_size)("currentPage",a.searchParams.page)("totalPages",a.totalPages)("total",a.totalCount))},directives:[p.Fj,p.JJ,p.On,T.u,m.Y5,m.Np,d.O5,d.sg,P.Q],pipes:[d.uU],styles:[""]}),i})()}];let z=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[h.Bz.forChild(S)],h.Bz]}),i})();var L=s(5530),Q=s(9618);let V=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[d.ez,p.u5,Q.m,z,T.p.pick(L.kEt),m.kn]]}),i})()}}]);