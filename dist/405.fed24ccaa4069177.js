"use strict";(self.webpackChunkhumphree=self.webpackChunkhumphree||[]).push([[405],{405:(Vr,Dt,F)=>{F.d(Dt,{O:()=>_f});var x,h=F(7625),ne=F(8929),$e=new Uint8Array(16);function at(){if(!x&&!(x="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return x($e)}const he=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,se=function te(n){return"string"==typeof n&&he.test(n)};for(var ee=[],He=0;He<256;++He)ee.push((He+256).toString(16).substr(1));const St=function dt(n,e,t){var r=(n=n||{}).random||(n.rng||at)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e){t=t||0;for(var c=0;c<16;++c)e[t+c]=r[c];return e}return function re(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=(ee[n[e+0]]+ee[n[e+1]]+ee[n[e+2]]+ee[n[e+3]]+"-"+ee[n[e+4]]+ee[n[e+5]]+"-"+ee[n[e+6]]+ee[n[e+7]]+"-"+ee[n[e+8]]+ee[n[e+9]]+"-"+ee[n[e+10]]+ee[n[e+11]]+ee[n[e+12]]+ee[n[e+13]]+ee[n[e+14]]+ee[n[e+15]]).toLowerCase();if(!se(t))throw TypeError("Stringified UUID is invalid");return t}(r)};var V=F(5e3),Ft=F(655),Ee=F(1086),Zs=F(8896),ti=F(2916),Hi=F(1221),Te=F(3334),ve=F(7770),Je=F(7545),lt=F(4850),ht=F(341),U=F(2654),M=F(5279),L=F(5283);class G extends ne.xQ{constructor(e=Number.POSITIVE_INFINITY,t=Number.POSITIVE_INFINITY,r){super(),this.scheduler=r,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=e<1?1:e,this._windowTime=t<1?1:t,t===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(e){if(!this.isStopped){const t=this._events;t.push(e),t.length>this._bufferSize&&t.shift()}super.next(e)}nextTimeWindow(e){this.isStopped||(this._events.push(new B(this._getNow(),e)),this._trimBufferThenGetEvents()),super.next(e)}_subscribe(e){const t=this._infiniteTimeWindow,r=t?this._events:this._trimBufferThenGetEvents(),c=this.scheduler,p=r.length;let _;if(this.closed)throw new M.N;if(this.isStopped||this.hasError?_=U.w.EMPTY:(this.observers.push(e),_=new L.W(this,e)),c&&e.add(e=new ve.ht(e,c)),t)for(let y=0;y<p&&!e.closed;y++)e.next(r[y]);else for(let y=0;y<p&&!e.closed;y++)e.next(r[y].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),_}_getNow(){return(this.scheduler||ht.c).now()}_trimBufferThenGetEvents(){const e=this._getNow(),t=this._bufferSize,r=this._windowTime,c=this._events,p=c.length;let _=0;for(;_<p&&!(e-c[_].time<r);)_++;return p>t&&(_=Math.max(_,p-t)),_>0&&c.splice(0,_),c}}class B{constructor(e,t){this.time=e,this.value=t}}function Z(n,e,t){let r;return r=n&&"object"==typeof n?n:{bufferSize:n,windowTime:e,refCount:!1,scheduler:t},c=>c.lift(function W({bufferSize:n=Number.POSITIVE_INFINITY,windowTime:e=Number.POSITIVE_INFINITY,refCount:t,scheduler:r}){let c,_,p=0,y=!1,N=!1;return function(R){let S;p++,!c||y?(y=!1,c=new G(n,e,r),S=c.subscribe(this),_=R.subscribe({next(O){c.next(O)},error(O){y=!0,c.error(O)},complete(){N=!0,_=void 0,c.complete()}}),N&&(_=void 0)):S=c.subscribe(this),this.add(()=>{p--,S.unsubscribe(),S=void 0,_&&!N&&t&&0===p&&(_.unsubscribe(),_=void 0,c=void 0)})}}(r))}function ie(n,e){return e?(0,Je.w)(()=>n,e):(0,Je.w)(()=>n)}var ke=F(7221),Lt=F(1709),ue=F(7314),Ce=F(9500),Oe=F(2011),Qe=F(7663);F(127);const ze=new V.OlP("angularfire2.messaging.vapid-key"),Be=new V.OlP("angularfire2.messaging.service-worker-registeration");let Ie=(()=>{class n{constructor(t,r,c,p,_,y,N){const E=N,R=(0,Ee.of)(void 0).pipe((0,Te.R)(_.outsideAngular),(0,ve.QV)(_.insideAngular),(0,Je.w)(Qe.Gb),(0,Je.w)(j=>j?F.e(175).then(F.bind(F,4175)):Zs.E),(0,lt.U)(()=>(0,Oe.on)(t,p,r)),(0,Je.w)(j=>(0,Oe.cc)(`${j.name}.messaging`,"AngularFireMessaging",j.name,()=>(0,Ft.mG)(this,void 0,void 0,function*(){return j.messaging()}),[])),Z({bufferSize:1,refCount:!1}));this.requestPermission=R.pipe((0,Te.R)(_.outsideAngular),(0,ve.QV)(_.insideAngular),(0,Je.w)(()=>Notification.requestPermission())),this.getToken=R.pipe((0,Te.R)(_.outsideAngular),(0,ve.QV)(_.insideAngular),(0,Je.w)(j=>(0,Ft.mG)(this,void 0,void 0,function*(){if("granted"===Notification.permission){const K=E?yield E:null;return yield j.getToken({vapidKey:y,serviceWorkerRegistration:K})}return null})));const S=new ti.y(j=>{navigator.permissions.query({name:"notifications"}).then(K=>{K.onchange=()=>j.next()})}),O=R.pipe((0,Te.R)(_.outsideAngular),(0,ve.QV)(_.insideAngular),ie(S),ie(this.getToken));return this.tokenChanges=R.pipe((0,Te.R)(_.outsideAngular),(0,ve.QV)(_.insideAngular),(0,Je.w)(()=>(0,Hi.z)(this.getToken,O))),this.messages=R.pipe((0,Te.R)(_.outsideAngular),(0,ve.QV)(_.insideAngular),(0,Je.w)(j=>new ti.y(K=>j.onMessage(K)))),this.requestToken=R.pipe((0,Te.R)(_.outsideAngular),(0,ve.QV)(_.insideAngular),(0,Je.w)(()=>this.requestPermission),(0,ke.K)(()=>(0,Ee.of)(null)),(0,Lt.zg)(()=>this.tokenChanges)),this.deleteToken=()=>R.pipe((0,Te.R)(_.outsideAngular),(0,ve.QV)(_.insideAngular),(0,Je.w)(j=>j.deleteToken()),(0,ue.d)(!1)),(0,Oe.pX)(this,R,p)}}return n.\u0275fac=function(t){return new(t||n)(V.LFG(Oe.Dh),V.LFG(Oe.xv,8),V.LFG(V.Lbi),V.LFG(V.R0b),V.LFG(Ce.HU),V.LFG(ze,8),V.LFG(Be,8))},n.\u0275prov=V.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();var Wr=F(353),ni=F(6787),nn=F(2474),Wi=F(2014),jr=F(5778),Ks=F(7168),$r=F(3489);class jt{constructor(e){this.predicate=e}call(e,t){return t.subscribe(new Fl(e,this.predicate))}}class Fl extends $r.L{constructor(e,t){super(e),this.predicate=t,this.skipping=!0,this.index=0}_next(e){const t=this.destination;this.skipping&&this.tryCallPredicate(e),this.skipping||t.next(e)}tryCallPredicate(e){try{const t=this.predicate(e,this.index++);this.skipping=Boolean(t)}catch(t){this.destination.error(t)}}}F(4087);var Ut=F(3942),nt=F(4859),Xe=F(5861),ft=F(9681),T=F(2090),rn=F(1877);const Tn="@firebase/database";let Js="";function $t(n){Js=n}class ii{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),(0,T.Pz)(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:(0,T.cI)(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Ll{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return(0,T.r3)(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const Qs=function(n){try{if("undefined"!=typeof window&&void 0!==window[n]){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new ii(e)}}catch(e){}return new Ll},Un=Qs("localStorage"),ri=Qs("sessionStorage"),Bn=new rn.Yd("@firebase/database"),Ta=function(){let n=1;return function(){return n++}}(),zr=function(n){const e=(0,T.dS)(n),t=new T.gQ;t.update(e);const r=t.digest();return T.US.encodeByteArray(r)},ji=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?e+=ji.apply(null,r):e+="object"==typeof r?(0,T.Pz)(r):r,e+=" "}return e};let si=null,wa=!0;const Zr=function(n,e){(0,T.hu)(!e||!0===n||!1===n,"Can't turn on custom loggers persistently."),!0===n?(Bn.logLevel=rn.in.VERBOSE,si=Bn.log.bind(Bn),e&&ri.set("logging_enabled",!0)):"function"==typeof n?si=n:(si=null,ri.remove("logging_enabled"))},Ye=function(...n){if(!0===wa&&(wa=!1,null===si&&!0===ri.get("logging_enabled")&&Zr(!0)),si){const e=ji.apply(null,n);si(e)}},Bt=function(n){return function(...e){Ye(n,...e)}},it=function(...n){const e="FIREBASE INTERNAL ERROR: "+ji(...n);Bn.error(e)},Tt=function(...n){const e=`FIREBASE FATAL ERROR: ${ji(...n)}`;throw Bn.error(e),new Error(e)},ye=function(...n){const e="FIREBASE WARNING: "+ji(...n);Bn.warn(e)},pt=function(n){return"number"==typeof n&&(n!=n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},Rt="[MIN_NAME]",ct="[MAX_NAME]",At=function(n,e){if(n===e)return 0;if(n===Rt||e===ct)return-1;if(e===Rt||n===ct)return 1;{const t=Ze(n),r=Ze(e);return null!==t?null!==r?t-r==0?n.length-e.length:t-r:-1:null!==r?1:n<e?-1:1}},Kr=function(n,e){return n===e?0:n<e?-1:1},Yt=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+(0,T.Pz)(e))},qr=function(n){if("object"!=typeof n||null===n)return(0,T.Pz)(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)0!==r&&(t+=","),t+=(0,T.Pz)(e[r]),t+=":",t+=qr(n[e[r]]);return t+="}",t},zt=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let c=0;c<t;c+=e)r.push(n.substring(c,c+e>t?t:c+e));return r};function Ve(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const Zt=function(n){(0,T.hu)(!pt(n),"Invalid JSON number");const r=1023;let c,p,_,y,N;0===n?(p=0,_=0,c=1/n==-1/0?1:0):(c=n<0,(n=Math.abs(n))>=Math.pow(2,1-r)?(y=Math.min(Math.floor(Math.log(n)/Math.LN2),r),p=y+r,_=Math.round(n*Math.pow(2,52-y)-Math.pow(2,52))):(p=0,_=Math.round(n/Math.pow(2,-1074))));const E=[];for(N=52;N;N-=1)E.push(_%2?1:0),_=Math.floor(_/2);for(N=11;N;N-=1)E.push(p%2?1:0),p=Math.floor(p/2);E.push(c?1:0),E.reverse();const R=E.join("");let S="";for(N=0;N<64;N+=8){let O=parseInt(R.substr(N,8),2).toString(16);1===O.length&&(O="0"+O),S+=O}return S.toLowerCase()},$i=new RegExp("^-?(0*)\\d{1,10}$"),to=-2147483648,Qr=2147483647,Ze=function(n){if($i.test(n)){const e=Number(n);if(e>=to&&e<=Qr)return e}return null},Kt=function(n){try{n()}catch(e){setTimeout(()=>{throw ye("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},Vn=function(n,e){const t=setTimeout(n,e);return"object"==typeof t&&t.unref&&t.unref(),t};class Ul{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(r=>this.appCheck=r)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){ye(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class no{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(c=>this.auth_=c)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&"auth/token-not-initialized"===t.code?(Ye("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';e+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ye(e)}}let Yi=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}return n.OWNER="owner",n})();const io=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,qi="websocket",es="long_polling";class so{constructor(e,t,r,c,p=!1,_="",y=!1){this.secure=t,this.namespace=r,this.webSocketOnly=c,this.nodeAdmin=p,this.persistenceKey=_,this.includeNamespaceInQueryParams=y,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Un.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Un.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){return`${this.secure?"https://":"http://"}${this.host}/${this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:""}`}}function vi(n,e,t){let r;if((0,T.hu)("string"==typeof e,"typeof type must == string"),(0,T.hu)("object"==typeof t,"typeof params must == object"),e===qi)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else{if(e!==es)throw new Error("Unknown connection type: "+e);r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?"}(function oo(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams})(n)&&(t.ns=n.namespace);const c=[];return Ve(t,(p,_)=>{c.push(p+"="+_)}),r+c.join("&")}class ao{constructor(){this.counters_={}}incrementCounter(e,t=1){(0,T.r3)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return(0,T.p$)(this.counters_)}}const Ji={},Qi={};function lo(n){const e=n.toString();return Ji[e]||(Ji[e]=new ao),Ji[e]}class Bl{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let c=0;c<r.length;++c)r[c]&&Kt(()=>{this.onMessage_(r[c])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class Gt{constructor(e,t,r,c,p,_,y){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=c,this.authToken=p,this.transportSessionId=_,this.lastSessionId=y,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Bt(e),this.stats_=lo(t),this.urlFn=N=>(this.appCheckToken&&(N.ac=this.appCheckToken),vi(t,es,N))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Bl(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(n){if((0,T.Yr)()||"complete"===document.readyState)n();else{let e=!1;const t=function(){document.body?e||(e=!0,n()):setTimeout(t,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&t()}),window.attachEvent("onload",t))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new po((...p)=>{const[_,y,N,E,R]=p;if(this.incrementIncomingBytes_(p),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===_)this.id=y,this.password=N;else{if("close"!==_)throw new Error("Unrecognized command received: "+_);y?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(y,()=>{this.onClosed_()})):this.onClosed_()}},(...p)=>{const[_,y]=p;this.incrementIncomingBytes_(p),this.myPacketOrderer.handleResponse(_,y)},()=>{this.onClosed_()},this.urlFn);const r={start:"t"};r.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(r.cb=this.scriptTagHolder.uniqueCallbackIdentifier),r.v="5",this.transportSessionId&&(r.s=this.transportSessionId),this.lastSessionId&&(r.ls=this.lastSessionId),this.applicationId&&(r.p=this.applicationId),this.appCheckToken&&(r.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&io.test(location.hostname)&&(r.r="f");const c=this.urlFn(r);this.log_("Connecting via long-poll to "+c),this.scriptTagHolder.addTag(c,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Gt.forceAllow_=!0}static forceDisallow(){Gt.forceDisallow_=!0}static isAvailable(){return!((0,T.Yr)()||!Gt.forceAllow_&&(Gt.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=(0,T.Pz)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=(0,T.h$)(t),c=zt(r,1840);for(let p=0;p<c.length;p++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,c.length,c[p]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if((0,T.Yr)())return;this.myDisconnFrame=document.createElement("iframe");const r={dframe:"t"};r.id=e,r.pw=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=(0,T.Pz)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class po{constructor(e,t,r,c){if(this.onDisconnect=r,this.urlFn=c,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,T.Yr)())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=Ta(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=po.createIFrame_();let p="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(p='<script>document.domain="'+document.domain+'";<\/script>');const _="<html><body>"+p+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(_),this.myIFrame.doc.close()}catch(y){Ye("frame writing exception"),y.stack&&Ye(y.stack),Ye(y)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Ye("No IE domain setting required")}catch(t){const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),r="",c=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+r.length<=1870;){const _=this.pendingSegs.shift();r=r+"&seg"+c+"="+_.seg+"&ts"+c+"="+_.ts+"&d"+c+"="+_.d,c++}return t+=r,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},c=setTimeout(r,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(c),r()})}addTag(e,t){(0,T.Yr)()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const c=r.readyState;(!c||"loaded"===c||"complete"===c)&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{Ye("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch(r){}},Math.floor(1))}}let is=null;"undefined"!=typeof MozWebSocket?is=MozWebSocket:"undefined"!=typeof WebSocket&&(is=WebSocket);let oi=(()=>{class n{constructor(t,r,c,p,_,y,N){this.connId=t,this.applicationId=c,this.appCheckToken=p,this.authToken=_,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Bt(this.connId),this.stats_=lo(r),this.connURL=n.connectionURL_(r,y,N,p),this.nodeAdmin=r.nodeAdmin}static connectionURL_(t,r,c,p){const _={v:"5"};return!(0,T.Yr)()&&"undefined"!=typeof location&&location.hostname&&io.test(location.hostname)&&(_.r="f"),r&&(_.s=r),c&&(_.ls=c),p&&(_.ac=p),vi(t,qi,_)}open(t,r){this.onDisconnect=r,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Un.set("previous_websocket_failure",!0);try{if((0,T.Yr)()){const p={headers:{"User-Agent":`Firebase/5/${Js}/${process.platform}/${this.nodeAdmin?"AdminNode":"Node"}`,"X-Firebase-GMPID":this.applicationId||""}};this.authToken&&(p.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(p.headers["X-Firebase-AppCheck"]=this.appCheckToken);const _=process.env,y=0===this.connURL.indexOf("wss://")?_.HTTPS_PROXY||_.https_proxy:_.HTTP_PROXY||_.http_proxy;y&&(p.proxy={origin:y}),this.mySock=new is(this.connURL,[],p)}else this.mySock=new is(this.connURL,[],{headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}})}catch(c){this.log_("Error instantiating WebSocket.");const p=c.message||c.data;return p&&this.log_(p),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=c=>{this.handleIncomingFrame(c)},this.mySock.onerror=c=>{this.log_("WebSocket error.  Closing connection.");const p=c.message||c.data;p&&this.log_(p),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const c=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);c&&c.length>1&&parseFloat(c[1])<4.4&&(t=!0)}return!t&&null!==is&&!n.forceDisallow_}static previouslyFailed(){return Un.isInMemoryStorage||!0===Un.get("previous_websocket_failure")}markConnectionHealthy(){Un.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const r=this.frames.join("");this.frames=null;const c=(0,T.cI)(r);this.onMessage(c)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if((0,T.hu)(null===this.frames,"We already have a frame buffer"),t.length<=6){const r=Number(t);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(null===this.mySock)return;const r=t.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(r);else{const c=this.extractFrameCount_(r);null!==c&&this.appendFrame_(c)}}send(t){this.resetKeepAlive();const r=(0,T.Pz)(t);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);const c=zt(r,16384);c.length>1&&this.sendString_(String(c.length));for(let p=0;p<c.length;p++)this.sendString_(c[p])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(t){try{this.mySock.send(t)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4,n})();class Ht{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Gt,oi]}initTransports_(e){const t=oi&&oi.isAvailable();let r=t&&!oi.previouslyFailed();if(e.webSocketOnly&&(t||ye("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[oi];else{const c=this.transports_=[];for(const p of Ht.ALL_TRANSPORTS)p&&p.isAvailable()&&c.push(p)}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}class jl{constructor(e,t,r,c,p,_,y,N,E,R){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=c,this.authToken_=p,this.onMessage_=_,this.onReady_=y,this.onDisconnect_=N,this.onKill_=E,this.lastSessionId=R,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Bt("c:"+this.id+":"),this.transportManager_=new Ht(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const c=e.healthyTimeout||0;c>0&&(this.healthyTimeout_=Vn(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(c)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Yt("t",e),r=Yt("d",e);if("c"===t)this.onSecondaryControl_(r);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(r)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Yt("t",e),r=Yt("d",e);"c"===t?this.onControl_(r):"d"===t&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Yt("t",e);if("d"in e){const r=e.d;if("h"===t)this.onHandshake_(r);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let c=0;c<this.pendingDataMessages.length;++c)this.onDataMessage_(this.pendingDataMessages[c]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(r):"r"===t?this.onReset_(r):"e"===t?it("Server Error: "+r):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):it("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,c=e.h;this.sessionId=e.s,this.repoInfo_.host=c,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==r&&ye("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Vn(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Vn(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Un.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class os{put(e,t,r,c){}merge(e,t,r,c){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}class nr{constructor(e){this.allowedEvents_=e,this.listeners_={},(0,T.hu)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let c=0;c<r.length;c++)r[c].callback.apply(r[c].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const c=this.getInitialEvent(e);c&&t.apply(r,c)}off(e,t,r){this.validateEventType_(e);const c=this.listeners_[e]||[];for(let p=0;p<c.length;p++)if(c[p].callback===t&&(!r||r===c[p].context))return void c.splice(p,1)}validateEventType_(e){(0,T.hu)(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class ir extends nr{constructor(){super(["online"]),this.online_=!0,"undefined"!=typeof window&&void 0!==window.addEventListener&&!(0,T.uI)()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new ir}getInitialEvent(e){return(0,T.hu)("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class _e{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let r=0;for(let c=0;c<this.pieces_.length;c++)this.pieces_[c].length>0&&(this.pieces_[r]=this.pieces_[c],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function ge(){return new _e("")}function ae(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function an(n){return n.pieces_.length-n.pieceNum_}function De(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new _e(n.pieces_,e)}function yo(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function wi(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function as(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new _e(e,0)}function Me(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof _e)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let c=0;c<r.length;c++)r[c].length>0&&t.push(r[c])}return new _e(t,0)}function le(n){return n.pieceNum_>=n.pieces_.length}function yt(n,e){const t=ae(n),r=ae(e);if(null===t)return e;if(t===r)return yt(De(n),De(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function Pa(n,e){const t=wi(n,0),r=wi(e,0);for(let c=0;c<t.length&&c<r.length;c++){const p=At(t[c],r[c]);if(0!==p)return p}return t.length===r.length?0:t.length<r.length?-1:1}function bo(n,e){if(an(n)!==an(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function wt(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(an(n)>an(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class $l{constructor(e,t){this.errorPrefix_=t,this.parts_=wi(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=(0,T.ug)(this.parts_[r]);No(this)}}function No(n){if(n.byteLength_>768)throw new Error(n.errorPrefix_+"has a key path longer than 768 bytes ("+n.byteLength_+").");if(n.parts_.length>32)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+Cn(n))}function Cn(n){return 0===n.parts_.length?"":"in property '"+n.parts_.join(".")+"'"}class rr extends nr{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new rr}getInitialEvent(e){return(0,T.hu)("visible"===e,"Unknown event type: "+e),[this.visible_]}}const jn=1e3;let ls,In=(()=>{class n extends os{constructor(t,r,c,p,_,y,N,E){if(super(),this.repoInfo_=t,this.applicationId_=r,this.onDataUpdate_=c,this.onConnectStatus_=p,this.onServerInfoUpdate_=_,this.authTokenProvider_=y,this.appCheckTokenProvider_=N,this.authOverride_=E,this.id=n.nextPersistentConnectionId_++,this.log_=Bt("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=jn,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,E&&!(0,T.Yr)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");rr.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&ir.getInstance().on("online",this.onOnline_,this)}sendRequest(t,r,c){const p=++this.requestNumber_,_={r:p,a:t,b:r};this.log_((0,T.Pz)(_)),(0,T.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(_),c&&(this.requestCBHash_[p]=c)}get(t){this.initConnection_();const r=new T.BH,c={p:t._path.toString(),q:t._queryObject},p={action:"g",request:c,onComplete:y=>{const N=y.d;"ok"===y.s?(this.onDataUpdate_(c.p,N,!1,null),r.resolve(N)):r.reject(N)}};this.outstandingGets_.push(p),this.outstandingGetCount_++;const _=this.outstandingGets_.length-1;return this.connected_||setTimeout(()=>{const y=this.outstandingGets_[_];void 0===y||p!==y||(delete this.outstandingGets_[_],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),this.log_("get "+_+" timed out on connection"),r.reject(new Error("Client is offline.")))},3e3),this.connected_&&this.sendGet_(_),r.promise}listen(t,r,c,p){this.initConnection_();const _=t._queryIdentifier,y=t._path.toString();this.log_("Listen called for "+y+" "+_),this.listens.has(y)||this.listens.set(y,new Map),(0,T.hu)(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,T.hu)(!this.listens.get(y).has(_),"listen() called twice for same path/queryId.");const N={onComplete:p,hashFn:r,query:t,tag:c};this.listens.get(y).set(_,N),this.connected_&&this.sendListen_(N)}sendGet_(t){const r=this.outstandingGets_[t];this.sendRequest("g",r.request,c=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(c)})}sendListen_(t){const r=t.query,c=r._path.toString(),p=r._queryIdentifier;this.log_("Listen on "+c+" for "+p);const _={p:c};t.tag&&(_.q=r._queryObject,_.t=t.tag),_.h=t.hashFn(),this.sendRequest("q",_,N=>{const E=N.d,R=N.s;n.warnOnListenWarnings_(E,r),(this.listens.get(c)&&this.listens.get(c).get(p))===t&&(this.log_("listen response",N),"ok"!==R&&this.removeListen_(c,p),t.onComplete&&t.onComplete(R,E))})}static warnOnListenWarnings_(t,r){if(t&&"object"==typeof t&&(0,T.r3)(t,"w")){const c=(0,T.DV)(t,"w");if(Array.isArray(c)&&~c.indexOf("no_index")){const p='".indexOn": "'+r._queryParams.getIndex().toString()+'"',_=r._path.toString();ye(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${p} at ${_} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&40===t.length||(0,T.GJ)(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,r=(0,T.w9)(t)?"auth":"gauth",c={cred:t};null===this.authOverride_?c.noauth=!0:"object"==typeof this.authOverride_&&(c.authvar=this.authOverride_),this.sendRequest(r,c,p=>{const _=p.s,y=p.d||"error";this.authToken_===t&&("ok"===_?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(_,y))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{const r=t.s,c=t.d||"error";"ok"===r?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,c)})}unlisten(t,r){const c=t._path.toString(),p=t._queryIdentifier;this.log_("Unlisten called for "+c+" "+p),(0,T.hu)(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(c,p)&&this.connected_&&this.sendUnlisten_(c,p,t._queryObject,r)}sendUnlisten_(t,r,c,p){this.log_("Unlisten on "+t+" for "+r);const _={p:t};p&&(_.q=c,_.t=p),this.sendRequest("n",_)}onDisconnectPut(t,r,c){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,r,c):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:r,onComplete:c})}onDisconnectMerge(t,r,c){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,r,c):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:r,onComplete:c})}onDisconnectCancel(t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(t,r,c,p){const _={p:r,d:c};this.log_("onDisconnect "+t,_),this.sendRequest(t,_,y=>{p&&setTimeout(()=>{p(y.s,y.d)},Math.floor(0))})}put(t,r,c,p){this.putInternal("p",t,r,c,p)}merge(t,r,c,p){this.putInternal("m",t,r,c,p)}putInternal(t,r,c,p,_){this.initConnection_();const y={p:r,d:c};void 0!==_&&(y.h=_),this.outstandingPuts_.push({action:t,request:y,onComplete:p}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+r)}sendPut_(t){const r=this.outstandingPuts_[t].action,c=this.outstandingPuts_[t].request,p=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(r,c,_=>{this.log_(r+" response",_),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),p&&p(_.s,_.d)})}reportStats(t){if(this.connected_){const r={c:t};this.log_("reportStats",r),this.sendRequest("s",r,c=>{"ok"!==c.s&&this.log_("reportStats","Error sending stats: "+c.d)})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+(0,T.Pz)(t));const r=t.r,c=this.requestCBHash_[r];c&&(delete this.requestCBHash_[r],c(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,r){this.log_("handleServerMessage",t,r),"d"===t?this.onDataUpdate_(r.p,r.d,!1,r.t):"m"===t?this.onDataUpdate_(r.p,r.d,!0,r.t):"c"===t?this.onListenRevoked_(r.p,r.q):"ac"===t?this.onAuthRevoked_(r.s,r.d):"apc"===t?this.onAppCheckRevoked_(r.s,r.d):"sd"===t?this.onSecurityDebugPacket_(r):it("Unrecognized action received from server: "+(0,T.Pz)(t)+"\nAre you using the latest client?")}onReady_(t,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){(0,T.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=jn,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=jn,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=jn),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const t=(new Date).getTime()-this.lastConnectionAttemptTime_;let r=Math.max(0,this.reconnectDelay_-t);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}establishConnection_(){var t=this;return(0,Xe.Z)(function*(){if(t.shouldReconnect_()){t.log_("Making a connection attempt"),t.lastConnectionAttemptTime_=(new Date).getTime(),t.lastConnectionEstablishedTime_=null;const r=t.onDataMessage_.bind(t),c=t.onReady_.bind(t),p=t.onRealtimeDisconnect_.bind(t),_=t.id+":"+n.nextConnectionId_++,y=t.lastSessionId;let N=!1,E=null;const R=function(){E?E.close():(N=!0,p())};t.realtime_={close:R,sendRequest:function(j){(0,T.hu)(E,"sendRequest call when we're not connected not allowed."),E.sendRequest(j)}};const O=t.forceTokenRefresh_;t.forceTokenRefresh_=!1;try{const[j,K]=yield Promise.all([t.authTokenProvider_.getToken(O),t.appCheckTokenProvider_.getToken(O)]);N?Ye("getToken() completed but was canceled"):(Ye("getToken() completed. Creating connection."),t.authToken_=j&&j.accessToken,t.appCheckToken_=K&&K.token,E=new jl(_,t.repoInfo_,t.applicationId_,t.appCheckToken_,t.authToken_,r,c,p,me=>{ye(me+" ("+t.repoInfo_.toString()+")"),t.interrupt("server_kill")},y))}catch(j){t.log_("Failed to get token: "+j),N||(t.repoInfo_.nodeAdmin&&ye(j),R())}}})()}interrupt(t){Ye("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Ye("Resuming connection for reason: "+t),delete this.interruptReasons_[t],(0,T.xb)(this.interruptReasons_)&&(this.reconnectDelay_=jn,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const r=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const r=this.outstandingPuts_[t];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(t,r){let c;c=r?r.map(_=>qr(_)).join("$"):"default";const p=this.removeListen_(t,c);p&&p.onComplete&&p.onComplete("permission_denied")}removeListen_(t,r){const c=new _e(t).toString();let p;if(this.listens.has(c)){const _=this.listens.get(c);p=_.get(r),_.delete(r),0===_.size&&this.listens.delete(c)}else p=void 0;return p}onAuthRevoked_(t,r){Ye("Auth token revoked: "+t+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===t||"permission_denied"===t)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,r){Ye("App check token revoked: "+t+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===t||"permission_denied"===t)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const r of t.values())this.sendListen_(r);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let r="js";(0,T.Yr)()&&(r=this.repoInfo_.nodeAdmin?"admin_node":"node"),t["sdk."+r+"."+Js.replace(/\./g,"-")]=1,(0,T.uI)()?t["framework.cordova"]=1:(0,T.b$)()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=ir.getInstance().currentlyOnline();return(0,T.xb)(this.interruptReasons_)&&t}}return n.nextPersistentConnectionId_=0,n.nextConnectionId_=0,n})();class de{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new de(e,t)}}class Ei{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new de(Rt,e),c=new de(Rt,t);return 0!==this.compare(r,c)}minPost(){return de.MIN}}class cs extends Ei{static get __EMPTY_NODE(){return ls}static set __EMPTY_NODE(e){ls=e}compare(e,t){return At(e.name,t.name)}isDefinedOn(e){throw(0,T.g5)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return de.MIN}maxPost(){return new de(ct,ls)}makePost(e,t){return(0,T.hu)("string"==typeof e,"KeyIndex indexValue must always be a string."),new de(e,ls)}toString(){return".key"}}const ln=new cs;class us{constructor(e,t,r,c,p=null){this.isReverse_=c,this.resultGenerator_=p,this.nodeStack_=[];let _=1;for(;!e.isEmpty();)if(e=e,_=t?r(e.key,t):1,c&&(_*=-1),_<0)e=this.isReverse_?e.left:e.right;else{if(0===_){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}let sr,Ot=(()=>{class n{constructor(t,r,c,p,_){this.key=t,this.value=r,this.color=null!=c?c:n.RED,this.left=null!=p?p:Et.EMPTY_NODE,this.right=null!=_?_:Et.EMPTY_NODE}copy(t,r,c,p,_){return new n(null!=t?t:this.key,null!=r?r:this.value,null!=c?c:this.color,null!=p?p:this.left,null!=_?_:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,c){let p=this;const _=c(t,p.key);return p=_<0?p.copy(null,null,null,p.left.insert(t,r,c),null):0===_?p.copy(null,r,null,null,null):p.copy(null,null,null,null,p.right.insert(t,r,c)),p.fixUp_()}removeMin_(){if(this.left.isEmpty())return Et.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,r){let c,p;if(c=this,r(t,c.key)<0)!c.left.isEmpty()&&!c.left.isRed_()&&!c.left.left.isRed_()&&(c=c.moveRedLeft_()),c=c.copy(null,null,null,c.left.remove(t,r),null);else{if(c.left.isRed_()&&(c=c.rotateRight_()),!c.right.isEmpty()&&!c.right.isRed_()&&!c.right.left.isRed_()&&(c=c.moveRedRight_()),0===r(t,c.key)){if(c.right.isEmpty())return Et.EMPTY_NODE;p=c.right.min_(),c=c.copy(p.key,p.value,null,null,c.right.removeMin_())}c=c.copy(null,null,null,null,c.right.remove(t,r))}return c.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})();class Et{constructor(e,t=Et.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Et(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Ot.BLACK,null,null))}remove(e){return new Et(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Ot.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),0===t)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,c=null;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),0===t){if(r.left.isEmpty())return c?c.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}t<0?r=r.left:t>0&&(c=r,r=r.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new us(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new us(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new us(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new us(this.root_,null,this.comparator_,!0,e)}}function Co(n,e){return At(n.name,e.name)}function Io(n,e){return At(n,e)}Et.EMPTY_NODE=new class zl{copy(e,t,r,c,p){return this}insert(e,t,r){return new Ot(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const ds=function(n){return"number"==typeof n?"number:"+Zt(n):"string:"+n},Ua=function(n){if(n.isLeafNode()){const e=n.val();(0,T.hu)("string"==typeof e||"number"==typeof e||"object"==typeof e&&(0,T.r3)(e,".sv"),"Priority must be a string or number.")}else(0,T.hu)(n===sr||n.isEmpty(),"priority of unexpected type.");(0,T.hu)(n===sr||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let hs,fs,Ba,Ci=(()=>{class n{constructor(t,r=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=r,this.lazyHash_=null,(0,T.hu)(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),Ua(this.priorityNode_)}static set __childrenNodeConstructor(t){hs=t}static get __childrenNodeConstructor(){return hs}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return le(t)?this:".priority"===ae(t)?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,r){return null}updateImmediateChild(t,r){return".priority"===t?this.updatePriority(r):r.isEmpty()&&".priority"!==t?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,r).updatePriority(this.priorityNode_)}updateChild(t,r){const c=ae(t);return null===c?r:r.isEmpty()&&".priority"!==c?this:((0,T.hu)(".priority"!==c||1===an(t),".priority must be the last token in a path"),this.updateImmediateChild(c,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(De(t),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,r){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+ds(this.priorityNode_.val())+":");const r=typeof this.value_;t+=r+":",t+="number"===r?Zt(this.value_):this.value_,this.lazyHash_=zr(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:((0,T.hu)(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const r=typeof t.value_,c=typeof this.value_,p=n.VALUE_TYPE_ORDER.indexOf(r),_=n.VALUE_TYPE_ORDER.indexOf(c);return(0,T.hu)(p>=0,"Unknown leaf type: "+r),(0,T.hu)(_>=0,"Unknown leaf type: "+c),p===_?"object"===c?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:_-p}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){const r=t;return this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_)}return!1}}return n.VALUE_TYPE_ORDER=["object","boolean","number","string"],n})();const Fe=new class or extends Ei{compare(e,t){const r=e.node.getPriority(),c=t.node.getPriority(),p=r.compareTo(c);return 0===p?At(e.name,t.name):p}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return de.MIN}maxPost(){return new de(ct,new Ci("[PRIORITY-POST]",Ba))}makePost(e,t){const r=fs(e);return new de(t,new Ci("[PRIORITY-POST]",r))}toString(){return".priority"}},ql=Math.log(2);class Ga{constructor(e){this.count=parseInt(Math.log(e+1)/ql,10),this.current_=this.count-1;const c=(p=>parseInt(Array(this.count+1).join("1"),2))();this.bits_=e+1&c}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Ii=function(n,e,t,r){n.sort(e);const c=function(N,E){const R=E-N;let S,O;if(0===R)return null;if(1===R)return S=n[N],O=t?t(S):S,new Ot(O,S.node,Ot.BLACK,null,null);{const j=parseInt(R/2,10)+N,K=c(N,j),me=c(j+1,E);return S=n[j],O=t?t(S):S,new Ot(O,S.node,Ot.BLACK,K,me)}},y=function(N){let E=null,R=null,S=n.length;const O=function(K,me){const tt=S-K,ei=S;S-=K;const Fn=c(tt+1,ei),Gi=n[tt],vt=t?t(Gi):Gi;j(new Ot(vt,Gi.node,me,null,Fn))},j=function(K){E?(E.left=K,E=K):(R=K,E=K)};for(let K=0;K<N.count;++K){const me=N.nextBitIsOne(),tt=Math.pow(2,N.count-(K+1));me?O(tt,Ot.BLACK):(O(tt,Ot.BLACK),O(tt,Ot.RED))}return R}(new Ga(n.length));return new Et(r||e,y)};let So;const qt={};class cn{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return(0,T.hu)(qt&&Fe,"ChildrenNode.ts has not been loaded"),So=So||new cn({".priority":qt},{".priority":Fe}),So}get(e){const t=(0,T.DV)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Et?t:null}hasIndex(e){return(0,T.r3)(this.indexSet_,e.toString())}addIndex(e,t){(0,T.hu)(e!==ln,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let c=!1;const p=t.getIterator(de.Wrap);let y,_=p.getNext();for(;_;)c=c||e.isDefinedOn(_.node),r.push(_),_=p.getNext();y=c?Ii(r,e.getCompare()):qt;const N=e.toString(),E=Object.assign({},this.indexSet_);E[N]=e;const R=Object.assign({},this.indexes_);return R[N]=y,new cn(R,E)}addToIndexes(e,t){const r=(0,T.UI)(this.indexes_,(c,p)=>{const _=(0,T.DV)(this.indexSet_,p);if((0,T.hu)(_,"Missing index implementation for "+p),c===qt){if(_.isDefinedOn(e.node)){const y=[],N=t.getIterator(de.Wrap);let E=N.getNext();for(;E;)E.name!==e.name&&y.push(E),E=N.getNext();return y.push(e),Ii(y,_.getCompare())}return qt}{const y=t.get(e.name);let N=c;return y&&(N=N.remove(new de(e.name,y))),N.insert(e,e.node)}});return new cn(r,this.indexSet_)}removeFromIndexes(e,t){const r=(0,T.UI)(this.indexes_,c=>{if(c===qt)return c;{const p=t.get(e.name);return p?c.remove(new de(e.name,p)):c}});return new cn(r,this.indexSet_)}}let ar,oe=(()=>{class n{constructor(t,r,c){this.children_=t,this.priorityNode_=r,this.indexMap_=c,this.lazyHash_=null,this.priorityNode_&&Ua(this.priorityNode_),this.children_.isEmpty()&&(0,T.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return ar||(ar=new n(new Et(Io),null,cn.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ar}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(".priority"===t)return this.getPriority();{const r=this.children_.get(t);return null===r?ar:r}}getChild(t){const r=ae(t);return null===r?this:this.getImmediateChild(r).getChild(De(t))}hasChild(t){return null!==this.children_.get(t)}updateImmediateChild(t,r){if((0,T.hu)(r,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(r);{const c=new de(t,r);let p,_;r.isEmpty()?(p=this.children_.remove(t),_=this.indexMap_.removeFromIndexes(c,this.children_)):(p=this.children_.insert(t,r),_=this.indexMap_.addToIndexes(c,this.children_));const y=p.isEmpty()?ar:this.priorityNode_;return new n(p,y,_)}}updateChild(t,r){const c=ae(t);if(null===c)return r;{(0,T.hu)(".priority"!==ae(t)||1===an(t),".priority must be the last token in a path");const p=this.getImmediateChild(c).updateChild(De(t),r);return this.updateImmediateChild(c,p)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const r={};let c=0,p=0,_=!0;if(this.forEachChild(Fe,(y,N)=>{r[y]=N.val(t),c++,_&&n.INTEGER_REGEXP_.test(y)?p=Math.max(p,Number(y)):_=!1}),!t&&_&&p<2*c){const y=[];for(const N in r)y[N]=r[N];return y}return t&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(null===this.lazyHash_){let t="";this.getPriority().isEmpty()||(t+="priority:"+ds(this.getPriority().val())+":"),this.forEachChild(Fe,(r,c)=>{const p=c.hash();""!==p&&(t+=":"+r+":"+p)}),this.lazyHash_=""===t?"":zr(t)}return this.lazyHash_}getPredecessorChildName(t,r,c){const p=this.resolveIndex_(c);if(p){const _=p.getPredecessorKey(new de(t,r));return _?_.name:null}return this.children_.getPredecessorKey(t)}getFirstChildName(t){const r=this.resolveIndex_(t);if(r){const c=r.minKey();return c&&c.name}return this.children_.minKey()}getFirstChild(t){const r=this.getFirstChildName(t);return r?new de(r,this.children_.get(r)):null}getLastChildName(t){const r=this.resolveIndex_(t);if(r){const c=r.maxKey();return c&&c.name}return this.children_.maxKey()}getLastChild(t){const r=this.getLastChildName(t);return r?new de(r,this.children_.get(r)):null}forEachChild(t,r){const c=this.resolveIndex_(t);return c?c.inorderTraversal(p=>r(p.name,p.node)):this.children_.inorderTraversal(r)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,r){const c=this.resolveIndex_(r);if(c)return c.getIteratorFrom(t,p=>p);{const p=this.children_.getIteratorFrom(t.name,de.Wrap);let _=p.peek();for(;null!=_&&r.compare(_,t)<0;)p.getNext(),_=p.peek();return p}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,r){const c=this.resolveIndex_(r);if(c)return c.getReverseIteratorFrom(t,p=>p);{const p=this.children_.getReverseIteratorFrom(t.name,de.Wrap);let _=p.peek();for(;null!=_&&r.compare(_,t)>0;)p.getNext(),_=p.peek();return p}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===lr?-1:0}withIndex(t){if(t===ln||this.indexMap_.hasIndex(t))return this;{const r=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,r)}}isIndexed(t){return t===ln||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const r=t;if(this.getPriority().equals(r.getPriority())){if(this.children_.count()===r.children_.count()){const c=this.getIterator(Fe),p=r.getIterator(Fe);let _=c.getNext(),y=p.getNext();for(;_&&y;){if(_.name!==y.name||!_.node.equals(y.node))return!1;_=c.getNext(),y=p.getNext()}return null===_&&null===y}return!1}return!1}}resolveIndex_(t){return t===ln?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})();const lr=new class Jl extends oe{constructor(){super(new Et(Io),oe.EMPTY_NODE,cn.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return oe.EMPTY_NODE}isEmpty(){return!1}};function Ke(n,e=null){if(null===n)return oe.EMPTY_NODE;if("object"==typeof n&&".priority"in n&&(e=n[".priority"]),(0,T.hu)(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof n&&".value"in n&&null!==n[".value"]&&(n=n[".value"]),"object"!=typeof n||".sv"in n)return new Ci(n,Ke(e));if(n instanceof Array){let t=oe.EMPTY_NODE;return Ve(n,(r,c)=>{if((0,T.r3)(n,r)&&"."!==r.substring(0,1)){const p=Ke(c);(p.isLeafNode()||!p.isEmpty())&&(t=t.updateImmediateChild(r,p))}}),t.updatePriority(Ke(e))}{const t=[];let r=!1;if(Ve(n,(_,y)=>{if("."!==_.substring(0,1)){const N=Ke(y);N.isEmpty()||(r=r||!N.getPriority().isEmpty(),t.push(new de(_,N)))}}),0===t.length)return oe.EMPTY_NODE;const p=Ii(t,Co,_=>_.name,Io);if(r){const _=Ii(t,Fe.getCompare());return new oe(p,Ke(e),new cn({".priority":_},{".priority":Fe}))}return new oe(p,Ke(e),cn.Default)}}Object.defineProperties(de,{MIN:{value:new de(Rt,oe.EMPTY_NODE)},MAX:{value:new de(ct,lr)}}),cs.__EMPTY_NODE=oe.EMPTY_NODE,Ci.__childrenNodeConstructor=oe,function Zl(n){sr=n}(lr),function Kl(n){Ba=n}(lr),function Do(n){fs=n}(Ke);class Xl extends Ei{constructor(e){super(),this.indexPath_=e,(0,T.hu)(!le(e)&&".priority"!==ae(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),c=this.extractChild(t.node),p=r.compareTo(c);return 0===p?At(e.name,t.name):p}makePost(e,t){const r=Ke(e),c=oe.EMPTY_NODE.updateChild(this.indexPath_,r);return new de(t,c)}maxPost(){const e=oe.EMPTY_NODE.updateChild(this.indexPath_,lr);return new de(ct,e)}toString(){return wi(this.indexPath_,0).join("/")}}const Ha=new class wu extends Ei{compare(e,t){const r=e.node.compareTo(t.node);return 0===r?At(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return de.MIN}maxPost(){return de.MAX}makePost(e,t){const r=Ke(e);return new de(t,r)}toString(){return".value"}},ps="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Di=function(){let n=0;const e=[];return function(t){const r=t===n;let c;n=t;const p=new Array(8);for(c=7;c>=0;c--)p[c]=ps.charAt(t%64),t=Math.floor(t/64);(0,T.hu)(0===t,"Cannot push at time == 0");let _=p.join("");if(r){for(c=11;c>=0&&63===e[c];c--)e[c]=0;e[c]++}else for(c=0;c<12;c++)e[c]=Math.floor(64*Math.random());for(c=0;c<12;c++)_+=ps.charAt(e[c]);return(0,T.hu)(20===_.length,"nextPushId: Length should be 20."),_}}(),Ao=function(n){if(n===""+Qr)return"-";const e=Ze(n);if(null!=e)return""+(e+1);const t=new Array(n.length);for(let _=0;_<t.length;_++)t[_]=n.charAt(_);if(t.length<786)return t.push("-"),t.join("");let r=t.length-1;for(;r>=0&&"z"===t[r];)r--;if(-1===r)return ct;const p=ps.charAt(ps.indexOf(t[r])+1);return t[r]=p,t.slice(0,r+1).join("")},Va=function(n){if(n===""+to)return Rt;const e=Ze(n);if(null!=e)return""+(e-1);const t=new Array(n.length);for(let r=0;r<t.length;r++)t[r]=n.charAt(r);return"-"===t[t.length-1]?1===t.length?""+Qr:(delete t[t.length-1],t.join("")):(t[t.length-1]=ps.charAt(ps.indexOf(t[t.length-1])-1),t.join("")+"z".repeat(786-t.length))};function Wa(n){return{type:"value",snapshotNode:n}}function cr(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function gs(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function ai(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}class ja{constructor(e){this.index_=e}updateChild(e,t,r,c,p,_){(0,T.hu)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const y=e.getImmediateChild(t);return y.getChild(c).equals(r.getChild(c))&&y.isEmpty()===r.isEmpty()||(null!=_&&(r.isEmpty()?e.hasChild(t)?_.trackChildChange(gs(t,y)):(0,T.hu)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):y.isEmpty()?_.trackChildChange(cr(t,r)):_.trackChildChange(ai(t,r,y))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return null!=r&&(e.isLeafNode()||e.forEachChild(Fe,(c,p)=>{t.hasChild(c)||r.trackChildChange(gs(c,p))}),t.isLeafNode()||t.forEachChild(Fe,(c,p)=>{if(e.hasChild(c)){const _=e.getImmediateChild(c);_.equals(p)||r.trackChildChange(ai(c,p,_))}else r.trackChildChange(cr(c,p))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?oe.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class li{constructor(e){this.indexedFilter_=new ja(e.getIndex()),this.index_=e.getIndex(),this.startPost_=li.getStartPost_(e),this.endPost_=li.getEndPost_(e)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0}updateChild(e,t,r,c,p,_){return this.matches(new de(t,r))||(r=oe.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,c,p,_)}updateFullNode(e,t,r){t.isLeafNode()&&(t=oe.EMPTY_NODE);let c=t.withIndex(this.index_);c=c.updatePriority(oe.EMPTY_NODE);const p=this;return t.forEachChild(Fe,(_,y)=>{p.matches(new de(_,y))||(c=c.updateImmediateChild(_,oe.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,c,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class $a{constructor(e){this.rangedFilter_=new li(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}updateChild(e,t,r,c,p,_){return this.rangedFilter_.matches(new de(t,r))||(r=oe.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,c,p,_):this.fullLimitUpdateChild_(e,t,r,p,_)}updateFullNode(e,t,r){let c;if(t.isLeafNode()||t.isEmpty())c=oe.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let p;c=oe.EMPTY_NODE.withIndex(this.index_),p=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let _=0;for(;p.hasNext()&&_<this.limit_;){const y=p.getNext();let N;if(N=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),y)<=0:this.index_.compare(y,this.rangedFilter_.getEndPost())<=0,!N)break;c=c.updateImmediateChild(y.name,y.node),_++}}else{let p,_,y,N;if(c=t.withIndex(this.index_),c=c.updatePriority(oe.EMPTY_NODE),this.reverse_){N=c.getReverseIterator(this.index_),p=this.rangedFilter_.getEndPost(),_=this.rangedFilter_.getStartPost();const S=this.index_.getCompare();y=(O,j)=>S(j,O)}else N=c.getIterator(this.index_),p=this.rangedFilter_.getStartPost(),_=this.rangedFilter_.getEndPost(),y=this.index_.getCompare();let E=0,R=!1;for(;N.hasNext();){const S=N.getNext();!R&&y(p,S)<=0&&(R=!0),R&&E<this.limit_&&y(S,_)<=0?E++:c=c.updateImmediateChild(S.name,oe.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,c,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,c,p){let _;if(this.reverse_){const S=this.index_.getCompare();_=(O,j)=>S(j,O)}else _=this.index_.getCompare();const y=e;(0,T.hu)(y.numChildren()===this.limit_,"");const N=new de(t,r),E=this.reverse_?y.getFirstChild(this.index_):y.getLastChild(this.index_),R=this.rangedFilter_.matches(N);if(y.hasChild(t)){const S=y.getImmediateChild(t);let O=c.getChildAfterChild(this.index_,E,this.reverse_);for(;null!=O&&(O.name===t||y.hasChild(O.name));)O=c.getChildAfterChild(this.index_,O,this.reverse_);const j=null==O?1:_(O,N);if(R&&!r.isEmpty()&&j>=0)return null!=p&&p.trackChildChange(ai(t,r,S)),y.updateImmediateChild(t,r);{null!=p&&p.trackChildChange(gs(t,S));const me=y.updateImmediateChild(t,oe.EMPTY_NODE);return null!=O&&this.rangedFilter_.matches(O)?(null!=p&&p.trackChildChange(cr(O.name,O.node)),me.updateImmediateChild(O.name,O.node)):me}}return r.isEmpty()?e:R&&_(E,N)>=0?(null!=p&&(p.trackChildChange(gs(E.name,E.node)),p.trackChildChange(cr(t,r))),y.updateImmediateChild(t,r).updateImmediateChild(E.name,oe.EMPTY_NODE)):e}}class Oo{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Fe}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,T.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(0,T.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Rt}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,T.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(0,T.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ct}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,T.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Fe}copy(){const e=new Oo;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function ur(n,e,t){const r=n.copy();return r.startSet_=!0,void 0===e&&(e=null),r.indexStartValue_=e,null!=t?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function un(n,e,t){const r=n.copy();return r.endSet_=!0,void 0===e&&(e=null),r.indexEndValue_=e,void 0!==t?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function ci(n,e){const t=n.copy();return t.index_=e,t}function dr(n){const e={};if(n.isDefault())return e;let t;return n.index_===Fe?t="$priority":n.index_===Ha?t="$value":n.index_===ln?t="$key":((0,T.hu)(n.index_ instanceof Xl,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=(0,T.Pz)(t),n.startSet_&&(e.startAt=(0,T.Pz)(n.indexStartValue_),n.startNameSet_&&(e.startAt+=","+(0,T.Pz)(n.indexStartName_))),n.endSet_&&(e.endAt=(0,T.Pz)(n.indexEndValue_),n.endNameSet_&&(e.endAt+=","+(0,T.Pz)(n.indexEndName_))),n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Ya(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_)),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_)),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;""===t&&(t=n.isViewFromLeft()?"l":"r"),e.vf=t}return n.index_!==Fe&&(e.i=n.index_.toString()),e}class We extends os{constructor(e,t,r,c){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=c,this.log_=Bt("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:((0,T.hu)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,c){const p=e._path.toString();this.log_("Listen called for "+p+" "+e._queryIdentifier);const _=We.getListenId_(e,r),y={};this.listens_[_]=y;const N=dr(e._queryParams);this.restRequest_(p+".json",N,(E,R)=>{let S=R;if(404===E&&(S=null,E=null),null===E&&this.onDataUpdate_(p,S,!1,r),(0,T.DV)(this.listens_,_)===y){let O;O=E?401===E?"permission_denied":"rest_error:"+E:"ok",c(O,null)}})}unlisten(e,t){const r=We.getListenId_(e,t);delete this.listens_[r]}get(e){const t=dr(e._queryParams),r=e._path.toString(),c=new T.BH;return this.restRequest_(r+".json",t,(p,_)=>{let y=_;404===p&&(y=null,p=null),null===p?(this.onDataUpdate_(r,y,!1,null),c.resolve(y)):c.reject(new Error(y))}),c.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([c,p])=>{c&&c.accessToken&&(t.auth=c.accessToken),p&&p.token&&(t.ac=p.token);const _=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+(0,T.xO)(t);this.log_("Sending REST request for "+_);const y=new XMLHttpRequest;y.onreadystatechange=()=>{if(r&&4===y.readyState){this.log_("REST Response for "+_+" received. status:",y.status,"response:",y.responseText);let N=null;if(y.status>=200&&y.status<300){try{N=(0,T.cI)(y.responseText)}catch(E){ye("Failed to parse JSON response for "+_+": "+y.responseText)}r(null,N)}else 401!==y.status&&404!==y.status&&ye("Got unsuccessful REST response for "+_+" Status: "+y.status),r(y.status);r=null}},y.open("GET",_,!0),y.send()})}}class Dn{constructor(){this.rootNode_=oe.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function $n(){return{value:null,children:new Map}}function Vt(n,e,t){if(le(e))n.value=t,n.children.clear();else if(null!==n.value)n.value=n.value.updateChild(e,t);else{const r=ae(e);n.children.has(r)||n.children.set(r,$n()),Vt(n.children.get(r),e=De(e),t)}}function hr(n,e){if(le(e))return n.value=null,n.children.clear(),!0;if(null!==n.value){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(Fe,(r,c)=>{Vt(n,new _e(r),c)}),hr(n,e)}}if(n.children.size>0){const t=ae(e);return e=De(e),n.children.has(t)&&hr(n.children.get(t),e)&&n.children.delete(t),0===n.children.size}return!0}function za(n,e,t){null!==n.value?t(e,n.value):function Vc(n,e){n.children.forEach((t,r)=>{e(r,t)})}(n,(r,c)=>{za(c,new _e(e.toString()+"/"+r),t)})}class ic{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Ve(this.last_,(r,c)=>{t[r]=t[r]-c}),this.last_=e,t}}class _s{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new ic(e);const r=1e4+2e4*Math.random();Vn(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;Ve(e,(c,p)=>{p>0&&(0,T.r3)(this.statsToReport_,c)&&(t[c]=p,r=!0)}),r&&this.server_.reportStats(t),Vn(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var bt=(()=>{return(n=bt||(bt={}))[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",bt;var n})();function vs(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class dn{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=bt.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(le(this.path)){if(null!=this.affectedTree.value)return(0,T.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new _e(e));return new dn(ge(),t,this.revert)}}return(0,T.hu)(ae(this.path)===e,"operationForChild called for unrelated child."),new dn(De(this.path),this.affectedTree,this.revert)}}class rt{constructor(e,t){this.source=e,this.path=t,this.type=bt.LISTEN_COMPLETE}operationForChild(e){return le(this.path)?new rt(this.source,ge()):new rt(this.source,De(this.path))}}class Rn{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=bt.OVERWRITE}operationForChild(e){return le(this.path)?new Rn(this.source,ge(),this.snap.getImmediateChild(e)):new Rn(this.source,De(this.path),this.snap)}}class ui{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=bt.MERGE}operationForChild(e){if(le(this.path)){const t=this.children.subtree(new _e(e));return t.isEmpty()?null:t.value?new Rn(this.source,ge(),t.value):new ui(this.source,ge(),t)}return(0,T.hu)(ae(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new ui(this.source,De(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class An{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(le(e))return this.isFullyInitialized()&&!this.filtered_;const t=ae(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class ys{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function hn(n,e,t,r,c,p){const _=r.filter(y=>y.type===t);_.sort((y,N)=>function qa(n,e,t){if(null==e.childName||null==t.childName)throw(0,T.g5)("Should only compare child_ events.");const r=new de(e.childName,e.snapshotNode),c=new de(t.childName,t.snapshotNode);return n.index_.compare(r,c)}(n,y,N)),_.forEach(y=>{const N=function Mo(n,e,t){return"value"===e.type||"child_removed"===e.type||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}(n,y,p);c.forEach(E=>{E.respondsTo(y.type)&&e.push(E.createEvent(N,n.query_))})})}function pr(n,e){return{eventCache:n,serverCache:e}}function kn(n,e,t,r){return pr(new An(e,t,r),n.serverCache)}function Po(n,e,t,r){return pr(n.eventCache,new An(e,t,r))}function Si(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function di(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let bs;class Se{constructor(e,t=(()=>(bs||(bs=new Et(Kr)),bs))()){this.value=e,this.children=t}static fromObject(e){let t=new Se(null);return Ve(e,(r,c)=>{t=t.set(new _e(r),c)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:ge(),value:this.value};if(le(e))return null;{const r=ae(e),c=this.children.get(r);if(null!==c){const p=c.findRootMostMatchingPathAndValue(De(e),t);return null!=p?{path:Me(new _e(r),p.path),value:p.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(le(e))return this;{const t=ae(e),r=this.children.get(t);return null!==r?r.subtree(De(e)):new Se(null)}}set(e,t){if(le(e))return new Se(t,this.children);{const r=ae(e),p=(this.children.get(r)||new Se(null)).set(De(e),t),_=this.children.insert(r,p);return new Se(this.value,_)}}remove(e){if(le(e))return this.children.isEmpty()?new Se(null):new Se(null,this.children);{const t=ae(e),r=this.children.get(t);if(r){const c=r.remove(De(e));let p;return p=c.isEmpty()?this.children.remove(t):this.children.insert(t,c),null===this.value&&p.isEmpty()?new Se(null):new Se(this.value,p)}return this}}get(e){if(le(e))return this.value;{const t=ae(e),r=this.children.get(t);return r?r.get(De(e)):null}}setTree(e,t){if(le(e))return t;{const r=ae(e),p=(this.children.get(r)||new Se(null)).setTree(De(e),t);let _;return _=p.isEmpty()?this.children.remove(r):this.children.insert(r,p),new Se(this.value,_)}}fold(e){return this.fold_(ge(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((c,p)=>{r[c]=p.fold_(Me(e,c),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,ge(),t)}findOnPath_(e,t,r){const c=!!this.value&&r(t,this.value);if(c)return c;if(le(e))return null;{const p=ae(e),_=this.children.get(p);return _?_.findOnPath_(De(e),Me(t,p),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,ge(),t)}foreachOnPath_(e,t,r){if(le(e))return this;{this.value&&r(t,this.value);const c=ae(e),p=this.children.get(c);return p?p.foreachOnPath_(De(e),Me(t,c),r):new Se(null)}}foreach(e){this.foreach_(ge(),e)}foreach_(e,t){this.children.inorderTraversal((r,c)=>{c.foreach_(Me(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}class fn{constructor(e){this.writeTree_=e}static empty(){return new fn(new Se(null))}}function Ri(n,e,t){if(le(e))return new fn(new Se(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(null!=r){const c=r.path;let p=r.value;const _=yt(c,e);return p=p.updateChild(_,t),new fn(n.writeTree_.set(c,p))}{const c=new Se(t),p=n.writeTree_.setTree(e,c);return new fn(p)}}}function gr(n,e,t){let r=n;return Ve(t,(c,p)=>{r=Ri(r,Me(e,c),p)}),r}function Ns(n,e){if(le(e))return fn.empty();{const t=n.writeTree_.setTree(e,new Se(null));return new fn(t)}}function xo(n,e){return null!=Yn(n,e)}function Yn(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return null!=t?n.writeTree_.get(t.path).getChild(yt(t.path,e)):null}function rc(n){const e=[],t=n.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(Fe,(r,c)=>{e.push(new de(r,c))}):n.writeTree_.children.inorderTraversal((r,c)=>{null!=c.value&&e.push(new de(r,c.value))}),e}function hi(n,e){if(le(e))return n;{const t=Yn(n,e);return new fn(null!=t?new Se(t):n.writeTree_.subtree(e))}}function Ts(n){return n.writeTree_.isEmpty()}function Ct(n,e){return Fo(ge(),n.writeTree_,e)}function Fo(n,e,t){if(null!=e.value)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((c,p)=>{".priority"===c?((0,T.hu)(null!==p.value,"Priority writes must always be leaf nodes"),r=p.value):t=Fo(Me(n,c),p,t)}),!t.getChild(n).isEmpty()&&null!==r&&(t=t.updateChild(Me(n,".priority"),r)),t}}function zn(n,e){return Ho(e,n)}function oc(n,e){if(n.snap)return wt(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&wt(Me(n.path,t),e))return!0;return!1}function ac(n){return n.visible}function pn(n,e,t){let r=fn.empty();for(let c=0;c<n.length;++c){const p=n[c];if(e(p)){const _=p.path;let y;if(p.snap)wt(t,_)?(y=yt(t,_),r=Ri(r,y,p.snap)):wt(_,t)&&(y=yt(_,t),r=Ri(r,ge(),p.snap.getChild(y)));else{if(!p.children)throw(0,T.g5)("WriteRecord should have .snap or .children");if(wt(t,_))y=yt(t,_),r=gr(r,y,p.children);else if(wt(_,t))if(y=yt(_,t),le(y))r=gr(r,ge(),p.children);else{const N=(0,T.DV)(p.children,ae(y));if(N){const E=N.getChild(De(y));r=Ri(r,ge(),E)}}}}}return r}function Cs(n,e,t,r,c){if(r||c){const p=hi(n.visibleWrites,e);return!c&&Ts(p)?t:c||null!=t||xo(p,ge())?Ct(pn(n.allWrites,function(E){return(E.visible||c)&&(!r||!~r.indexOf(E.writeId))&&(wt(E.path,e)||wt(e,E.path))},e),t||oe.EMPTY_NODE):null}{const p=Yn(n.visibleWrites,e);if(null!=p)return p;{const _=hi(n.visibleWrites,e);return Ts(_)?t:null!=t||xo(_,ge())?Ct(_,t||oe.EMPTY_NODE):null}}}function Bo(n,e,t,r){return Cs(n.writeTree,n.treePath,e,t,r)}function Go(n,e){return function Is(n,e,t){let r=oe.EMPTY_NODE;const c=Yn(n.visibleWrites,e);if(c)return c.isLeafNode()||c.forEachChild(Fe,(p,_)=>{r=r.updateImmediateChild(p,_)}),r;if(t){const p=hi(n.visibleWrites,e);return t.forEachChild(Fe,(_,y)=>{const N=Ct(hi(p,new _e(_)),y);r=r.updateImmediateChild(_,N)}),rc(p).forEach(_=>{r=r.updateImmediateChild(_.name,_.node)}),r}return rc(hi(n.visibleWrites,e)).forEach(_=>{r=r.updateImmediateChild(_.name,_.node)}),r}(n.writeTree,n.treePath,e)}function lc(n,e,t,r){return function $c(n,e,t,r,c){(0,T.hu)(r||c,"Either existingEventSnap or existingServerSnap must exist");const p=Me(e,t);if(xo(n.visibleWrites,p))return null;{const _=hi(n.visibleWrites,p);return Ts(_)?c.getChild(t):Ct(_,c.getChild(t))}}(n.writeTree,n.treePath,e,t,r)}function _r(n,e){return function Ai(n,e){return Yn(n.visibleWrites,e)}(n.writeTree,Me(n.treePath,e))}function Xa(n,e,t){return function Ja(n,e,t,r){const c=Me(e,t),p=Yn(n.visibleWrites,c);return null!=p?p:r.isCompleteForChild(t)?Ct(hi(n.visibleWrites,c),r.getNode().getImmediateChild(t)):null}(n.writeTree,n.treePath,e,t)}function uc(n,e){return Ho(Me(n.treePath,e),n.writeTree)}function Ho(n,e){return{treePath:n,writeTree:e}}class Yc{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;(0,T.hu)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,T.hu)(".priority"!==r,"Only non-priority child changes can be tracked.");const c=this.changeMap.get(r);if(c){const p=c.type;if("child_added"===t&&"child_removed"===p)this.changeMap.set(r,ai(r,e.snapshotNode,c.snapshotNode));else if("child_removed"===t&&"child_added"===p)this.changeMap.delete(r);else if("child_removed"===t&&"child_changed"===p)this.changeMap.set(r,gs(r,c.oldSnap));else if("child_changed"===t&&"child_added"===p)this.changeMap.set(r,cr(r,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==p)throw(0,T.g5)("Illegal combination of changes: "+e+" occurred after "+c);this.changeMap.set(r,ai(r,e.snapshotNode,c.oldSnap))}}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}const tl=new class el{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}};class mr{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=null!=this.optCompleteServerCache_?new An(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Xa(this.writes_,e,r)}}getChildAfterChild(e,t,r){const c=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:di(this.viewCache_),p=function cc(n,e,t,r,c,p){return function gt(n,e,t,r,c,p,_){let y;const N=hi(n.visibleWrites,e),E=Yn(N,ge());if(null!=E)y=E;else{if(null==t)return[];y=Ct(N,t)}if(y=y.withIndex(_),y.isEmpty()||y.isLeafNode())return[];{const R=[],S=_.getCompare(),O=p?y.getReverseIteratorFrom(r,_):y.getIteratorFrom(r,_);let j=O.getNext();for(;j&&R.length<c;)0!==S(j,r)&&R.push(j),j=O.getNext();return R}}(n.writeTree,n.treePath,e,t,r,c,p)}(this.writes_,c,t,1,r,e);return 0===p.length?null:p[0]}}function il(n,e,t,r,c,p){const _=e.eventCache;if(null!=_r(r,t))return e;{let y,N;if(le(t))if((0,T.hu)(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const E=di(e),S=Go(r,E instanceof oe?E:oe.EMPTY_NODE);y=n.filter.updateFullNode(e.eventCache.getNode(),S,p)}else{const E=Bo(r,di(e));y=n.filter.updateFullNode(e.eventCache.getNode(),E,p)}else{const E=ae(t);if(".priority"===E){(0,T.hu)(1===an(t),"Can't have a priority with additional path components");const R=_.getNode();N=e.serverCache.getNode();const S=lc(r,t,R,N);y=null!=S?n.filter.updatePriority(R,S):_.getNode()}else{const R=De(t);let S;if(_.isCompleteForChild(E)){N=e.serverCache.getNode();const O=lc(r,t,_.getNode(),N);S=null!=O?_.getNode().getImmediateChild(E).updateChild(R,O):_.getNode().getImmediateChild(E)}else S=Xa(r,E,e.serverCache);y=null!=S?n.filter.updateChild(_.getNode(),E,S,R,c,p):_.getNode()}}return kn(e,y,_.isFullyInitialized()||le(t),n.filter.filtersNodes())}}function vr(n,e,t,r,c,p,_,y){const N=e.serverCache;let E;const R=_?n.filter:n.filter.getIndexedFilter();if(le(t))E=R.updateFullNode(N.getNode(),r,null);else if(R.filtersNodes()&&!N.isFiltered()){const j=N.getNode().updateChild(t,r);E=R.updateFullNode(N.getNode(),j,null)}else{const j=ae(t);if(!N.isCompleteForPath(t)&&an(t)>1)return e;const K=De(t),tt=N.getNode().getImmediateChild(j).updateChild(K,r);E=".priority"===j?R.updatePriority(N.getNode(),tt):R.updateChild(N.getNode(),j,tt,K,tl,null)}const S=Po(e,E,N.isFullyInitialized()||le(t),R.filtersNodes());return il(n,S,t,c,new mr(c,S,p),y)}function Ds(n,e,t,r,c,p,_){const y=e.eventCache;let N,E;const R=new mr(c,e,p);if(le(t))E=n.filter.updateFullNode(e.eventCache.getNode(),r,_),N=kn(e,E,!0,n.filter.filtersNodes());else{const S=ae(t);if(".priority"===S)E=n.filter.updatePriority(e.eventCache.getNode(),r),N=kn(e,E,y.isFullyInitialized(),y.isFiltered());else{const O=De(t),j=y.getNode().getImmediateChild(S);let K;if(le(O))K=r;else{const me=R.getCompleteChild(S);K=null!=me?".priority"===yo(O)&&me.getChild(as(O)).isEmpty()?me:me.updateChild(O,r):oe.EMPTY_NODE}N=j.equals(K)?e:kn(e,n.filter.updateChild(y.getNode(),S,K,O,R,_),y.isFullyInitialized(),n.filter.filtersNodes())}}return N}function Ss(n,e){return n.eventCache.isCompleteForChild(e)}function rl(n,e,t){return t.foreach((r,c)=>{e=e.updateChild(r,c)}),e}function Wo(n,e,t,r,c,p,_,y){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let E,N=e;E=le(t)?r:new Se(null).setTree(t,r);const R=e.serverCache.getNode();return E.children.inorderTraversal((S,O)=>{if(R.hasChild(S)){const K=rl(0,e.serverCache.getNode().getImmediateChild(S),O);N=vr(n,N,new _e(S),K,c,p,_,y)}}),E.children.inorderTraversal((S,O)=>{const j=!e.serverCache.isCompleteForChild(S)&&void 0===O.value;if(!R.hasChild(S)&&!j){const me=rl(0,e.serverCache.getNode().getImmediateChild(S),O);N=vr(n,N,new _e(S),me,c,p,_,y)}}),N}class Qc{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,c=new ja(r.getIndex()),p=function tc(n){return n.loadsAllData()?new ja(n.getIndex()):n.hasLimit()?new $a(n):new li(n)}(r);this.processor_=function nl(n){return{filter:n}}(p);const _=t.serverCache,y=t.eventCache,N=c.updateFullNode(oe.EMPTY_NODE,_.getNode(),null),E=p.updateFullNode(oe.EMPTY_NODE,y.getNode(),null),R=new An(N,_.isFullyInitialized(),c.filtersNodes()),S=new An(E,y.isFullyInitialized(),p.filtersNodes());this.viewCache_=pr(S,R),this.eventGenerator_=new ys(this.query_)}get query(){return this.query_}}function st(n,e){const t=di(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!le(e)&&!t.getImmediateChild(ae(e)).isEmpty())?t.getChild(e):null}function dc(n){return 0===n.eventRegistrations_.length}function hc(n,e,t){const r=[];if(t){(0,T.hu)(null==e,"A cancel should cancel all event registrations.");const c=n.query._path;n.eventRegistrations_.forEach(p=>{const _=p.createCancelEvent(t,c);_&&r.push(_)})}if(e){let c=[];for(let p=0;p<n.eventRegistrations_.length;++p){const _=n.eventRegistrations_[p];if(_.matches(e)){if(e.hasAnyCallback()){c=c.concat(n.eventRegistrations_.slice(p+1));break}}else c.push(_)}n.eventRegistrations_=c}else n.eventRegistrations_=[];return r}function $o(n,e,t,r){e.type===bt.MERGE&&null!==e.source.queryId&&((0,T.hu)(di(n.viewCache_),"We should always have a full cache before handling merges"),(0,T.hu)(Si(n.viewCache_),"Missing event cache, even though we have a server cache"));const c=n.viewCache_,p=function Vo(n,e,t,r,c){const p=new Yc;let _,y;if(t.type===bt.OVERWRITE){const E=t;E.source.fromUser?_=Ds(n,e,E.path,E.snap,r,c,p):((0,T.hu)(E.source.fromServer,"Unknown source."),y=E.source.tagged||e.serverCache.isFiltered()&&!le(E.path),_=vr(n,e,E.path,E.snap,r,c,y,p))}else if(t.type===bt.MERGE){const E=t;E.source.fromUser?_=function Kc(n,e,t,r,c,p,_){let y=e;return r.foreach((N,E)=>{const R=Me(t,N);Ss(e,ae(R))&&(y=Ds(n,y,R,E,c,p,_))}),r.foreach((N,E)=>{const R=Me(t,N);Ss(e,ae(R))||(y=Ds(n,y,R,E,c,p,_))}),y}(n,e,E.path,E.children,r,c,p):((0,T.hu)(E.source.fromServer,"Unknown source."),y=E.source.tagged||e.serverCache.isFiltered(),_=Wo(n,e,E.path,E.children,r,c,y,p))}else if(t.type===bt.ACK_USER_WRITE){const E=t;_=E.revert?function jo(n,e,t,r,c,p){let _;if(null!=_r(r,t))return e;{const y=new mr(r,e,c),N=e.eventCache.getNode();let E;if(le(t)||".priority"===ae(t)){let R;if(e.serverCache.isFullyInitialized())R=Bo(r,di(e));else{const S=e.serverCache.getNode();(0,T.hu)(S instanceof oe,"serverChildren would be complete if leaf node"),R=Go(r,S)}R=R,E=n.filter.updateFullNode(N,R,p)}else{const R=ae(t);let S=Xa(r,R,e.serverCache);null==S&&e.serverCache.isCompleteForChild(R)&&(S=N.getImmediateChild(R)),E=null!=S?n.filter.updateChild(N,R,S,De(t),y,p):e.eventCache.getNode().hasChild(R)?n.filter.updateChild(N,R,oe.EMPTY_NODE,De(t),y,p):N,E.isEmpty()&&e.serverCache.isFullyInitialized()&&(_=Bo(r,di(e)),_.isLeafNode()&&(E=n.filter.updateFullNode(E,_,p)))}return _=e.serverCache.isFullyInitialized()||null!=_r(r,ge()),kn(e,E,_,n.filter.filtersNodes())}}(n,e,E.path,r,c,p):function qc(n,e,t,r,c,p,_){if(null!=_r(c,t))return e;const y=e.serverCache.isFiltered(),N=e.serverCache;if(null!=r.value){if(le(t)&&N.isFullyInitialized()||N.isCompleteForPath(t))return vr(n,e,t,N.getNode().getChild(t),c,p,y,_);if(le(t)){let E=new Se(null);return N.getNode().forEachChild(ln,(R,S)=>{E=E.set(new _e(R),S)}),Wo(n,e,t,E,c,p,y,_)}return e}{let E=new Se(null);return r.foreach((R,S)=>{const O=Me(t,R);N.isCompleteForPath(O)&&(E=E.set(R,N.getNode().getChild(O)))}),Wo(n,e,t,E,c,p,y,_)}}(n,e,E.path,E.affectedTree,r,c,p)}else{if(t.type!==bt.LISTEN_COMPLETE)throw(0,T.g5)("Unknown operation type: "+t.type);_=function Jc(n,e,t,r,c){const p=e.serverCache;return il(n,Po(e,p.getNode(),p.isFullyInitialized()||le(t),p.isFiltered()),t,r,tl,c)}(n,e,t.path,r,p)}const N=p.getChanges();return function Zc(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const c=r.getNode().isLeafNode()||r.getNode().isEmpty(),p=Si(n);(t.length>0||!n.eventCache.isFullyInitialized()||c&&!r.getNode().equals(p)||!r.getNode().getPriority().equals(p.getPriority()))&&t.push(Wa(Si(e)))}}(e,_,N),{viewCache:_,changes:N}}(n.processor_,c,e,t,r);return function zc(n,e){(0,T.hu)(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),(0,T.hu)(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}(n.processor_,p.viewCache),(0,T.hu)(p.viewCache.serverCache.isFullyInitialized()||!c.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=p.viewCache,yr(n,p.changes,p.viewCache.eventCache.getNode(),null)}function yr(n,e,t,r){return function Wc(n,e,t,r){const c=[],p=[];return e.forEach(_=>{"child_changed"===_.type&&n.index_.indexedValueChanged(_.oldSnap,_.snapshotNode)&&p.push(function ko(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}(_.childName,_.snapshotNode))}),hn(n,c,"child_removed",e,r,t),hn(n,c,"child_added",e,r,t),hn(n,c,"child_moved",p,r,t),hn(n,c,"child_changed",e,r,t),hn(n,c,"value",e,r,t),c}(n.eventGenerator_,e,t,r?[r]:n.eventRegistrations_)}let br,Nr;class Rs{constructor(){this.views=new Map}}function As(n,e,t,r){const c=e.source.queryId;if(null!==c){const p=n.views.get(c);return(0,T.hu)(null!=p,"SyncTree gave us an op for an invalid query."),$o(p,e,t,r)}{let p=[];for(const _ of n.views.values())p=p.concat($o(_,e,t,r));return p}}function al(n,e,t,r,c){const _=n.views.get(e._queryIdentifier);if(!_){let y=Bo(t,c?r:null),N=!1;y?N=!0:r instanceof oe?(y=Go(t,r),N=!1):(y=oe.EMPTY_NODE,N=!1);const E=pr(new An(y,N,!1),new An(r,c,!1));return new Qc(e,E)}return _}function cl(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Zn(n,e){let t=null;for(const r of n.views.values())t=t||st(r,e);return t}function ul(n,e){return e._queryParams.loadsAllData()?Os(n):n.views.get(e._queryIdentifier)}function ks(n,e){return null!=ul(n,e)}function Kn(n){return null!=Os(n)}function Os(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let dl=1;class Ko{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Se(null),this.pendingWriteTree_=function Qa(){return{visibleWrites:fn.empty(),allWrites:[],lastWriteId:-1}}(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function qo(n,e,t,r,c){return function ws(n,e,t,r,c){(0,T.hu)(r>n.lastWriteId,"Stacking an older write on top of newer ones"),void 0===c&&(c=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:c}),c&&(n.visibleWrites=Ri(n.visibleWrites,e,t)),n.lastWriteId=r}(n.pendingWriteTree_,e,t,r,c),c?Tr(n,new Rn({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,t)):[]}function pi(n,e,t=!1){const r=function sc(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}(n.pendingWriteTree_,e);if(function Uo(n,e){const t=n.allWrites.findIndex(y=>y.writeId===e);(0,T.hu)(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let c=r.visible,p=!1,_=n.allWrites.length-1;for(;c&&_>=0;){const y=n.allWrites[_];y.visible&&(_>=t&&oc(y,r.path)?c=!1:wt(r.path,y.path)&&(p=!0)),_--}return!!c&&(p?(function Es(n){n.visibleWrites=pn(n.allWrites,ac,ge()),n.lastWriteId=n.allWrites.length>0?n.allWrites[n.allWrites.length-1].writeId:-1}(n),!0):(r.snap?n.visibleWrites=Ns(n.visibleWrites,r.path):Ve(r.children,N=>{n.visibleWrites=Ns(n.visibleWrites,Me(r.path,N))}),!0))}(n.pendingWriteTree_,e)){let p=new Se(null);return null!=r.snap?p=p.set(ge(),!0):Ve(r.children,_=>{p=p.set(new _e(_),!0)}),Tr(n,new dn(r.path,p,t))}return[]}function Ps(n,e,t){return Tr(n,new Rn({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,t))}function fl(n,e,t,r){const c=e._path,p=n.syncPointTree_.get(c);let _=[];if(p&&("default"===e._queryIdentifier||ks(p,e))){const y=function Zo(n,e,t,r){const c=e._queryIdentifier,p=[];let _=[];const y=Kn(n);if("default"===c)for(const[N,E]of n.views.entries())_=_.concat(hc(E,t,r)),dc(E)&&(n.views.delete(N),E.query._queryParams.loadsAllData()||p.push(E.query));else{const N=n.views.get(c);N&&(_=_.concat(hc(N,t,r)),dc(N)&&(n.views.delete(c),N.query._queryParams.loadsAllData()||p.push(N.query)))}return y&&!Kn(n)&&p.push(new(function Yo(){return(0,T.hu)(br,"Reference.ts has not been loaded"),br}())(e._repo,e._path)),{removed:p,events:_}}(p,e,t,r);(function zo(n){return 0===n.views.size})(p)&&(n.syncPointTree_=n.syncPointTree_.remove(c));const N=y.removed;_=y.events;const E=-1!==N.findIndex(S=>S._queryParams.loadsAllData()),R=n.syncPointTree_.findOnPath(c,(S,O)=>Kn(O));if(E&&!R){const S=n.syncPointTree_.subtree(c);if(!S.isEmpty()){const O=function ru(n){return n.fold((e,t,r)=>{if(t&&Kn(t))return[Os(t)];{let c=[];return t&&(c=cl(t)),Ve(r,(p,_)=>{c=c.concat(_)}),c}})}(S);for(let j=0;j<O.length;++j){const K=O[j],me=K.query,tt=bc(n,K);n.listenProvider_.startListening(ki(me),wr(n,me),tt.hashFn,tt.onComplete)}}}!R&&N.length>0&&!r&&(E?n.listenProvider_.stopListening(ki(e),null):N.forEach(S=>{const O=n.queryToTagMap.get(Qo(S));n.listenProvider_.stopListening(ki(S),O)})),function su(n,e){for(let t=0;t<e.length;++t){const r=e[t];if(!r._queryParams.loadsAllData()){const c=Qo(r),p=n.queryToTagMap.get(c);n.queryToTagMap.delete(c),n.tagToQueryMap.delete(p)}}}(n,N)}return _}function _c(n,e,t){const r=e._path;let c=null,p=!1;n.syncPointTree_.foreachOnPath(r,(S,O)=>{const j=yt(S,r);c=c||Zn(O,j),p=p||Kn(O)});let y,_=n.syncPointTree_.get(r);_?(p=p||Kn(_),c=c||Zn(_,ge())):(_=new Rs,n.syncPointTree_=n.syncPointTree_.set(r,_)),null!=c?y=!0:(y=!1,c=oe.EMPTY_NODE,n.syncPointTree_.subtree(r).foreachChild((O,j)=>{const K=Zn(j,ge());K&&(c=c.updateImmediateChild(O,K))}));const N=ks(_,e);if(!N&&!e._queryParams.loadsAllData()){const S=Qo(e);(0,T.hu)(!n.queryToTagMap.has(S),"View does not exist, but we have a tag");const O=function Nc(){return dl++}();n.queryToTagMap.set(S,O),n.tagToQueryMap.set(O,S)}let R=function ll(n,e,t,r,c,p){const _=al(n,e,r,c,p);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,_),function ol(n,e){n.eventRegistrations_.push(e)}(_,t),function fi(n,e){const t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Fe,(p,_)=>{r.push(cr(p,_))}),t.isFullyInitialized()&&r.push(Wa(t.getNode())),yr(n,r,t.getNode(),e)}(_,t)}(_,e,t,zn(n.pendingWriteTree_,r),c,y);if(!N&&!p){const S=ul(_,e);R=R.concat(function ea(n,e,t){const r=e._path,c=wr(n,e),p=bc(n,t),_=n.listenProvider_.startListening(ki(e),c,p.hashFn,p.onComplete),y=n.syncPointTree_.subtree(r);if(c)(0,T.hu)(!Kn(y.value),"If we're adding a query, it shouldn't be shadowed");else{const N=y.fold((E,R,S)=>{if(!le(E)&&R&&Kn(R))return[Os(R).query];{let O=[];return R&&(O=O.concat(cl(R).map(j=>j.query))),Ve(S,(j,K)=>{O=O.concat(K)}),O}});for(let E=0;E<N.length;++E){const R=N[E];n.listenProvider_.stopListening(ki(R),wr(n,R))}}return _}(n,e,S))}return R}function Jo(n,e,t){const c=n.pendingWriteTree_,p=n.syncPointTree_.findOnPath(e,(_,y)=>{const E=Zn(y,yt(_,e));if(E)return E});return Cs(c,e,p,t,!0)}function Tr(n,e){return vc(e,n.syncPointTree_,null,zn(n.pendingWriteTree_,ge()))}function vc(n,e,t,r){if(le(n.path))return yc(n,e,t,r);{const c=e.get(ge());null==t&&null!=c&&(t=Zn(c,ge()));let p=[];const _=ae(n.path),y=n.operationForChild(_),N=e.children.get(_);if(N&&y){const E=t?t.getImmediateChild(_):null,R=uc(r,_);p=p.concat(vc(y,N,E,R))}return c&&(p=p.concat(As(c,n,r,t))),p}}function yc(n,e,t,r){const c=e.get(ge());null==t&&null!=c&&(t=Zn(c,ge()));let p=[];return e.children.inorderTraversal((_,y)=>{const N=t?t.getImmediateChild(_):null,E=uc(r,_),R=n.operationForChild(_);R&&(p=p.concat(yc(R,y,N,E)))}),c&&(p=p.concat(As(c,n,r,t))),p}function bc(n,e){const t=e.query,r=wr(n,t);return{hashFn:()=>(function Xc(n){return n.viewCache_.serverCache.getNode()}(e)||oe.EMPTY_NODE).hash(),onComplete:c=>{if("ok"===c)return r?function hl(n,e,t){const r=Er(n,t);if(r){const c=pl(r),p=c.path,_=c.queryId,y=yt(p,e);return Xo(n,p,new rt(vs(_),y))}return[]}(n,t._path,r):function tu(n,e){return Tr(n,new rt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e))}(n,t._path);{const p=function eo(n,e){let t="Unknown Error";"too_big"===n?t="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===n?t="Client doesn't have permission to access the desired data.":"unavailable"===n&&(t="The service is unavailable");const r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}(c,t);return fl(n,t,null,p)}}}}function wr(n,e){const t=Qo(e);return n.queryToTagMap.get(t)}function Qo(n){return n._path.toString()+"$"+n._queryIdentifier}function Er(n,e){return n.tagToQueryMap.get(e)}function pl(n){const e=n.indexOf("$");return(0,T.hu)(-1!==e&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new _e(n.substr(0,e))}}function Xo(n,e,t){const r=n.syncPointTree_.get(e);return(0,T.hu)(r,"Missing sync point for query tag that we're tracking"),As(r,t,zn(n.pendingWriteTree_,e),null)}function ki(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(function Ms(){return(0,T.hu)(Nr,"Reference.ts has not been loaded"),Nr}())(n._repo,n._path):n}class gl{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new gl(t)}node(){return this.node_}}class Mt{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Me(this.path_,e);return new Mt(this.syncTree_,t)}node(){return Jo(this.syncTree_,this.path_)}}const ta=function(n,e,t){return n&&"object"==typeof n?((0,T.hu)(".sv"in n,"Unexpected leaf node or priority contents"),"string"==typeof n[".sv"]?qn(n[".sv"],e,t):"object"==typeof n[".sv"]?na(n[".sv"],e):void(0,T.hu)(!1,"Unexpected server value: "+JSON.stringify(n,null,2))):n},qn=function(n,e,t){if("timestamp"===n)return t.timestamp;(0,T.hu)(!1,"Unexpected server value: "+n)},na=function(n,e,t){n.hasOwnProperty("increment")||(0,T.hu)(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;"number"!=typeof r&&(0,T.hu)(!1,"Unexpected increment value: "+r);const c=e.node();if((0,T.hu)(null!=c,"Expected ChildrenNode.EMPTY_NODE for nulls"),!c.isLeafNode())return r;const _=c.getValue();return"number"!=typeof _?r:_+r},_l=function(n,e,t,r){return Ir(e,new Mt(t,n),r)},Cr=function(n,e,t){return Ir(n,new gl(e),t)};function Ir(n,e,t){const r=n.getPriority().val(),c=ta(r,e.getImmediateChild(".priority"),t);let p;if(n.isLeafNode()){const _=n,y=ta(_.getValue(),e,t);return y!==_.getValue()||c!==_.getPriority().val()?new Ci(y,Ke(c)):n}{const _=n;return p=_,c!==_.getPriority().val()&&(p=p.updatePriority(new Ci(c))),_.forEachChild(Fe,(y,N)=>{const E=Ir(N,e.getImmediateChild(y),t);E!==N&&(p=p.updateImmediateChild(y,E))}),p}}class xs{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function Jn(n,e){let t=e instanceof _e?e:new _e(e),r=n,c=ae(t);for(;null!==c;){const p=(0,T.DV)(r.node.children,c)||{children:{},childCount:0};r=new xs(c,r,p),t=De(t),c=ae(t)}return r}function gn(n){return n.node.value}function Oi(n,e){n.node.value=e,gi(n)}function ml(n){return n.node.childCount>0}function Mi(n,e){Ve(n.node.children,(t,r)=>{e(new xs(t,n,r))})}function vl(n,e,t,r){t&&!r&&e(n),Mi(n,c=>{vl(c,e,!0,r)}),t&&r&&e(n)}function Jt(n){return new _e(null===n.parent?n.name:Jt(n.parent)+"/"+n.name)}function gi(n){null!==n.parent&&function Fs(n,e,t){const r=function Tc(n){return void 0===gn(n)&&!ml(n)}(t),c=(0,T.r3)(n.node.children,e);r&&c?(delete n.node.children[e],n.node.childCount--,gi(n)):!r&&!c&&(n.node.children[e]=t.node,n.node.childCount++,gi(n))}(n.parent,n.name,n)}const ia=/[\[\].#$\/\u0000-\u001F\u007F]/,xi=/[\[\].#$\u0000-\u001F\u007F]/,On=10485760,Dr=function(n){return"string"==typeof n&&0!==n.length&&!ia.test(n)},ra=function(n){return"string"==typeof n&&0!==n.length&&!xi.test(n)},Ls=function(n){return null===n||"string"==typeof n||"number"==typeof n&&!pt(n)||n&&"object"==typeof n&&(0,T.r3)(n,".sv")},Mn=function(n,e,t,r){r&&void 0===e||_i((0,T.gK)(n,"value"),e,t)},_i=function(n,e,t){const r=t instanceof _e?new $l(t,n):t;if(void 0===e)throw new Error(n+"contains undefined "+Cn(r));if("function"==typeof e)throw new Error(n+"contains a function "+Cn(r)+" with contents = "+e.toString());if(pt(e))throw new Error(n+"contains "+e.toString()+" "+Cn(r));if("string"==typeof e&&e.length>On/3&&(0,T.ug)(e)>On)throw new Error(n+"contains a string greater than "+On+" utf8 bytes "+Cn(r)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let c=!1,p=!1;if(Ve(e,(_,y)=>{if(".value"===_)c=!0;else if(".priority"!==_&&".sv"!==_&&(p=!0,!Dr(_)))throw new Error(n+" contains an invalid key ("+_+") "+Cn(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');(function xa(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=(0,T.ug)(e),No(n)})(r,_),_i(n,y,r),function Lc(n){const e=n.parts_.pop();n.byteLength_-=(0,T.ug)(e),n.parts_.length>0&&(n.byteLength_-=1)}(r)}),c&&p)throw new Error(n+' contains ".value" child '+Cn(r)+" in addition to actual children.")}},wc=function(n,e,t,r){if(r&&void 0===e)return;const c=(0,T.gK)(n,"values");if(!e||"object"!=typeof e||Array.isArray(e))throw new Error(c+" must be an object containing the children to replace.");const p=[];Ve(e,(_,y)=>{const N=new _e(_);if(_i(c,y,Me(t,N)),".priority"===yo(N)&&!Ls(y))throw new Error(c+"contains an invalid value for '"+N.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");p.push(N)}),function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];const p=wi(r);for(let _=0;_<p.length;_++)if((".priority"!==p[_]||_!==p.length-1)&&!Dr(p[_]))throw new Error(n+"contains an invalid key ("+p[_]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}e.sort(Pa);let c=null;for(t=0;t<e.length;t++){if(r=e[t],null!==c&&wt(c,r))throw new Error(n+"contains a path "+c.toString()+" that is ancestor of another path "+r.toString());c=r}}(c,p)},bl=function(n,e,t){if(!t||void 0!==e){if(pt(e))throw new Error((0,T.gK)(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Ls(e))throw new Error((0,T.gK)(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Sr=function(n,e,t,r){if(!(r&&void 0===t||Dr(t)))throw new Error((0,T.gK)(n,e)+'was an invalid key = "'+t+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},Us=function(n,e,t,r){if(!(r&&void 0===t||ra(t)))throw new Error((0,T.gK)(n,e)+'was an invalid path = "'+t+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Qt=function(n,e){if(".info"===ae(e))throw new Error(n+" failed = Can't modify data under /.info/")},Ec=function(n,e){const t=e.path.toString();if("string"!=typeof e.repoInfo.host||0===e.repoInfo.host.length||!Dr(e.repoInfo.namespace)&&"localhost"!==e.repoInfo.host.split(":")[0]||0!==t.length&&!function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),ra(n)}(t))throw new Error((0,T.gK)(n,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class sa{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function oa(n,e){let t=null;for(let r=0;r<e.length;r++){const c=e[r],p=c.getPath();null!==t&&!bo(p,t.path)&&(n.eventLists_.push(t),t=null),null===t&&(t={events:[],path:p}),t.events.push(c)}t&&n.eventLists_.push(t)}function Rr(n,e,t){oa(n,t),aa(n,r=>bo(r,e))}function Wt(n,e,t){oa(n,t),aa(n,r=>wt(r,e)||wt(e,r))}function aa(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const c=n.eventLists_[r];c&&(e(c.path)?(Nl(n.eventLists_[r]),n.eventLists_[r]=null):t=!1)}t&&(n.eventLists_=[]),n.recursionDepth_--}function Nl(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(null!==t){n.events[e]=null;const r=t.getEventRunner();si&&Ye("event: "+t.toString()),Kt(r)}}}const la="repo_interrupt";class ca{constructor(e,t,r,c){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=c,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new sa,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=$n(),this.transactionQueueTree_=new xs,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Tl(n){const t=n.infoData_.getNode(new _e(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Li(n){return function(n){return(n=n||{}).timestamp=n.timestamp||(new Date).getTime(),n}({timestamp:Tl(n)})}function _n(n,e,t,r,c){n.dataUpdateCount++;const p=new _e(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let _=[];if(c)if(r){const N=(0,T.UI)(t,E=>Ke(E));_=function iu(n,e,t,r){const c=Er(n,r);if(c){const p=pl(c),_=p.path,y=p.queryId,N=yt(_,e),E=Se.fromObject(t);return Xo(n,_,new ui(vs(y),N,E))}return[]}(n.serverSyncTree_,p,N,c)}else{const N=Ke(t);_=function nu(n,e,t,r){const c=Er(n,r);if(null!=c){const p=pl(c),_=p.path,y=p.queryId,N=yt(_,e);return Xo(n,_,new Rn(vs(y),N,t))}return[]}(n.serverSyncTree_,p,N,c)}else if(r){const N=(0,T.UI)(t,E=>Ke(E));_=function gc(n,e,t){const r=Se.fromObject(t);return Tr(n,new ui({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,r))}(n.serverSyncTree_,p,N)}else{const N=Ke(t);_=Ps(n.serverSyncTree_,p,N)}let y=p;_.length>0&&(y=Ui(n,p)),Wt(n.eventQueue_,y,_)}function Cc(n,e){Qn(n,"connected",e),!1===e&&function Ic(n){qe(n,"onDisconnectEvents");const e=Li(n),t=$n();za(n.onDisconnect_,ge(),(c,p)=>{const _=_l(c,p,n.serverSyncTree_,e);Vt(t,c,_)});let r=[];za(t,ge(),(c,p)=>{r=r.concat(Ps(n.serverSyncTree_,c,p));const _=Hs(n,c);Ui(n,_)}),n.onDisconnect_=$n(),Wt(n.eventQueue_,ge(),r)}(n)}function Qn(n,e,t){const r=new _e("/.info/"+e),c=Ke(t);n.infoData_.updateSnapshot(r,c);const p=Ps(n.infoSyncTree_,r,c);Wt(n.eventQueue_,r,p)}function kr(n){return n.nextWriteId_++}function Mr(n,e,t,r,c){qe(n,"set",{path:e.toString(),value:t,priority:r});const p=Li(n),_=Ke(t,r),y=Jo(n.serverSyncTree_,e),N=Cr(_,y,p),E=kr(n),R=qo(n.serverSyncTree_,e,N,E,!0);oa(n.eventQueue_,R),n.server_.put(e.toString(),_.val(!0),(O,j)=>{const K="ok"===O;K||ye("set at "+e+" failed: "+O);const me=pi(n.serverSyncTree_,E,!K);Wt(n.eventQueue_,e,me),Xt(0,c,O,j)});const S=Hs(n,e);Ui(n,S),Wt(n.eventQueue_,S,[])}function wl(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,c)=>{"ok"===r&&hr(n.onDisconnect_,e),Xt(0,t,r,c)})}function da(n,e,t,r){const c=Ke(t);n.server_.onDisconnectPut(e.toString(),c.val(!0),(p,_)=>{"ok"===p&&Vt(n.onDisconnect_,e,c),Xt(0,r,p,_)})}function ha(n,e,t){let r;r=".info"===ae(e._path)?fl(n.infoSyncTree_,e,t):fl(n.serverSyncTree_,e,t),Rr(n.eventQueue_,e._path,r)}function fa(n){n.persistentConnection_&&n.persistentConnection_.interrupt(la)}function qe(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Ye(t,...e)}function Xt(n,e,t,r){e&&Kt(()=>{if("ok"===t)e(null);else{const c=(t||"error").toUpperCase();let p=c;r&&(p+=": "+r);const _=new Error(p);_.code=c,e(_)}})}function ga(n,e,t){return Jo(n.serverSyncTree_,e,t)||oe.EMPTY_NODE}function It(n,e=n.transactionQueueTree_){if(e||xr(n,e),gn(e)){const t=Pr(n,e);(0,T.hu)(t.length>0,"Sending zero length transaction queue"),t.every(c=>0===c.status)&&function Gs(n,e,t){const r=t.map(E=>E.currentWriteId),c=ga(n,e,r);let p=c;const _=c.hash();for(let E=0;E<t.length;E++){const R=t[E];(0,T.hu)(0===R.status,"tryToSendTransactionQueue_: items in queue should all be run."),R.status=1,R.retryCount++;const S=yt(e,R.path);p=p.updateChild(S,R.currentOutputSnapshotRaw)}const y=p.val(!0),N=e;n.server_.put(N.toString(),y,E=>{qe(n,"transaction put response",{path:N.toString(),status:E});let R=[];if("ok"===E){const S=[];for(let O=0;O<t.length;O++)t[O].status=2,R=R.concat(pi(n.serverSyncTree_,t[O].currentWriteId)),t[O].onComplete&&S.push(()=>t[O].onComplete(null,!0,t[O].currentOutputSnapshotResolved)),t[O].unwatcher();xr(n,Jn(n.transactionQueueTree_,e)),It(n,n.transactionQueueTree_),Wt(n.eventQueue_,e,R);for(let O=0;O<S.length;O++)Kt(S[O])}else{if("datastale"===E)for(let S=0;S<t.length;S++)t[S].status=3===t[S].status?4:0;else{ye("transaction at "+N.toString()+" failed: "+E);for(let S=0;S<t.length;S++)t[S].status=4,t[S].abortReason=E}Ui(n,e)}},_)}(n,Jt(e),t)}else ml(e)&&Mi(e,t=>{It(n,t)})}function Ui(n,e){const t=Il(n,e),r=Jt(t);return function _a(n,e,t){if(0===e.length)return;const r=[];let c=[];const _=e.filter(y=>0===y.status).map(y=>y.currentWriteId);for(let y=0;y<e.length;y++){const N=e[y],E=yt(t,N.path);let S,R=!1;if((0,T.hu)(null!==E,"rerunTransactionsUnderNode_: relativePath should not be null."),4===N.status)R=!0,S=N.abortReason,c=c.concat(pi(n.serverSyncTree_,N.currentWriteId,!0));else if(0===N.status)if(N.retryCount>=25)R=!0,S="maxretry",c=c.concat(pi(n.serverSyncTree_,N.currentWriteId,!0));else{const O=ga(n,N.path,_);N.currentInputSnapshot=O;const j=e[y].update(O.val());if(void 0!==j){_i("transaction failed: Data returned ",j,N.path);let K=Ke(j);"object"==typeof j&&null!=j&&(0,T.r3)(j,".priority")||(K=K.updatePriority(O.getPriority()));const tt=N.currentWriteId,ei=Li(n),Fn=Cr(K,O,ei);N.currentOutputSnapshotRaw=K,N.currentOutputSnapshotResolved=Fn,N.currentWriteId=kr(n),_.splice(_.indexOf(tt),1),c=c.concat(qo(n.serverSyncTree_,N.path,Fn,N.currentWriteId,N.applyLocally)),c=c.concat(pi(n.serverSyncTree_,tt,!0))}else R=!0,S="nodata",c=c.concat(pi(n.serverSyncTree_,N.currentWriteId,!0))}Wt(n.eventQueue_,t,c),c=[],R&&(e[y].status=2,setTimeout(e[y].unwatcher,Math.floor(0)),e[y].onComplete&&r.push("nodata"===S?()=>e[y].onComplete(null,!1,e[y].currentInputSnapshot):()=>e[y].onComplete(new Error(S),!1,null)))}xr(n,n.transactionQueueTree_);for(let y=0;y<r.length;y++)Kt(r[y]);It(n,n.transactionQueueTree_)}(n,Pr(n,t),r),r}function Il(n,e){let t,r=n.transactionQueueTree_;for(t=ae(e);null!==t&&void 0===gn(r);)r=Jn(r,t),t=ae(e=De(e));return r}function Pr(n,e){const t=[];return ma(n,e,t),t.sort((r,c)=>r.order-c.order),t}function ma(n,e,t){const r=gn(e);if(r)for(let c=0;c<r.length;c++)t.push(r[c]);Mi(e,c=>{ma(n,c,t)})}function xr(n,e){const t=gn(e);if(t){let r=0;for(let c=0;c<t.length;c++)2!==t[c].status&&(t[r]=t[c],r++);t.length=r,Oi(e,t.length>0?t:void 0)}Mi(e,r=>{xr(n,r)})}function Hs(n,e){const t=Jt(Il(n,e)),r=Jn(n.transactionQueueTree_,e);return function Pi(n,e,t){let r=t?n:n.parent;for(;null!==r;){if(e(r))return!0;r=r.parent}}(r,c=>{Vs(n,c)}),Vs(n,r),vl(r,c=>{Vs(n,c)}),t}function Vs(n,e){const t=gn(e);if(t){const r=[];let c=[],p=-1;for(let _=0;_<t.length;_++)3===t[_].status||(1===t[_].status?((0,T.hu)(p===_-1,"All SENT items should be at beginning of queue."),p=_,t[_].status=3,t[_].abortReason="set"):((0,T.hu)(0===t[_].status,"Unexpected transaction status in abort"),t[_].unwatcher(),c=c.concat(pi(n.serverSyncTree_,t[_].currentWriteId,!0)),t[_].onComplete&&r.push(t[_].onComplete.bind(null,new Error("set"),!1,null))));-1===p?Oi(e,void 0):t.length=p+1,Wt(n.eventQueue_,Jt(e),c);for(let _=0;_<r.length;_++)Kt(r[_])}}const a=function(n,e){const t=f(n),r=t.namespace;return"firebase.com"===t.domain&&Tt(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||"undefined"===r)&&"localhost"!==t.domain&&Tt("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&ye("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new so(t.host,t.secure,r,e,"ws"===t.scheme||"wss"===t.scheme,"",r!==t.subdomain),path:new _e(t.pathString)}},f=function(n){let e="",t="",r="",c="",p="",_=!0,y="https",N=443;if("string"==typeof n){let E=n.indexOf("//");E>=0&&(y=n.substring(0,E-1),n=n.substring(E+2));let R=n.indexOf("/");-1===R&&(R=n.length);let S=n.indexOf("?");-1===S&&(S=n.length),e=n.substring(0,Math.min(R,S)),R<S&&(c=function d(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let c=t[r];try{c=decodeURIComponent(c.replace(/\+/g," "))}catch(p){}e+="/"+c}return e}(n.substring(R,S)));const O=function o(n){const e={};"?"===n.charAt(0)&&(n=n.substring(1));for(const t of n.split("&")){if(0===t.length)continue;const r=t.split("=");2===r.length?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):ye(`Invalid query segment '${t}' in query '${n}'`)}return e}(n.substring(Math.min(n.length,S)));E=e.indexOf(":"),E>=0?(_="https"===y||"wss"===y,N=parseInt(e.substring(E+1),10)):E=e.length;const j=e.slice(0,E);if("localhost"===j.toLowerCase())t="localhost";else if(j.split(".").length<=2)t=j;else{const K=e.indexOf(".");r=e.substring(0,K).toLowerCase(),t=e.substring(K+1),p=r}"ns"in O&&(p=O.ns)}return{host:e,port:N,domain:t,subdomain:r,secure:_,scheme:y,pathString:c,namespace:p}};class v{constructor(e,t,r,c){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=c}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+(0,T.Pz)(this.snapshot.exportVal())}}class b{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class C{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return(0,T.hu)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class A{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new T.BH;return wl(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Qt("OnDisconnect.remove",this._path);const e=new T.BH;return da(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Qt("OnDisconnect.set",this._path),Mn("OnDisconnect.set",e,this._path,!1);const t=new T.BH;return da(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Qt("OnDisconnect.setWithPriority",this._path),Mn("OnDisconnect.setWithPriority",e,this._path,!1),bl("OnDisconnect.setWithPriority",t,!1);const r=new T.BH;return function mn(n,e,t,r,c){const p=Ke(t,r);n.server_.onDisconnectPut(e.toString(),p.val(!0),(_,y)=>{"ok"===_&&Vt(n.onDisconnect_,e,p),Xt(0,c,_,y)})}(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){Qt("OnDisconnect.update",this._path),wc("OnDisconnect.update",e,this._path,!1);const t=new T.BH;return function El(n,e,t,r){if((0,T.xb)(t))return Ye("onDisconnect().update() called with empty data.  Don't do anything."),void Xt(0,r,"ok",void 0);n.server_.onDisconnectMerge(e.toString(),t,(c,p)=>{"ok"===c&&Ve(t,(_,y)=>{const N=Ke(y);Vt(n.onDisconnect_,Me(e,_),N)}),Xt(0,r,c,p)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class H{constructor(e,t,r,c){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=c}get key(){return le(this._path)?null:yo(this._path)}get ref(){return new we(this._repo,this._path)}get _queryIdentifier(){const e=Ya(this._queryParams),t=qr(e);return"{}"===t?"default":t}get _queryObject(){return Ya(this._queryParams)}isEqual(e){if(!((e=(0,T.m9)(e))instanceof H))return!1;const t=this._repo===e._repo,r=bo(this._path,e._path);return t&&r&&this._queryIdentifier===e._queryIdentifier}toJSON(){return this.toString()}toString(){return this._repo.toString()+function Ma(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)""!==n.pieces_[t]&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}(this._path)}}function Y(n,e){if(!0===n._orderByCalled)throw new Error(e+": You can't combine multiple orderBy calls.")}function J(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===ln){const r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",c="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Rt)throw new Error(r);if("string"!=typeof e)throw new Error(c)}if(n.hasEnd()){if(n.getIndexEndName()!==ct)throw new Error(r);if("string"!=typeof t)throw new Error(c)}}else if(n.getIndex()===Fe){if(null!=e&&!Ls(e)||null!=t&&!Ls(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if((0,T.hu)(n.getIndex()instanceof Xl||n.getIndex()===Ha,"unknown index type."),null!=e&&"object"==typeof e||null!=t&&"object"==typeof t)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Q(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class we extends H{constructor(e,t){super(e,t,new Oo,!1)}get parent(){const e=as(this._path);return null===e?null:new we(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class _t{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new _e(e),r=Xn(this.ref,e);return new _t(this._node.getChild(t),r,Fe)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(r,c)=>e(new _t(c,Xn(this.ref,r),Fe)))}hasChild(e){const t=new _e(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Ws(n,e){return(n=(0,T.m9)(n))._checkNotDeleted("ref"),void 0!==e?Xn(n._root,e):n._root}function Dl(n,e){(n=(0,T.m9)(n))._checkNotDeleted("refFromURL");const t=a(e,n._repo.repoInfo_.nodeAdmin);Ec("refFromURL",t);const r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&Tt("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),Ws(n,t.path.toString())}function Xn(n,e){return null===ae((n=(0,T.m9)(n))._path)?(t=e,t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Us("child","path",t,!1)):Us("child","path",e,!1),new we(n._repo,Me(n._path,e));var t}function Fr(n,e){n=(0,T.m9)(n),Qt("set",n._path),Mn("set",e,n._path,!1);const t=new T.BH;return Mr(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function va(n,e){wc("update",e,n._path,!1);const t=new T.BH;return function ua(n,e,t,r){qe(n,"update",{path:e.toString(),value:t});let c=!0;const p=Li(n),_={};if(Ve(t,(y,N)=>{c=!1,_[y]=_l(Me(e,y),Ke(N),n.serverSyncTree_,p)}),c)Ye("update() called with empty data.  Don't do anything."),Xt(0,r,"ok",void 0);else{const y=kr(n),N=function eu(n,e,t,r){!function Lo(n,e,t,r){(0,T.hu)(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=gr(n.visibleWrites,e,t),n.lastWriteId=r}(n.pendingWriteTree_,e,t,r);const c=Se.fromObject(t);return Tr(n,new ui({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,c))}(n.serverSyncTree_,e,_,y);oa(n.eventQueue_,N),n.server_.merge(e.toString(),t,(E,R)=>{const S="ok"===E;S||ye("update at "+e+" failed: "+E);const O=pi(n.serverSyncTree_,y,!S),j=O.length>0?Ui(n,e):e;Wt(n.eventQueue_,j,O),Xt(0,r,E,R)}),Ve(t,E=>{const R=Hs(n,Me(e,E));Ui(n,R)}),Wt(n.eventQueue_,e,[])}}(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function lu(n){return function Or(n,e){const t=function mc(n,e){const t=e._path;let r=null;n.syncPointTree_.foreachOnPath(t,(E,R)=>{const S=yt(E,t);r=r||Zn(R,S)});let c=n.syncPointTree_.get(t);c?r=r||Zn(c,ge()):(c=new Rs,n.syncPointTree_=n.syncPointTree_.set(t,c));const p=null!=r,_=p?new An(r,!0,!1):null;return function sl(n){return Si(n.viewCache_)}(al(c,e,zn(n.pendingWriteTree_,e._path),p?_.getNode():oe.EMPTY_NODE,p))}(n.serverSyncTree_,e);return null!=t?Promise.resolve(t):n.server_.get(e).then(r=>{const c=Ke(r).withIndex(e._queryParams.getIndex()),p=Ps(n.serverSyncTree_,e._path,c);return Rr(n.eventQueue_,e._path,p),Promise.resolve(c)},r=>(qe(n,"get for query "+(0,T.Pz)(e)+" failed: "+r),Promise.reject(new Error(r))))}((n=(0,T.m9)(n))._repo,n).then(e=>new _t(e,new we(n._repo,n._path),n._queryParams.getIndex()))}class Lr{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const r=t._queryParams.getIndex();return new v("value",this,new _t(e.snapshotNode,new we(t._repo,t._path),r))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new b(this,e,t):null}matches(e){return e instanceof Lr&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class ya{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new b(this,e,t):null}createEvent(e,t){(0,T.hu)(null!=e.childName,"Child events should have a childName.");const r=Xn(new we(t._repo,t._path),e.childName),c=t._queryParams.getIndex();return new v(e.type,this,new _t(e.snapshotNode,r,c),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof ya&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function kl(n,e,t,r,c){let p;if("object"==typeof r&&(p=void 0,c=r),"function"==typeof r&&(p=r),c&&c.onlyOnce){const N=t,E=(R,S)=>{ha(n._repo,n,y),N(R,S)};E.userCallback=t.userCallback,E.context=t.context,t=E}const _=new C(t,p||void 0),y="value"===e?new Lr(_):new ya(e,_);return function Cl(n,e,t){let r;r=".info"===ae(e._path)?_c(n.infoSyncTree_,e,t):_c(n.serverSyncTree_,e,t),Rr(n.eventQueue_,e._path,r)}(n._repo,n,y),()=>ha(n._repo,n,y)}function Rc(n,e,t,r){return kl(n,"value",e,t,r)}function Cu(n,e,t,r){return kl(n,"child_added",e,t,r)}function Iu(n,e,t,r){return kl(n,"child_changed",e,t,r)}function cu(n,e,t,r){return kl(n,"child_moved",e,t,r)}function Du(n,e,t,r){return kl(n,"child_removed",e,t,r)}function Su(n,e,t){let r=null;const c=t?new C(t):null;"value"===e?r=new Lr(c):e&&(r=new ya(e,c)),ha(n._repo,n,r)}class vn{}class Ru extends vn{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Mn("endAt",this._value,e._path,!0);const t=un(e._queryParams,this._value,this._key);if(Q(t),J(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new H(e._repo,e._path,t,e._orderByCalled)}}class sd extends vn{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Mn("endBefore",this._value,e._path,!1);const t=function Hc(n,e,t){let r,c;return n.index_===ln?("string"==typeof e&&(e=Va(e)),c=un(n,e,t)):(r=null==t?Rt:Va(t),c=un(n,e,r)),c.endBeforeSet_=!0,c}(e._queryParams,this._value,this._key);if(Q(t),J(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new H(e._repo,e._path,t,e._orderByCalled)}}class Au extends vn{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Mn("startAt",this._value,e._path,!0);const t=ur(e._queryParams,this._value,this._key);if(Q(t),J(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new H(e._repo,e._path,t,e._orderByCalled)}}class ad extends vn{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Mn("startAfter",this._value,e._path,!1);const t=function Gc(n,e,t){let r;if(n.index_===ln)"string"==typeof e&&(e=Ao(e)),r=ur(n,e,t);else{let c;c=null==t?ct:Ao(t),r=ur(n,e,c)}return r.startAfterSet_=!0,r}(e._queryParams,this._value,this._key);if(Q(t),J(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new H(e._repo,e._path,t,e._orderByCalled)}}class cd extends vn{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new H(e._repo,e._path,function nc(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}(e._queryParams,this._limit),e._orderByCalled)}}class du extends vn{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new H(e._repo,e._path,function Eu(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}(e._queryParams,this._limit),e._orderByCalled)}}class hd extends vn{constructor(e){super(),this._path=e}_apply(e){Y(e,"orderByChild");const t=new _e(this._path);if(le(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const r=new Xl(t),c=ci(e._queryParams,r);return J(c),new H(e._repo,e._path,c,!0)}}class pd extends vn{_apply(e){Y(e,"orderByKey");const t=ci(e._queryParams,ln);return J(t),new H(e._repo,e._path,t,!0)}}class gd extends vn{_apply(e){Y(e,"orderByPriority");const t=ci(e._queryParams,Fe);return J(t),new H(e._repo,e._path,t,!0)}}class md extends vn{_apply(e){Y(e,"orderByValue");const t=ci(e._queryParams,Ha);return J(t),new H(e._repo,e._path,t,!0)}}class hu extends vn{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(Mn("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Ru(this._value,this._key)._apply(new Au(this._value,this._key)._apply(e))}}function Pn(n,...e){let t=(0,T.m9)(n);for(const r of e)t=r._apply(t);return t}(function fc(n){(0,T.hu)(!br,"__referenceConstructor has already been defined"),br=n})(we),function pc(n){(0,T.hu)(!Nr,"__referenceConstructor has already been defined"),Nr=n}(we);const l={};function g(n,e,t,r,c){let p=r||n.options.databaseURL;void 0===p&&(n.options.projectId||Tt("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ye("Using default host for project ",n.options.projectId),p=`${n.options.projectId}-default-rtdb.firebaseio.com`);let N,E,_=a(p,c),y=_.repoInfo;"undefined"!=typeof process&&(E=process.env.FIREBASE_DATABASE_EMULATOR_HOST),E?(N=!0,p=`http://${E}?ns=${y.namespace}`,_=a(p,c),y=_.repoInfo):N=!_.repoInfo.secure;const R=c&&N?new Yi(Yi.OWNER):new no(n.name,n.options,e);Ec("Invalid Firebase Database URL",_),le(_.path)||Tt("Database URL must point to the root of a Firebase Database (not including a child path).");const S=function w(n,e,t,r){let c=l[e.name];c||(c={},l[e.name]=c);let p=c[n.toURLString()];return p&&Tt("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),p=new ca(n,false,t,r),c[n.toURLString()]=p,p}(y,n,R,new Ul(n.name,t));return new D(S,n)}class D{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function Fi(n,e,t){if(n.stats_=lo(n.repoInfo_),n.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)n.server_=new We(n.repoInfo_,(r,c,p,_)=>{_n(n,r,c,p,_)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Cc(n,!0),0);else{if(null!=t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,T.Pz)(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new In(n.repoInfo_,e,(r,c,p,_)=>{_n(n,r,c,p,_)},r=>{Cc(n,r)},r=>{!function Pt(n,e){Ve(e,(t,r)=>{Qn(n,t,r)})}(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=function co(n,e){const t=n.toString();return Qi[t]||(Qi[t]=e()),Qi[t]}(n.repoInfo_,()=>new _s(n.stats_,n.server_)),n.infoData_=new Dn,n.infoSyncTree_=new Ko({startListening:(r,c,p,_)=>{let y=[];const N=n.infoData_.getNode(r._path);return N.isEmpty()||(y=Ps(n.infoSyncTree_,r._path,N),setTimeout(()=>{_("ok")},0)),y},stopListening:()=>{}}),Qn(n,"connected",!1),n.serverSyncTree_=new Ko({startListening:(r,c,p,_)=>(n.server_.listen(r,p,c,(y,N)=>{const E=_(y,N);Wt(n.eventQueue_,r._path,E)}),[]),stopListening:(r,c)=>{n.server_.unlisten(r,c)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new we(this._repo,ge())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function m(n,e){const t=l[e];(!t||t[n.key]!==n)&&Tt(`Database ${e}(${n.repoInfo_}) has already been deleted.`),fa(n),delete t[n.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&Tt("Cannot call "+e+" on a deleted database.")}}function z(n,e){Zr(n,e)}const X={".sv":"timestamp"};class pe{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}In.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)},In.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)},function ce(n){$t(ft.SDK_VERSION),(0,ft._registerComponent)(new nt.wA("database",(e,{instanceIdentifier:t})=>g(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),(0,ft.registerVersion)(Tn,"0.12.7",n),(0,ft.registerVersion)(Tn,"0.12.7","esm2017")}();const Ae=new rn.Yd("@firebase/database-compat"),mt=function(n){Ae.warn("FIREBASE WARNING: "+n)};class xn{constructor(e){this._delegate=e}cancel(e){(0,T.Dv)("OnDisconnect.cancel",0,1,arguments.length),(0,T.Wj)("OnDisconnect.cancel","onComplete",e,!0);const t=this._delegate.cancel();return e&&t.then(()=>e(null),r=>e(r)),t}remove(e){(0,T.Dv)("OnDisconnect.remove",0,1,arguments.length),(0,T.Wj)("OnDisconnect.remove","onComplete",e,!0);const t=this._delegate.remove();return e&&t.then(()=>e(null),r=>e(r)),t}set(e,t){(0,T.Dv)("OnDisconnect.set",1,2,arguments.length),(0,T.Wj)("OnDisconnect.set","onComplete",t,!0);const r=this._delegate.set(e);return t&&r.then(()=>t(null),c=>t(c)),r}setWithPriority(e,t,r){(0,T.Dv)("OnDisconnect.setWithPriority",2,3,arguments.length),(0,T.Wj)("OnDisconnect.setWithPriority","onComplete",r,!0);const c=this._delegate.setWithPriority(e,t);return r&&c.then(()=>r(null),p=>r(p)),c}update(e,t){if((0,T.Dv)("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){const c={};for(let p=0;p<e.length;++p)c[""+p]=e[p];e=c,mt("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}(0,T.Wj)("OnDisconnect.update","onComplete",t,!0);const r=this._delegate.update(e);return t&&r.then(()=>t(null),c=>t(c)),r}}class en{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return(0,T.Dv)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class yn{constructor(e,t){this._database=e,this._delegate=t}val(){return(0,T.Dv)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return(0,T.Dv)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return(0,T.Dv)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return(0,T.Dv)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return(0,T.Dv)("DataSnapshot.child",0,1,arguments.length),e=String(e),Us("DataSnapshot.child","path",e,!1),new yn(this._database,this._delegate.child(e))}hasChild(e){return(0,T.Dv)("DataSnapshot.hasChild",1,1,arguments.length),Us("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return(0,T.Dv)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return(0,T.Dv)("DataSnapshot.forEach",1,1,arguments.length),(0,T.Wj)("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new yn(this._database,t)))}hasChildren(){return(0,T.Dv)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return(0,T.Dv)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return(0,T.Dv)("DataSnapshot.ref",0,0,arguments.length),new je(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class ot{constructor(e,t){this.database=e,this._delegate=t}on(e,t,r,c){var p;(0,T.Dv)("Query.on",2,4,arguments.length),(0,T.Wj)("Query.on","callback",t,!1);const _=ot.getCancelAndContextArgs_("Query.on",r,c),y=(E,R)=>{t.call(_.context,new yn(this.database,E),R)};y.userCallback=t,y.context=_.context;const N=null===(p=_.cancel)||void 0===p?void 0:p.bind(_.context);switch(e){case"value":return Rc(this._delegate,y,N),t;case"child_added":return Cu(this._delegate,y,N),t;case"child_removed":return Du(this._delegate,y,N),t;case"child_changed":return Iu(this._delegate,y,N),t;case"child_moved":return cu(this._delegate,y,N),t;default:throw new Error((0,T.gK)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,r){if((0,T.Dv)("Query.off",0,3,arguments.length),function(n,e,t){if(void 0!==e)switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error((0,T.gK)("Query.off","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}(0,e),(0,T.Wj)("Query.off","callback",t,!0),(0,T.lb)("Query.off","context",r,!0),t){const c=()=>{};c.userCallback=t,c.context=r,Su(this._delegate,e,c)}else Su(this._delegate,e)}get(){return lu(this._delegate).then(e=>new yn(this.database,e))}once(e,t,r,c){(0,T.Dv)("Query.once",1,4,arguments.length),(0,T.Wj)("Query.once","callback",t,!0);const p=ot.getCancelAndContextArgs_("Query.once",r,c),_=new T.BH,y=(E,R)=>{const S=new yn(this.database,E);t&&t.call(p.context,S,R),_.resolve(S)};y.userCallback=t,y.context=p.context;const N=E=>{p.cancel&&p.cancel.call(p.context,E),_.reject(E)};switch(e){case"value":Rc(this._delegate,y,N,{onlyOnce:!0});break;case"child_added":Cu(this._delegate,y,N,{onlyOnce:!0});break;case"child_removed":Du(this._delegate,y,N,{onlyOnce:!0});break;case"child_changed":Iu(this._delegate,y,N,{onlyOnce:!0});break;case"child_moved":cu(this._delegate,y,N,{onlyOnce:!0});break;default:throw new Error((0,T.gK)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return _.promise}limitToFirst(e){return(0,T.Dv)("Query.limitToFirst",1,1,arguments.length),new ot(this.database,Pn(this._delegate,function ud(n){if("number"!=typeof n||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new cd(n)}(e)))}limitToLast(e){return(0,T.Dv)("Query.limitToLast",1,1,arguments.length),new ot(this.database,Pn(this._delegate,function dd(n){if("number"!=typeof n||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new du(n)}(e)))}orderByChild(e){return(0,T.Dv)("Query.orderByChild",1,1,arguments.length),new ot(this.database,Pn(this._delegate,function fd(n){if("$key"===n)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===n)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===n)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Us("orderByChild","path",n,!1),new hd(n)}(e)))}orderByKey(){return(0,T.Dv)("Query.orderByKey",0,0,arguments.length),new ot(this.database,Pn(this._delegate,function ku(){return new pd}()))}orderByPriority(){return(0,T.Dv)("Query.orderByPriority",0,0,arguments.length),new ot(this.database,Pn(this._delegate,function _d(){return new gd}()))}orderByValue(){return(0,T.Dv)("Query.orderByValue",0,0,arguments.length),new ot(this.database,Pn(this._delegate,function vd(){return new md}()))}startAt(e=null,t){return(0,T.Dv)("Query.startAt",0,2,arguments.length),new ot(this.database,Pn(this._delegate,function uu(n=null,e){return Sr("startAt","key",e,!0),new Au(n,e)}(e,t)))}startAfter(e=null,t){return(0,T.Dv)("Query.startAfter",0,2,arguments.length),new ot(this.database,Pn(this._delegate,function ld(n,e){return Sr("startAfter","key",e,!0),new ad(n,e)}(e,t)))}endAt(e=null,t){return(0,T.Dv)("Query.endAt",0,2,arguments.length),new ot(this.database,Pn(this._delegate,function rd(n,e){return Sr("endAt","key",e,!0),new Ru(n,e)}(e,t)))}endBefore(e=null,t){return(0,T.Dv)("Query.endBefore",0,2,arguments.length),new ot(this.database,Pn(this._delegate,function od(n,e){return Sr("endBefore","key",e,!0),new sd(n,e)}(e,t)))}equalTo(e,t){return(0,T.Dv)("Query.equalTo",1,2,arguments.length),new ot(this.database,Pn(this._delegate,function Ou(n,e){return Sr("equalTo","key",e,!0),new hu(n,e)}(e,t)))}toString(){return(0,T.Dv)("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return(0,T.Dv)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if((0,T.Dv)("Query.isEqual",1,1,arguments.length),!(e instanceof ot))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,r){const c={cancel:void 0,context:void 0};if(t&&r)c.cancel=t,(0,T.Wj)(e,"cancel",c.cancel,!0),c.context=r,(0,T.lb)(e,"context",c.context,!0);else if(t)if("object"==typeof t&&null!==t)c.context=t;else{if("function"!=typeof t)throw new Error((0,T.gK)(e,"cancelOrContext")+" must either be a cancel callback or a context object.");c.cancel=t}return c}get ref(){return new je(this.database,new we(this._delegate._repo,this._delegate._path))}}class je extends ot{constructor(e,t){super(e,new H(t._repo,t._path,new Oo,!1)),this.database=e,this._delegate=t}getKey(){return(0,T.Dv)("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return(0,T.Dv)("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new je(this.database,Xn(this._delegate,e))}getParent(){(0,T.Dv)("Reference.parent",0,0,arguments.length);const e=this._delegate.parent;return e?new je(this.database,e):null}getRoot(){return(0,T.Dv)("Reference.root",0,0,arguments.length),new je(this.database,this._delegate.root)}set(e,t){(0,T.Dv)("Reference.set",1,2,arguments.length),(0,T.Wj)("Reference.set","onComplete",t,!0);const r=Fr(this._delegate,e);return t&&r.then(()=>t(null),c=>t(c)),r}update(e,t){if((0,T.Dv)("Reference.update",1,2,arguments.length),Array.isArray(e)){const c={};for(let p=0;p<e.length;++p)c[""+p]=e[p];e=c,mt("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Qt("Reference.update",this._delegate._path),(0,T.Wj)("Reference.update","onComplete",t,!0);const r=va(this._delegate,e);return t&&r.then(()=>t(null),c=>t(c)),r}setWithPriority(e,t,r){(0,T.Dv)("Reference.setWithPriority",2,3,arguments.length),(0,T.Wj)("Reference.setWithPriority","onComplete",r,!0);const c=function Al(n,e,t){if(Qt("setWithPriority",n._path),Mn("setWithPriority",e,n._path,!1),bl("setWithPriority",t,!1),".length"===n.key||".keys"===n.key)throw"setWithPriority failed: "+n.key+" is a read-only object.";const r=new T.BH;return Mr(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}(this._delegate,e,t);return r&&c.then(()=>r(null),p=>r(p)),c}remove(e){(0,T.Dv)("Reference.remove",0,1,arguments.length),(0,T.Wj)("Reference.remove","onComplete",e,!0);const t=function Rl(n){return Qt("remove",n._path),Fr(n,null)}(this._delegate);return e&&t.then(()=>e(null),r=>e(r)),t}transaction(e,t,r){(0,T.Dv)("Reference.transaction",1,3,arguments.length),(0,T.Wj)("Reference.transaction","transactionUpdate",e,!1),(0,T.Wj)("Reference.transaction","onComplete",t,!0),function(n,e,t,r){if(void 0!==t&&"boolean"!=typeof t)throw new Error((0,T.gK)("Reference.transaction","applyLocally")+"must be a boolean.")}(0,0,r);const c=function Ue(n,e,t){var r;if(n=(0,T.m9)(n),Qt("Reference.transaction",n._path),".length"===n.key||".keys"===n.key)throw"Reference.transaction failed: "+n.key+" is a read-only object.";const c=null===(r=null==t?void 0:t.applyLocally)||void 0===r||r,p=new T.BH,y=Rc(n,()=>{});return function pa(n,e,t,r,c,p){qe(n,"transaction on "+e);const _={path:e,update:t,onComplete:r,status:null,order:Ta(),applyLocally:p,retryCount:0,unwatcher:c,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},y=ga(n,e,void 0);_.currentInputSnapshot=y;const N=_.update(y.val());if(void 0===N)_.unwatcher(),_.currentOutputSnapshotRaw=null,_.currentOutputSnapshotResolved=null,_.onComplete&&_.onComplete(null,!1,_.currentInputSnapshot);else{_i("transaction failed: Data returned ",N,_.path),_.status=0;const E=Jn(n.transactionQueueTree_,e),R=gn(E)||[];let S;R.push(_),Oi(E,R),"object"==typeof N&&null!==N&&(0,T.r3)(N,".priority")?(S=(0,T.DV)(N,".priority"),(0,T.hu)(Ls(S),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):S=(Jo(n.serverSyncTree_,e)||oe.EMPTY_NODE).getPriority().val();const O=Li(n),j=Ke(N,S),K=Cr(j,y,O);_.currentOutputSnapshotRaw=j,_.currentOutputSnapshotResolved=K,_.currentWriteId=kr(n);const me=qo(n.serverSyncTree_,e,K,_.currentWriteId,_.applyLocally);Wt(n.eventQueue_,e,me),It(n,n.transactionQueueTree_)}}(n._repo,n._path,e,(N,E,R)=>{let S=null;N?p.reject(N):(S=new _t(R,new we(n._repo,n._path),Fe),p.resolve(new pe(E,S)))},y,c),p.promise}(this._delegate,e,{applyLocally:r}).then(p=>new en(p.committed,new yn(this.database,p.snapshot)));return t&&c.then(p=>t(null,p.committed,p.snapshot),p=>t(p,!1,null)),c}setPriority(e,t){(0,T.Dv)("Reference.setPriority",1,2,arguments.length),(0,T.Wj)("Reference.setPriority","onComplete",t,!0);const r=function Sc(n,e){n=(0,T.m9)(n),Qt("setPriority",n._path),bl("setPriority",e,!1);const t=new T.BH;return Mr(n._repo,Me(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}(this._delegate,e);return t&&r.then(()=>t(null),c=>t(c)),r}push(e,t){(0,T.Dv)("Reference.push",0,2,arguments.length),(0,T.Wj)("Reference.push","onComplete",t,!0);const r=function Dc(n,e){n=(0,T.m9)(n),Qt("push",n._path),Mn("push",e,n._path,!0);const t=Tl(n._repo),r=Di(t),c=Xn(n,r),p=Xn(n,r);let _;return _=null!=e?Fr(p,e).then(()=>p):Promise.resolve(p),c.then=_.then.bind(_),c.catch=_.then.bind(_,void 0),c}(this._delegate,e),c=r.then(_=>new je(this.database,_));t&&c.then(()=>t(null),_=>t(_));const p=new je(this.database,r);return p.then=c.then.bind(c),p.catch=c.catch.bind(c,void 0),p}onDisconnect(){return Qt("Reference.onDisconnect",this._delegate._path),new xn(new A(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class xt{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete()}}useEmulator(e,t,r={}){!function P(n,e,t,r={}){(n=(0,T.m9)(n))._checkNotDeleted("useEmulator"),n._instanceStarted&&Tt("Cannot call useEmulator() after instance has already been initialized.");const c=n._repoInternal;let p;if(c.repoInfo_.nodeAdmin)r.mockUserToken&&Tt('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),p=new Yi(Yi.OWNER);else if(r.mockUserToken){const _="string"==typeof r.mockUserToken?r.mockUserToken:(0,T.Sg)(r.mockUserToken,n.app.options.projectId);p=new Yi(_)}!function u(n,e,t,r){n.repoInfo_=new so(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams),r&&(n.authTokenProvider_=r)}(c,e,t,p)}(this._delegate,e,t,r)}ref(e){if((0,T.Dv)("database.ref",0,1,arguments.length),e instanceof je){const t=Dl(this._delegate,e.toString());return new je(this,t)}{const t=Ws(this._delegate,e);return new je(this,t)}}refFromURL(e){(0,T.Dv)("database.refFromURL",1,1,arguments.length);const r=Dl(this._delegate,e);return new je(this,r)}goOffline(){return(0,T.Dv)("database.goOffline",0,0,arguments.length),function q(n){(n=(0,T.m9)(n))._checkNotDeleted("goOffline"),fa(n._repo)}(this._delegate)}goOnline(){return(0,T.Dv)("database.goOnline",0,0,arguments.length),function $(n){(n=(0,T.m9)(n))._checkNotDeleted("goOnline"),function Bs(n){n.persistentConnection_&&n.persistentConnection_.resume(la)}(n._repo)}(this._delegate)}}xt.ServerValue={TIMESTAMP:function fe(){return X}(),increment:n=>function be(n){return{".sv":{increment:n}}}(n)};var Ur=Object.freeze({__proto__:null,initStandalone:function Ol({app:n,url:e,version:t,customAuthImpl:r,namespace:c,nodeAdmin:p=!1}){$t(t);const _=new nt.zt("auth-internal",new nt.H0("database-standalone"));return _.setComponent(new nt.wA("auth-internal",()=>r,"PRIVATE")),{instance:new xt(g(n,_,void 0,e,p),n),namespace:c}}});const Ml=xt.ServerValue;!function Ac(n){n.INTERNAL.registerComponent(new nt.wA("database-compat",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app-compat").getImmediate(),c=e.getProvider("database").getImmediate({identifier:t});return new xt(c,r)},"PUBLIC").setServiceProps({Reference:je,Query:ot,Database:xt,DataSnapshot:yn,enableLogging:z,INTERNAL:Ur,ServerValue:Ml}).setMultipleInstances(!0)),n.registerVersion("@firebase/database-compat","0.1.7")}(Ut.Z);var js=F(5254),Pl=F(7224),$s=F(2198),Bi=F(9808);F(5867);const xl=new Map,pu={activated:!1,tokenObservers:[]},gu={initialized:!1,enabled:!1};function ut(n){return xl.get(n)||pu}function bn(n,e){xl.set(n,e)}function _u(){return gu}class dh{constructor(e,t,r,c,p){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=c,this.upperBound=p,this.pending=null,this.nextErrorWaitInterval=c,c>p)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){var t=this;return(0,Xe.Z)(function*(){t.stop();try{t.pending=new T.BH,yield function hh(n){return new Promise(e=>{setTimeout(e,n)})}(t.getNextRun(e)),t.pending.resolve(),yield t.pending.promise,t.pending=new T.BH,yield t.operation(),t.pending.resolve(),yield t.pending.promise,t.process(!0).catch(()=>{})}catch(r){t.retryPolicy(r)?t.process(!1).catch(()=>{}):t.stop()}})()}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}}const tn=new T.LL("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function wd(n){if(!ut(n).activated)throw tn.create("use-before-activation",{appName:n.name})}function Wu(n,e){return ju.apply(this,arguments)}function ju(){return(ju=(0,Xe.Z)(function*({url:n,body:e},t){const r={"Content-Type":"application/json"},c=t.getImmediate({optional:!0});if(c){const S=yield c.getHeartbeatsHeader();S&&(r["X-Firebase-Client"]=S)}const p={method:"POST",body:JSON.stringify(e),headers:r};let _,y;try{_=yield fetch(n,p)}catch(S){throw tn.create("fetch-network-error",{originalErrorMessage:S.message})}if(200!==_.status)throw tn.create("fetch-status-error",{httpStatus:_.status});try{y=yield _.json()}catch(S){throw tn.create("fetch-parse-error",{originalErrorMessage:S.message})}const N=y.ttl.match(/^([\d.]+)(s)$/);if(!N||!N[2]||isNaN(Number(N[1])))throw tn.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${y.ttl}`});const E=1e3*Number(N[1]),R=Date.now();return{token:y.attestationToken,expireTimeMillis:R+E,issuedAtTimeMillis:R}})).apply(this,arguments)}function mh(n,e){const{projectId:t,appId:r,apiKey:c}=n.options;return{url:`https://content-firebaseappcheck.googleapis.com/v1beta/projects/${t}/apps/${r}:exchangeDebugToken?key=${c}`,body:{debug_token:e}}}const Oc="firebase-app-check-store";let yu=null;function Cd(){return yu||(yu=new Promise((n,e)=>{try{const t=indexedDB.open("firebase-app-check-database",1);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var c;e(tn.create("storage-open",{originalErrorMessage:null===(c=r.target.error)||void 0===c?void 0:c.message}))},t.onupgradeneeded=r=>{0===r.oldVersion&&r.target.result.createObjectStore(Oc,{keyPath:"compositeKey"})}}catch(t){e(tn.create("storage-open",{originalErrorMessage:t.message}))}}),yu)}function $u(){return($u=(0,Xe.Z)(function*(n,e){const r=(yield Cd()).transaction(Oc,"readwrite"),p=r.objectStore(Oc).put({compositeKey:n,value:e});return new Promise((_,y)=>{p.onsuccess=N=>{_()},r.onerror=N=>{var E;y(tn.create("storage-set",{originalErrorMessage:null===(E=N.target.error)||void 0===E?void 0:E.message}))}})})).apply(this,arguments)}const Mc=new rn.Yd("@firebase/app-check");function Rd(n,e){return(0,T.hl)()?function Nh(n,e){return function Id(n,e){return $u.apply(this,arguments)}(function Sd(n){return`${n.options.appId}-${n.name}`}(n),e)}(n,e).catch(t=>{Mc.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Ad(){return _u().enabled}function kd(){return Ku.apply(this,arguments)}function Ku(){return(Ku=(0,Xe.Z)(function*(){const n=_u();if(n.enabled&&n.token)return n.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")})).apply(this,arguments)}const Dh={error:"UNKNOWN_ERROR"};function Sh(n){return T.US.encodeString(JSON.stringify(n),!1)}function bu(n){return qu.apply(this,arguments)}function qu(){return(qu=(0,Xe.Z)(function*(n,e=!1){const t=n.app;wd(t);const r=ut(t);let p,c=r.token;if(!c){const N=yield r.cachedTokenPromise;N&&Nu(N)&&(c=N)}if(!e&&c&&Nu(c))return{token:c.token};let y,_=!1;if(Ad()){r.exchangeTokenPromise||(r.exchangeTokenPromise=Wu(mh(t,yield kd()),n.heartbeatServiceProvider).then(E=>(r.exchangeTokenPromise=void 0,E)),_=!0);const N=yield r.exchangeTokenPromise;return yield Rd(t,N),bn(t,Object.assign(Object.assign({},r),{token:N})),{token:N.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().then(N=>(r.exchangeTokenPromise=void 0,N)),_=!0),c=yield r.exchangeTokenPromise}catch(N){"appCheck/throttled"===N.code?Mc.warn(N.message):Mc.error(N),p=N}return c?(y={token:c.token},bn(t,Object.assign(Object.assign({},r),{token:c})),yield Rd(t,c)):y=Ah(p),_&&Md(t,y),y})).apply(this,arguments)}function Qu(n,e){const t=ut(n),r=t.tokenObservers.filter(c=>c.next!==e);0===r.length&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),bn(n,Object.assign(Object.assign({},t),{tokenObservers:r}))}function Od(n){const{app:e}=n,t=ut(e);let r=t.tokenRefresher;r||(r=function Rh(n){const{app:e}=n;return new dh((0,Xe.Z)(function*(){let r;if(r=ut(e).token?yield bu(n,!0):yield bu(n),r.error)throw r.error}),()=>!0,()=>{const t=ut(e);if(t.token){let r=t.token.issuedAtTimeMillis+.5*(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)+3e5;return r=Math.min(r,t.token.expireTimeMillis-3e5),Math.max(0,r-Date.now())}return 0},3e4,96e4)}(n),bn(e,Object.assign(Object.assign({},t),{tokenRefresher:r}))),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function Md(n,e){const t=ut(n).tokenObservers;for(const r of t)try{"EXTERNAL"===r.type&&null!=e.error?r.error(e.error):r.next(e)}catch(c){}}function Nu(n){return n.expireTimeMillis-Date.now()>0}function Ah(n){return{token:Sh(Dh),error:n}}class kh{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=ut(this.app);for(const t of e)Qu(this.app,t.next);return Promise.resolve()}}const Hd="app-check-internal";!function $h(){(0,ft._registerComponent)(new nt.wA("app-check",n=>function Oh(n,e){return new kh(n,e)}(n.getProvider("app").getImmediate(),n.getProvider("heartbeat")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Hd).initialize()})),(0,ft._registerComponent)(new nt.wA(Hd,n=>function Mh(n){return{getToken:e=>bu(n,e),addTokenListener:e=>function Ju(n,e,t,r){const{app:c}=n,p=ut(c),_={next:t,error:r,type:e};if(bn(c,Object.assign(Object.assign({},p),{tokenObservers:[...p.tokenObservers,_]})),p.token&&Nu(p.token)){const y=p.token;Promise.resolve().then(()=>{t({token:y.token}),Od(n)}).catch(()=>{})}p.cachedTokenPromise.then(()=>Od(n))}(n,"INTERNAL",e),removeTokenListener:e=>Qu(n.app,e)}}(n.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),(0,ft.registerVersion)("@firebase/app-check","0.5.5")}();class nd{constructor(){return(0,Ce.vb)("app-check")}}"undefined"!=typeof window&&window;const Wd=new V.OlP("angularfire2.auth.use-emulator"),jd=new V.OlP("angularfire2.auth.settings"),$d=new V.OlP("angularfire2.auth.tenant-id"),Yd=new V.OlP("angularfire2.auth.langugage-code"),zd=new V.OlP("angularfire2.auth.use-device-language"),Zd=new V.OlP("angularfire.auth.persistence"),Kd=(n,e,t,r,c,p,_,y)=>(0,Oe.cc)(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{const N=e.runOutsideAngular(()=>n.auth());if(t&&N.useEmulator(...t),r&&(N.tenantId=r),N.languageCode=c,p&&N.useDeviceLanguage(),_)for(const[E,R]of Object.entries(_))N.settings[E]=R;return y&&N.setPersistence(y),N},[t,r,c,p,_,y]);let qd=(()=>{class n{constructor(t,r,c,p,_,y,N,E,R,S,O,j){const K=new ne.xQ,me=(0,Ee.of)(void 0).pipe((0,ve.QV)(_.outsideAngular),(0,Je.w)(()=>p.runOutsideAngular(()=>Promise.resolve().then(F.bind(F,4087)))),(0,lt.U)(()=>(0,Oe.on)(t,p,r)),(0,lt.U)(tt=>Kd(tt,p,y,E,R,S,N,O)),Z({bufferSize:1,refCount:!1}));if((0,Bi.PM)(c))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,Ee.of)(null);else{me.pipe((0,Pl.P)()).subscribe();const ei=me.pipe((0,Je.w)(vt=>vt.getRedirectResult().then(Hr=>Hr,()=>null)),Ce.iC,Z({bufferSize:1,refCount:!1})),Fn=me.pipe((0,Je.w)(vt=>new ti.y(Hr=>({unsubscribe:p.runOutsideAngular(()=>vt.onAuthStateChanged(Na=>Hr.next(Na),Na=>Hr.error(Na),()=>Hr.complete()))})))),Gi=me.pipe((0,Je.w)(vt=>new ti.y(Hr=>({unsubscribe:p.runOutsideAngular(()=>vt.onIdTokenChanged(Na=>Hr.next(Na),Na=>Hr.error(Na),()=>Hr.complete()))}))));this.authState=ei.pipe(ie(Fn),(0,Te.R)(_.outsideAngular),(0,ve.QV)(_.insideAngular)),this.user=ei.pipe(ie(Gi),(0,Te.R)(_.outsideAngular),(0,ve.QV)(_.insideAngular)),this.idToken=this.user.pipe((0,Je.w)(vt=>vt?(0,js.D)(vt.getIdToken()):(0,Ee.of)(null))),this.idTokenResult=this.user.pipe((0,Je.w)(vt=>vt?(0,js.D)(vt.getIdTokenResult()):(0,Ee.of)(null))),this.credential=(0,ni.T)(ei,K,this.authState.pipe((0,$s.h)(vt=>!vt))).pipe((0,lt.U)(vt=>(null==vt?void 0:vt.user)?vt:null),(0,Te.R)(_.outsideAngular),(0,ve.QV)(_.insideAngular))}return(0,Oe.pX)(this,me,p,{spy:{apply:(tt,ei,Fn)=>{(tt.startsWith("signIn")||tt.startsWith("createUser"))&&Fn.then(Gi=>K.next(Gi))}}})}}return n.\u0275fac=function(t){return new(t||n)(V.LFG(Oe.Dh),V.LFG(Oe.xv,8),V.LFG(V.Lbi),V.LFG(V.R0b),V.LFG(Ce.HU),V.LFG(Wd,8),V.LFG(jd,8),V.LFG($d,8),V.LFG(Yd,8),V.LFG(zd,8),V.LFG(Zd,8),V.LFG(nd,8))},n.\u0275prov=V.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();function Jd(n){return null==n}function Qd(n){return"function"==typeof n.set}function Xd(n,e){return Qd(e)?e:n.ref(e)}function eh(n,e){if(function Jh(n){return"string"==typeof n}(n))return e.stringCase();if(Qd(n))return e.firebaseCase();if(function Qh(n){return"function"==typeof n.exportVal}(n))return e.snapshotCase();throw new Error("Expects a string, snapshot, or reference. Got: "+typeof n)}function Pc(n,e,t="on",r=Wr.z){return new ti.y(c=>{let p=null;return p=n[t](e,(_,y)=>{r.schedule(()=>{c.next({snapshot:_,prevKey:y})}),"once"===t&&r.schedule(()=>c.complete())},_=>{r.schedule(()=>c.error(_))}),"on"===t?{unsubscribe(){null!=p&&n.off(e,p)}}:{unsubscribe(){}}}).pipe((0,lt.U)(c=>{const{snapshot:p,prevKey:_}=c;let y=null;return p.exists()&&(y=p.key),{type:e,payload:p,prevKey:_,key:y}}),(0,nn.B)())}function th(n,e){const t=n.length;for(let r=0;r<t;r++)if(n[r].payload.key===e)return r;return-1}function tf(n,e){const{payload:t,prevKey:r,key:c}=e,p=th(n,c),_=function ef(n,e){if(Jd(e))return 0;{const t=th(n,e);return-1===t?n.length:t+1}}(n,r);switch(e.type){case"value":if(e.payload&&e.payload.exists()){let y=null;e.payload.forEach(N=>{const E={payload:N,type:"value",prevKey:y,key:N.key};return y=N.key,n=[...n,E],!1})}return n;case"child_added":if(p>-1){const y=n[p-1];(y&&y.key||null)!==r&&(n=n.filter(N=>N.payload.key!==t.key)).splice(_,0,e)}else{if(null==r)return[e,...n];(n=n.slice()).splice(_,0,e)}return n;case"child_removed":return n.filter(y=>y.payload.key!==t.key);case"child_changed":return n.map(y=>y.payload.key===c?e:y);case"child_moved":if(p>-1){const y=n.splice(p,1)[0];return(n=n.slice()).splice(_,0,y),n}return n;default:return n}}function nh(n){return(Jd(n)||0===n.length)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function ih(n,e,t){return function Xh(n,e,t){return Pc(n,"value","once",t).pipe((0,Je.w)(r=>{const c=[(0,Ee.of)(r)];return e.forEach(p=>c.push(Pc(n,p,"on",t))),(0,ni.T)(...c).pipe((0,Wi.R)(tf,[]))}),(0,jr.x)())}(n,e=nh(e),t)}function rh(n,e,t){const r=(e=nh(e)).map(c=>Pc(n,c,"on",t));return(0,ni.T)(...r)}function sh(n,e){return function(r,c){return eh(r,{stringCase:()=>n.child(r)[e](c),firebaseCase:()=>r[e](c),snapshotCase:()=>r.ref[e](c)})}}function af(n){return function(t){return t?eh(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function oh(n,e){return function(){return Pc(n,"value","on",e)}}const uf=new V.OlP("angularfire2.realtimeDatabaseURL"),df=new V.OlP("angularfire2.database.use-emulator");let hf=(()=>{class n{constructor(t,r,c,p,_,y,N,E,R,S,O,j,K,me,tt){this.schedulers=y;const ei=N,Fn=(0,Oe.on)(t,_,r);E&&Kd(Fn,_,R,O,j,K,S,me),this.database=(0,Oe.cc)(`${Fn.name}.database.${c}`,"AngularFireDatabase",Fn.name,()=>{const Gi=_.runOutsideAngular(()=>Fn.database(c||void 0));return ei&&Gi.useEmulator(...ei),Gi},[ei])}list(t,r){const c=this.schedulers.ngZone.runOutsideAngular(()=>Xd(this.database,t));let p=c;return r&&(p=r(c)),function lf(n,e){const t=e.schedulers.outsideAngular,r=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:sh(r,"update"),set:sh(r,"set"),push:c=>r.push(c),remove:af(r),snapshotChanges:c=>ih(n,c,t).pipe(Ce.iC),stateChanges:c=>rh(n,c,t).pipe(Ce.iC),auditTrail:c=>function nf(n,e,t){return function sf(n,e,t){return function rf(n,e){return Pc(n,"value","on",e).pipe((0,lt.U)(t=>{let r;return t.payload.forEach(c=>(r=c.key,!1)),{data:t,lastKeyToLoad:r}}))}(n,t).pipe((0,Ks.M)(e),(0,lt.U)(([c,p])=>{const _=c.lastKeyToLoad,y=p.map(N=>N.key);return{actions:p,lastKeyToLoad:_,loadedKeys:y}}),function Yr(n){return e=>e.lift(new jt(n))}(c=>-1===c.loadedKeys.indexOf(c.lastKeyToLoad)),(0,lt.U)(c=>c.actions))}(n,rh(n,e).pipe((0,Wi.R)((c,p)=>[...c,p],[])),t)}(n,c,t).pipe(Ce.iC),valueChanges:(c,p)=>ih(n,c,t).pipe((0,lt.U)(y=>y.map(N=>p&&p.idField?Object.assign(Object.assign({},N.payload.val()),{[p.idField]:N.key}):N.payload.val())),Ce.iC)}}(p,this)}object(t){return function cf(n,e){return{query:n,snapshotChanges:()=>oh(n,e.schedulers.outsideAngular)().pipe(Ce.iC),update:t=>n.ref.update(t),set:t=>n.ref.set(t),remove:()=>n.ref.remove(),valueChanges:()=>oh(n,e.schedulers.outsideAngular)().pipe(Ce.iC,(0,lt.U)(r=>r.payload.exists()?r.payload.val():null))}}(this.schedulers.ngZone.runOutsideAngular(()=>Xd(this.database,t)),this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}}return n.\u0275fac=function(t){return new(t||n)(V.LFG(Oe.Dh),V.LFG(Oe.xv,8),V.LFG(uf,8),V.LFG(V.Lbi),V.LFG(V.R0b),V.LFG(Ce.HU),V.LFG(df,8),V.LFG(qd,8),V.LFG(Wd,8),V.LFG(jd,8),V.LFG($d,8),V.LFG(Yd,8),V.LFG(zd,8),V.LFG(Zd,8),V.LFG(nd,8))},n.\u0275prov=V.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();var ff=F(629),pf=F(9644),gf=F(2290);let _f=(()=>{class n{constructor(t,r,c,p,_){this.fireMessaging=t,this.angularFireDatabase=r,this._auth=c,this._modal=p,this.toast=_,this.notificationsCount=0,this.totalNotifications=0,this.notifications=[],this.pageSize=10,this.destroyed$=new ne.xQ}ngOnDestroy(){this.removeSubscrtiption()}removeSubscrtiption(){this.destroyed$.next(),this.destroyed$.complete()}requestPermissions(){this.notifications=[],this.notificationsCount=0,this.pageSize=10,this.fireMessaging.requestPermission.subscribe(t=>{this.getToken()},t=>{})}getToken(){this.fireMessaging.requestToken.subscribe(t=>{if(t){let r;r=localStorage.getItem("uuid")?localStorage.getItem("uuid"):this.getUuid(),this._auth.updateNotificationDetails({uuid:r,firebase_token:t}).subscribe(c=>{this.initializeNotificationSettings(),localStorage.setItem("uuid",r)})}},t=>{console.log(t)})}initializeNotificationSettings(){this.destroyed$=new ne.xQ,this.notifications=[],this.notificationsCount=0,this.pageSize=10,this.initializeInAppNotifications(),this.fetchNotification()}initializeInAppNotifications(){this.fireMessaging.messages.pipe((0,h.R)(this.destroyed$)).subscribe(t=>{var r;(null===(r=t.data)||void 0===r?void 0:r.logout)?this.showReloadAlert(t.data):this.showInAppNotification(t.data)})}fetchNotification(){let t;t=this._auth.currentUserValue,t&&(this.notificationRef=this.angularFireDatabase.list("user-"+t.id+"/notifications",r=>(r.orderByChild("created_at"),r)),this.subscribeNotification())}subscribeNotification(){this.notificationSubscriber=this.notificationRef.snapshotChanges().pipe((0,h.R)(this.destroyed$)).subscribe(t=>{let r=t.slice();r=r.reverse();let c=r.length;this.notifications=[];for(const p of r)if(p.payload&&(this.notifications.push(p),p.payload.val().is_read)){c--,c<0&&(c=0);continue}this.notificationsCount=c,this.totalNotifications=this.notifications.length})}readNotification(t){const r=t.payload.val();r.is_read||this.notificationRef.update(t.key,{is_read:!0}).then(c=>{r.logout&&(localStorage.getItem("uuid"),this._auth.logout())}).catch(c=>{console.log(c)})}showInAppNotification(t){this.toast.success(null==t?void 0:t.body,null==t?void 0:t.title,{enableHtml:!0})}getUuid(){return St()}loadMore(t){t.stopPropagation(),this.totalNotifications>this.pageSize&&(this.pageSize=this.pageSize+10)}showReloadAlert(t){}}return n.\u0275fac=function(t){return new(t||n)(V.LFG(Ie),V.LFG(hf),V.LFG(ff.e),V.LFG(pf.FF),V.LFG(gf._W))},n.\u0275prov=V.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()},4087:(Vr,Dt,F)=>{F.r(Dt);var h=F(5861),ne=F(3942),x=F(2090),$e=F(9681),at=F(655),he=F(1877),te=F(4859);const V=function dt(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},Ft=function St(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Ee=new x.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),ti=new he.Yd("@firebase/auth");function Hi(d,...o){ti.logLevel<=he.in.ERROR&&ti.error(`Auth (${$e.SDK_VERSION}): ${d}`,...o)}function Te(d,...o){throw ht(d,...o)}function ve(d,...o){return ht(d,...o)}function Je(d,o,a){const f=Object.assign(Object.assign({},Ft()),{[o]:a});return new x.LL("auth","Firebase",f).create(o,{appName:d.name})}function lt(d,o,a){if(!(o instanceof a))throw a.name!==o.constructor.name&&Te(d,"argument-error"),Je(d,"argument-error",`Type of ${o.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function ht(d,...o){if("string"!=typeof d){const a=o[0],f=[...o.slice(1)];return f[0]&&(f[0].appName=d.name),d._errorFactory.create(a,...f)}return Ee.create(d,...o)}function U(d,o,...a){if(!d)throw ht(o,...a)}function M(d){const o="INTERNAL ASSERTION FAILED: "+d;throw Hi(o),new Error(o)}function L(d,o){d||M(o)}const G=new Map;function B(d){L(d instanceof Function,"Expected a class definition");let o=G.get(d);return o?(L(o instanceof d,"Instance stored in cache mismatched with class"),o):(o=new d,G.set(d,o),o)}function ie(){var d;return"undefined"!=typeof self&&(null===(d=self.location)||void 0===d?void 0:d.href)||""}function ke(){return"http:"===Lt()||"https:"===Lt()}function Lt(){var d;return"undefined"!=typeof self&&(null===(d=self.location)||void 0===d?void 0:d.protocol)||null}class Oe{constructor(o,a){this.shortDelay=o,this.longDelay=a,L(a>o,"Short delay should be less than long delay!"),this.isMobile=(0,x.uI)()||(0,x.b$)()}get(){return function ue(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(ke()||(0,x.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Qe(d,o){L(d.emulator,"Emulator should always be set here");const{url:a}=d.emulator;return o?`${a}${o.startsWith("/")?o.slice(1):o}`:a}class Ln{static initialize(o,a,f){this.fetchImpl=o,a&&(this.headersImpl=a),f&&(this.responseImpl=f)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void M("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void M("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void M("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Vi={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},ze=new Oe(3e4,6e4);function Be(d,o){return d.tenantId&&!o.tenantId?Object.assign(Object.assign({},o),{tenantId:d.tenantId}):o}function Ie(d,o,a,f){return Nn.apply(this,arguments)}function Nn(){return(Nn=(0,h.Z)(function*(d,o,a,f,v={}){return Wr(d,v,(0,h.Z)(function*(){let b={},C={};f&&("GET"===o?C=f:b={body:JSON.stringify(f)});const A=(0,x.xO)(Object.assign({key:d.config.apiKey},C)).slice(1),H=yield d._getAdditionalHeaders();return H["Content-Type"]="application/json",d.languageCode&&(H["X-Firebase-Locale"]=d.languageCode),Ln.fetch()(jr(d,d.config.apiHost,a,A),Object.assign({method:o,headers:H,referrerPolicy:"no-referrer"},b))}))})).apply(this,arguments)}function Wr(d,o,a){return ni.apply(this,arguments)}function ni(){return(ni=(0,h.Z)(function*(d,o,a){d._canInitEmulator=!1;const f=Object.assign(Object.assign({},Vi),o);try{const v=new Ks(d),b=yield Promise.race([a(),v.promise]);v.clearNetworkTimeout();const C=yield b.json();if("needConfirmation"in C)throw $r(d,"account-exists-with-different-credential",C);if(b.ok&&!("errorMessage"in C))return C;{const A=b.ok?C.errorMessage:C.error.message,[H,Y]=A.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===H)throw $r(d,"credential-already-in-use",C);if("EMAIL_EXISTS"===H)throw $r(d,"email-already-in-use",C);const J=f[H]||H.toLowerCase().replace(/[_\s]+/g,"-");if(Y)throw Je(d,J,Y);Te(d,J)}}catch(v){if(v instanceof x.ZR)throw v;Te(d,"network-request-failed")}})).apply(this,arguments)}function nn(d,o,a,f){return Wi.apply(this,arguments)}function Wi(){return(Wi=(0,h.Z)(function*(d,o,a,f,v={}){const b=yield Ie(d,o,a,f,v);return"mfaPendingCredential"in b&&Te(d,"multi-factor-auth-required",{_serverResponse:b}),b})).apply(this,arguments)}function jr(d,o,a,f){const v=`${o}${a}?${f}`;return d.config.emulator?Qe(d.config,v):`${d.config.apiScheme}://${v}`}class Ks{constructor(o){this.auth=o,this.timer=null,this.promise=new Promise((a,f)=>{this.timer=setTimeout(()=>f(ve(this.auth,"network-request-failed")),ze.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function $r(d,o,a){const f={appName:d.name};a.email&&(f.email=a.email),a.phoneNumber&&(f.phoneNumber=a.phoneNumber);const v=ve(d,o,f);return v.customData._tokenResponse=a,v}function jt(){return(jt=(0,h.Z)(function*(d,o){return Ie(d,"POST","/v1/accounts:delete",o)})).apply(this,arguments)}function Fl(d,o){return qs.apply(this,arguments)}function qs(){return(qs=(0,h.Z)(function*(d,o){return Ie(d,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function Ut(d,o){return nt.apply(this,arguments)}function nt(){return(nt=(0,h.Z)(function*(d,o){return Ie(d,"POST","/v1/accounts:lookup",o)})).apply(this,arguments)}function Xe(d){if(d)try{const o=new Date(Number(d));if(!isNaN(o.getTime()))return o.toUTCString()}catch(o){}}function rn(){return(rn=(0,h.Z)(function*(d,o=!1){const a=(0,x.m9)(d),f=yield a.getIdToken(o),v=wn(f);U(v&&v.exp&&v.auth_time&&v.iat,a.auth,"internal-error");const b="object"==typeof v.firebase?v.firebase:void 0,C=null==b?void 0:b.sign_in_provider;return{claims:v,token:f,authTime:Xe(Tn(v.auth_time)),issuedAtTime:Xe(Tn(v.iat)),expirationTime:Xe(Tn(v.exp)),signInProvider:C||null,signInSecondFactor:(null==b?void 0:b.sign_in_second_factor)||null}})).apply(this,arguments)}function Tn(d){return 1e3*Number(d)}function wn(d){const[o,a,f]=d.split(".");if(void 0===o||void 0===a||void 0===f)return Hi("JWT malformed, contained fewer than 3 sections"),null;try{const v=(0,x.tV)(a);return v?JSON.parse(v):(Hi("Failed to decode base64 JWT payload"),null)}catch(v){return Hi("Caught error parsing JWT payload as JSON",v),null}}function $t(d,o){return ii.apply(this,arguments)}function ii(){return(ii=(0,h.Z)(function*(d,o,a=!1){if(a)return o;try{return yield o}catch(f){throw f instanceof x.ZR&&Ll(f)&&d.auth.currentUser===d&&(yield d.auth.signOut()),f}})).apply(this,arguments)}function Ll({code:d}){return"auth/user-disabled"===d||"auth/user-token-expired"===d}class Qs{constructor(o){this.user=o,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(o){var a;if(o){const f=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),f}{this.errorBackoff=3e4;const v=(null!==(a=this.user.stsTokenManager.expirationTime)&&void 0!==a?a:0)-Date.now()-3e5;return Math.max(0,v)}}schedule(o=!1){var a=this;if(!this.isRunning)return;const f=this.getInterval(o);this.timerId=setTimeout((0,h.Z)(function*(){yield a.iteration()}),f)}iteration(){var o=this;return(0,h.Z)(function*(){try{yield o.user.getIdToken(!0)}catch(a){return void("auth/network-request-failed"===a.code&&o.schedule(!0))}o.schedule()})()}}class Un{constructor(o,a){this.createdAt=o,this.lastLoginAt=a,this._initializeTime()}_initializeTime(){this.lastSignInTime=Xe(this.lastLoginAt),this.creationTime=Xe(this.createdAt)}_copy(o){this.createdAt=o.createdAt,this.lastLoginAt=o.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function ri(d){return Bn.apply(this,arguments)}function Bn(){return(Bn=(0,h.Z)(function*(d){var o;const a=d.auth,f=yield d.getIdToken(),v=yield $t(d,Ut(a,{idToken:f}));U(null==v?void 0:v.users.length,a,"internal-error");const b=v.users[0];d._notifyReloadListener(b);const C=(null===(o=b.providerUserInfo)||void 0===o?void 0:o.length)?si(b.providerUserInfo):[],A=ji(d.providerData,C),J=!!d.isAnonymous&&!(d.email&&b.passwordHash||(null==A?void 0:A.length)),Q={uid:b.localId,displayName:b.displayName||null,photoURL:b.photoUrl||null,email:b.email||null,emailVerified:b.emailVerified||!1,phoneNumber:b.phoneNumber||null,tenantId:b.tenantId||null,providerData:A,metadata:new Un(b.createdAt,b.lastLoginAt),isAnonymous:J};Object.assign(d,Q)})).apply(this,arguments)}function zr(){return(zr=(0,h.Z)(function*(d){const o=(0,x.m9)(d);yield ri(o),yield o.auth._persistUserIfCurrent(o),o.auth._notifyListenersIfCurrent(o)})).apply(this,arguments)}function ji(d,o){return[...d.filter(f=>!o.some(v=>v.providerId===f.providerId)),...o]}function si(d){return d.map(o=>{var{providerId:a}=o,f=(0,at._T)(o,["providerId"]);return{providerId:a,uid:f.rawId||"",displayName:f.displayName||null,email:f.email||null,phoneNumber:f.phoneNumber||null,photoURL:f.photoUrl||null}})}function Zr(){return(Zr=(0,h.Z)(function*(d,o){const a=yield Wr(d,{},(0,h.Z)(function*(){const f=(0,x.xO)({grant_type:"refresh_token",refresh_token:o}).slice(1),{tokenApiHost:v,apiKey:b}=d.config,C=jr(d,v,"/v1/token",`key=${b}`),A=yield d._getAdditionalHeaders();return A["Content-Type"]="application/x-www-form-urlencoded",Ln.fetch()(C,{method:"POST",headers:A,body:f})}));return{accessToken:a.access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token}})).apply(this,arguments)}class Ye{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(o){U(o.idToken,"internal-error"),U(void 0!==o.idToken,"internal-error"),U(void 0!==o.refreshToken,"internal-error");const a="expiresIn"in o&&void 0!==o.expiresIn?Number(o.expiresIn):function Js(d){const o=wn(d);return U(o,"internal-error"),U(void 0!==o.exp,"internal-error"),U(void 0!==o.iat,"internal-error"),Number(o.exp)-Number(o.iat)}(o.idToken);this.updateTokensAndExpiration(o.idToken,o.refreshToken,a)}getToken(o,a=!1){var f=this;return(0,h.Z)(function*(){return U(!f.accessToken||f.refreshToken,o,"user-token-expired"),a||!f.accessToken||f.isExpired?f.refreshToken?(yield f.refresh(o,f.refreshToken),f.accessToken):null:f.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(o,a){var f=this;return(0,h.Z)(function*(){const{accessToken:v,refreshToken:b,expiresIn:C}=yield function wa(d,o){return Zr.apply(this,arguments)}(o,a);f.updateTokensAndExpiration(v,b,Number(C))})()}updateTokensAndExpiration(o,a,f){this.refreshToken=a||null,this.accessToken=o||null,this.expirationTime=Date.now()+1e3*f}static fromJSON(o,a){const{refreshToken:f,accessToken:v,expirationTime:b}=a,C=new Ye;return f&&(U("string"==typeof f,"internal-error",{appName:o}),C.refreshToken=f),v&&(U("string"==typeof v,"internal-error",{appName:o}),C.accessToken=v),b&&(U("number"==typeof b,"internal-error",{appName:o}),C.expirationTime=b),C}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(o){this.accessToken=o.accessToken,this.refreshToken=o.refreshToken,this.expirationTime=o.expirationTime}_clone(){return Object.assign(new Ye,this.toJSON())}_performRefresh(){return M("not implemented")}}function Bt(d,o){U("string"==typeof d||void 0===d,"internal-error",{appName:o})}class it{constructor(o){var{uid:a,auth:f,stsTokenManager:v}=o,b=(0,at._T)(o,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Qs(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=a,this.auth=f,this.stsTokenManager=v,this.accessToken=v.accessToken,this.displayName=b.displayName||null,this.email=b.email||null,this.emailVerified=b.emailVerified||!1,this.phoneNumber=b.phoneNumber||null,this.photoURL=b.photoURL||null,this.isAnonymous=b.isAnonymous||!1,this.tenantId=b.tenantId||null,this.providerData=b.providerData?[...b.providerData]:[],this.metadata=new Un(b.createdAt||void 0,b.lastLoginAt||void 0)}getIdToken(o){var a=this;return(0,h.Z)(function*(){const f=yield $t(a,a.stsTokenManager.getToken(a.auth,o));return U(f,a.auth,"internal-error"),a.accessToken!==f&&(a.accessToken=f,yield a.auth._persistUserIfCurrent(a),a.auth._notifyListenersIfCurrent(a)),f})()}getIdTokenResult(o){return function T(d){return rn.apply(this,arguments)}(this,o)}reload(){return function Ta(d){return zr.apply(this,arguments)}(this)}_assign(o){this!==o&&(U(this.uid===o.uid,this.auth,"internal-error"),this.displayName=o.displayName,this.photoURL=o.photoURL,this.email=o.email,this.emailVerified=o.emailVerified,this.phoneNumber=o.phoneNumber,this.isAnonymous=o.isAnonymous,this.tenantId=o.tenantId,this.providerData=o.providerData.map(a=>Object.assign({},a)),this.metadata._copy(o.metadata),this.stsTokenManager._assign(o.stsTokenManager))}_clone(o){return new it(Object.assign(Object.assign({},this),{auth:o,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(o){U(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=o,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(o){this.reloadListener?this.reloadListener(o):this.reloadUserInfo=o}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(o,a=!1){var f=this;return(0,h.Z)(function*(){let v=!1;o.idToken&&o.idToken!==f.stsTokenManager.accessToken&&(f.stsTokenManager.updateFromServerResponse(o),v=!0),a&&(yield ri(f)),yield f.auth._persistUserIfCurrent(f),v&&f.auth._notifyListenersIfCurrent(f)})()}delete(){var o=this;return(0,h.Z)(function*(){const a=yield o.getIdToken();return yield $t(o,function Yr(d,o){return jt.apply(this,arguments)}(o.auth,{idToken:a})),o.stsTokenManager.clearRefreshToken(),o.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(o=>Object.assign({},o)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(o,a){var f,v,b,C,A,H,Y,J;const Q=null!==(f=a.displayName)&&void 0!==f?f:void 0,we=null!==(v=a.email)&&void 0!==v?v:void 0,_t=null!==(b=a.phoneNumber)&&void 0!==b?b:void 0,Ws=null!==(C=a.photoURL)&&void 0!==C?C:void 0,Dl=null!==(A=a.tenantId)&&void 0!==A?A:void 0,Xn=null!==(H=a._redirectEventId)&&void 0!==H?H:void 0,Sl=null!==(Y=a.createdAt)&&void 0!==Y?Y:void 0,Dc=null!==(J=a.lastLoginAt)&&void 0!==J?J:void 0,{uid:Rl,emailVerified:Fr,isAnonymous:Sc,providerData:Al,stsTokenManager:va}=a;U(Rl&&va,o,"internal-error");const lu=Ye.fromJSON(this.name,va);U("string"==typeof Rl,o,"internal-error"),Bt(Q,o.name),Bt(we,o.name),U("boolean"==typeof Fr,o,"internal-error"),U("boolean"==typeof Sc,o,"internal-error"),Bt(_t,o.name),Bt(Ws,o.name),Bt(Dl,o.name),Bt(Xn,o.name),Bt(Sl,o.name),Bt(Dc,o.name);const Lr=new it({uid:Rl,auth:o,email:we,emailVerified:Fr,displayName:Q,isAnonymous:Sc,photoURL:Ws,phoneNumber:_t,tenantId:Dl,stsTokenManager:lu,createdAt:Sl,lastLoginAt:Dc});return Al&&Array.isArray(Al)&&(Lr.providerData=Al.map(ya=>Object.assign({},ya))),Xn&&(Lr._redirectEventId=Xn),Lr}static _fromIdTokenResponse(o,a,f=!1){return(0,h.Z)(function*(){const v=new Ye;v.updateFromServerResponse(a);const b=new it({uid:a.localId,auth:o,stsTokenManager:v,isAnonymous:f});return yield ri(b),b})()}}const ye=(()=>{class d{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,h.Z)(function*(){return!0})()}_set(a,f){var v=this;return(0,h.Z)(function*(){v.storage[a]=f})()}_get(a){var f=this;return(0,h.Z)(function*(){const v=f.storage[a];return void 0===v?null:v})()}_remove(a){var f=this;return(0,h.Z)(function*(){delete f.storage[a]})()}_addListener(a,f){}_removeListener(a,f){}}return d.type="NONE",d})();function Gn(d,o,a){return`firebase:${d}:${o}:${a}`}class pt{constructor(o,a,f){this.persistence=o,this.auth=a,this.userKey=f;const{config:v,name:b}=this.auth;this.fullUserKey=Gn(this.userKey,v.apiKey,b),this.fullPersistenceKey=Gn("persistence",v.apiKey,b),this.boundEventHandler=a._onStorageEvent.bind(a),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(o){return this.persistence._set(this.fullUserKey,o.toJSON())}getCurrentUser(){var o=this;return(0,h.Z)(function*(){const a=yield o.persistence._get(o.fullUserKey);return a?it._fromJSON(o.auth,a):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(o){var a=this;return(0,h.Z)(function*(){if(a.persistence===o)return;const f=yield a.getCurrentUser();return yield a.removeCurrentUser(),a.persistence=o,f?a.setCurrentUser(f):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(o,a,f="authUser"){return(0,h.Z)(function*(){if(!a.length)return new pt(B(ye),o,f);const v=(yield Promise.all(a.map(function(){var Y=(0,h.Z)(function*(J){if(yield J._isAvailable())return J});return function(J){return Y.apply(this,arguments)}}()))).filter(Y=>Y);let b=v[0]||B(ye);const C=Gn(f,o.config.apiKey,o.name);let A=null;for(const Y of a)try{const J=yield Y._get(C);if(J){const Q=it._fromJSON(o,J);Y!==b&&(A=Q),b=Y;break}}catch(J){}const H=v.filter(Y=>Y._shouldAllowMigration);return b._shouldAllowMigration&&H.length?(b=H[0],A&&(yield b._set(C,A.toJSON())),yield Promise.all(a.map(function(){var Y=(0,h.Z)(function*(J){if(J!==b)try{yield J._remove(C)}catch(Q){}});return function(J){return Y.apply(this,arguments)}}())),new pt(b,o,f)):new pt(b,o,f)})()}}function Hn(d){const o=d.toLowerCase();if(o.includes("opera/")||o.includes("opr/")||o.includes("opios/"))return"Opera";if(Kr(o))return"IEMobile";if(o.includes("msie")||o.includes("trident/"))return"IE";if(o.includes("edge/"))return"Edge";if(Rt(o))return"Firefox";if(o.includes("silk/"))return"Silk";if(qr(o))return"Blackberry";if(zt(o))return"Webos";if(ct(o))return"Safari";if((o.includes("chrome/")||At(o))&&!o.includes("edge/"))return"Chrome";if(Yt(o))return"Android";{const f=d.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==f?void 0:f.length))return f[1]}return"Other"}function Rt(d=(0,x.z$)()){return/firefox\//i.test(d)}function ct(d=(0,x.z$)()){const o=d.toLowerCase();return o.includes("safari/")&&!o.includes("chrome/")&&!o.includes("crios/")&&!o.includes("android")}function At(d=(0,x.z$)()){return/crios\//i.test(d)}function Kr(d=(0,x.z$)()){return/iemobile/i.test(d)}function Yt(d=(0,x.z$)()){return/android/i.test(d)}function qr(d=(0,x.z$)()){return/blackberry/i.test(d)}function zt(d=(0,x.z$)()){return/webos/i.test(d)}function Ve(d=(0,x.z$)()){return/iphone|ipad|ipod/i.test(d)}function eo(d=(0,x.z$)()){return Ve(d)||Yt(d)||zt(d)||qr(d)||/windows phone/i.test(d)||Kr(d)}function to(d,o=[]){let a;switch(d){case"Browser":a=Hn((0,x.z$)());break;case"Worker":a=`${Hn((0,x.z$)())}-${d}`;break;default:a=d}const f=o.length?o.join(","):"FirebaseCore-web";return`${a}/JsCore/${$e.SDK_VERSION}/${f}`}class Qr{constructor(o,a,f){this.app=o,this.heartbeatServiceProvider=a,this.config=f,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Kt(this),this.idTokenSubscription=new Kt(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Ee,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=o.name,this.clientVersion=f.sdkClientVersion}_initializeWithPersistence(o,a){var f=this;return a&&(this._popupRedirectResolver=B(a)),this._initializationPromise=this.queue((0,h.Z)(function*(){var v,b;if(!f._deleted&&(f.persistenceManager=yield pt.create(f,o),!f._deleted)){if(null===(v=f._popupRedirectResolver)||void 0===v?void 0:v._shouldInitProactively)try{yield f._popupRedirectResolver._initialize(f)}catch(C){}yield f.initializeCurrentUser(a),f.lastNotifiedUid=(null===(b=f.currentUser)||void 0===b?void 0:b.uid)||null,!f._deleted&&(f._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var o=this;return(0,h.Z)(function*(){if(o._deleted)return;const a=yield o.assertedPersistence.getCurrentUser();if(o.currentUser||a){if(o.currentUser&&a&&o.currentUser.uid===a.uid)return o._currentUser._assign(a),void(yield o.currentUser.getIdToken());yield o._updateCurrentUser(a)}})()}initializeCurrentUser(o){var a=this;return(0,h.Z)(function*(){var f;let v=yield a.assertedPersistence.getCurrentUser();if(o&&a.config.authDomain){yield a.getOrInitRedirectPersistenceManager();const b=null===(f=a.redirectUser)||void 0===f?void 0:f._redirectEventId,C=null==v?void 0:v._redirectEventId,A=yield a.tryRedirectSignIn(o);(!b||b===C)&&(null==A?void 0:A.user)&&(v=A.user)}return v?v._redirectEventId?(U(a._popupRedirectResolver,a,"argument-error"),yield a.getOrInitRedirectPersistenceManager(),a.redirectUser&&a.redirectUser._redirectEventId===v._redirectEventId?a.directlySetCurrentUser(v):a.reloadAndSetCurrentUserOrClear(v)):a.reloadAndSetCurrentUserOrClear(v):a.directlySetCurrentUser(null)})()}tryRedirectSignIn(o){var a=this;return(0,h.Z)(function*(){let f=null;try{f=yield a._popupRedirectResolver._completeRedirectFn(a,o,!0)}catch(v){yield a._setRedirectUser(null)}return f})()}reloadAndSetCurrentUserOrClear(o){var a=this;return(0,h.Z)(function*(){try{yield ri(o)}catch(f){if("auth/network-request-failed"!==f.code)return a.directlySetCurrentUser(null)}return a.directlySetCurrentUser(o)})()}useDeviceLanguage(){this.languageCode=function Ce(){if("undefined"==typeof navigator)return null;const d=navigator;return d.languages&&d.languages[0]||d.language||null}()}_delete(){var o=this;return(0,h.Z)(function*(){o._deleted=!0})()}updateCurrentUser(o){var a=this;return(0,h.Z)(function*(){const f=o?(0,x.m9)(o):null;return f&&U(f.auth.config.apiKey===a.config.apiKey,a,"invalid-user-token"),a._updateCurrentUser(f&&f._clone(a))})()}_updateCurrentUser(o){var a=this;return(0,h.Z)(function*(){if(!a._deleted)return o&&U(a.tenantId===o.tenantId,a,"tenant-id-mismatch"),a.queue((0,h.Z)(function*(){yield a.directlySetCurrentUser(o),a.notifyAuthListeners()}))})()}signOut(){var o=this;return(0,h.Z)(function*(){return(o.redirectPersistenceManager||o._popupRedirectResolver)&&(yield o._setRedirectUser(null)),o._updateCurrentUser(null)})()}setPersistence(o){var a=this;return this.queue((0,h.Z)(function*(){yield a.assertedPersistence.setPersistence(B(o))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(o){this._errorFactory=new x.LL("auth","Firebase",o())}onAuthStateChanged(o,a,f){return this.registerStateListener(this.authStateSubscription,o,a,f)}onIdTokenChanged(o,a,f){return this.registerStateListener(this.idTokenSubscription,o,a,f)}toJSON(){var o;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(o=this._currentUser)||void 0===o?void 0:o.toJSON()}}_setRedirectUser(o,a){var f=this;return(0,h.Z)(function*(){const v=yield f.getOrInitRedirectPersistenceManager(a);return null===o?v.removeCurrentUser():v.setCurrentUser(o)})()}getOrInitRedirectPersistenceManager(o){var a=this;return(0,h.Z)(function*(){if(!a.redirectPersistenceManager){const f=o&&B(o)||a._popupRedirectResolver;U(f,a,"argument-error"),a.redirectPersistenceManager=yield pt.create(a,[B(f._redirectPersistence)],"redirectUser"),a.redirectUser=yield a.redirectPersistenceManager.getCurrentUser()}return a.redirectPersistenceManager})()}_redirectUserForId(o){var a=this;return(0,h.Z)(function*(){var f,v;return a._isInitialized&&(yield a.queue((0,h.Z)(function*(){}))),(null===(f=a._currentUser)||void 0===f?void 0:f._redirectEventId)===o?a._currentUser:(null===(v=a.redirectUser)||void 0===v?void 0:v._redirectEventId)===o?a.redirectUser:null})()}_persistUserIfCurrent(o){var a=this;return(0,h.Z)(function*(){if(o===a.currentUser)return a.queue((0,h.Z)(function*(){return a.directlySetCurrentUser(o)}))})()}_notifyListenersIfCurrent(o){o===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var o,a;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const f=null!==(a=null===(o=this.currentUser)||void 0===o?void 0:o.uid)&&void 0!==a?a:null;this.lastNotifiedUid!==f&&(this.lastNotifiedUid=f,this.authStateSubscription.next(this.currentUser))}registerStateListener(o,a,f,v){if(this._deleted)return()=>{};const b="function"==typeof a?a:a.next.bind(a),C=this._isInitialized?Promise.resolve():this._initializationPromise;return U(C,this,"internal-error"),C.then(()=>b(this.currentUser)),"function"==typeof a?o.addObserver(a,f,v):o.addObserver(a)}directlySetCurrentUser(o){var a=this;return(0,h.Z)(function*(){a.currentUser&&a.currentUser!==o&&(a._currentUser._stopProactiveRefresh(),o&&a.isProactiveRefreshEnabled&&o._startProactiveRefresh()),a.currentUser=o,o?yield a.assertedPersistence.setCurrentUser(o):yield a.assertedPersistence.removeCurrentUser()})()}queue(o){return this.operations=this.operations.then(o,o),this.operations}get assertedPersistence(){return U(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(o){!o||this.frameworks.includes(o)||(this.frameworks.push(o),this.frameworks.sort(),this.clientVersion=to(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var o=this;return(0,h.Z)(function*(){var a;const f={"X-Client-Version":o.clientVersion};o.app.options.appId&&(f["X-Firebase-gmpid"]=o.app.options.appId);const v=yield null===(a=o.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===a?void 0:a.getHeartbeatsHeader();return v&&(f["X-Firebase-Client"]=v),f})()}}function Ze(d){return(0,x.m9)(d)}class Kt{constructor(o){this.auth=o,this.observer=null,this.addObserver=(0,x.ne)(a=>this.observer=a)}get next(){return U(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Vn(d){const o=d.indexOf(":");return o<0?"":d.substr(0,o+1)}function no(d){if(!d)return null;const o=Number(d);return isNaN(o)?null:o}class En{constructor(o,a){this.providerId=o,this.signInMethod=a}toJSON(){return M("not implemented")}_getIdTokenResponse(o){return M("not implemented")}_linkToIdToken(o,a){return M("not implemented")}_getReauthenticationResolver(o){return M("not implemented")}}function Wn(d,o){return mi.apply(this,arguments)}function mi(){return(mi=(0,h.Z)(function*(d,o){return Ie(d,"POST","/v1/accounts:resetPassword",Be(d,o))})).apply(this,arguments)}function Xr(d,o){return zi.apply(this,arguments)}function zi(){return(zi=(0,h.Z)(function*(d,o){return Ie(d,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function io(d,o){return Zi.apply(this,arguments)}function Zi(){return(Zi=(0,h.Z)(function*(d,o){return Ie(d,"POST","/v1/accounts:update",Be(d,o))})).apply(this,arguments)}function Ki(){return(Ki=(0,h.Z)(function*(d,o){return nn(d,"POST","/v1/accounts:signInWithPassword",Be(d,o))})).apply(this,arguments)}function qi(d,o){return es.apply(this,arguments)}function es(){return(es=(0,h.Z)(function*(d,o){return Ie(d,"POST","/v1/accounts:sendOobCode",Be(d,o))})).apply(this,arguments)}function so(d,o){return oo.apply(this,arguments)}function oo(){return(oo=(0,h.Z)(function*(d,o){return qi(d,o)})).apply(this,arguments)}function vi(d,o){return ao.apply(this,arguments)}function ao(){return(ao=(0,h.Z)(function*(d,o){return qi(d,o)})).apply(this,arguments)}function Ji(d,o){return Qi.apply(this,arguments)}function Qi(){return(Qi=(0,h.Z)(function*(d,o){return qi(d,o)})).apply(this,arguments)}function lo(d,o){return co.apply(this,arguments)}function co(){return(co=(0,h.Z)(function*(d,o){return qi(d,o)})).apply(this,arguments)}function ts(){return(ts=(0,h.Z)(function*(d,o){return nn(d,"POST","/v1/accounts:signInWithEmailLink",Be(d,o))})).apply(this,arguments)}function uo(){return(uo=(0,h.Z)(function*(d,o){return nn(d,"POST","/v1/accounts:signInWithEmailLink",Be(d,o))})).apply(this,arguments)}class Xi extends En{constructor(o,a,f,v=null){super("password",f),this._email=o,this._password=a,this._tenantId=v}static _fromEmailAndPassword(o,a){return new Xi(o,a,"password")}static _fromEmailAndCode(o,a,f=null){return new Xi(o,a,"emailLink",f)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o;if((null==a?void 0:a.email)&&(null==a?void 0:a.password)){if("password"===a.signInMethod)return this._fromEmailAndPassword(a.email,a.password);if("emailLink"===a.signInMethod)return this._fromEmailAndCode(a.email,a.password,a.tenantId)}return null}_getIdTokenResponse(o){var a=this;return(0,h.Z)(function*(){switch(a.signInMethod){case"password":return function ro(d,o){return Ki.apply(this,arguments)}(o,{returnSecureToken:!0,email:a._email,password:a._password});case"emailLink":return function Bl(d,o){return ts.apply(this,arguments)}(o,{email:a._email,oobCode:a._password});default:Te(o,"internal-error")}})()}_linkToIdToken(o,a){var f=this;return(0,h.Z)(function*(){switch(f.signInMethod){case"password":return Xr(o,{idToken:a,returnSecureToken:!0,email:f._email,password:f._password});case"emailLink":return function Gl(d,o){return uo.apply(this,arguments)}(o,{idToken:a,email:f._email,oobCode:f._password});default:Te(o,"internal-error")}})()}_getReauthenticationResolver(o){return this._getIdTokenResponse(o)}}function sn(d,o){return ns.apply(this,arguments)}function ns(){return(ns=(0,h.Z)(function*(d,o){return nn(d,"POST","/v1/accounts:signInWithIdp",Be(d,o))})).apply(this,arguments)}class on extends En{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(o){const a=new on(o.providerId,o.signInMethod);return o.idToken||o.accessToken?(o.idToken&&(a.idToken=o.idToken),o.accessToken&&(a.accessToken=o.accessToken),o.nonce&&!o.pendingToken&&(a.nonce=o.nonce),o.pendingToken&&(a.pendingToken=o.pendingToken)):o.oauthToken&&o.oauthTokenSecret?(a.accessToken=o.oauthToken,a.secret=o.oauthTokenSecret):Te("argument-error"),a}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o,{providerId:f,signInMethod:v}=a,b=(0,at._T)(a,["providerId","signInMethod"]);if(!f||!v)return null;const C=new on(f,v);return C.idToken=b.idToken||void 0,C.accessToken=b.accessToken||void 0,C.secret=b.secret,C.nonce=b.nonce,C.pendingToken=b.pendingToken||null,C}_getIdTokenResponse(o){return sn(o,this.buildRequest())}_linkToIdToken(o,a){const f=this.buildRequest();return f.idToken=a,sn(o,f)}_getReauthenticationResolver(o){const a=this.buildRequest();return a.autoCreate=!1,sn(o,a)}buildRequest(){const o={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)o.pendingToken=this.pendingToken;else{const a={};this.idToken&&(a.id_token=this.idToken),this.accessToken&&(a.access_token=this.accessToken),this.secret&&(a.oauth_token_secret=this.secret),a.providerId=this.providerId,this.nonce&&!this.pendingToken&&(a.nonce=this.nonce),o.postBody=(0,x.xO)(a)}return o}}function Hl(d,o){return ho.apply(this,arguments)}function ho(){return(ho=(0,h.Z)(function*(d,o){return Ie(d,"POST","/v1/accounts:sendVerificationCode",Be(d,o))})).apply(this,arguments)}function Ia(){return(Ia=(0,h.Z)(function*(d,o){return nn(d,"POST","/v1/accounts:signInWithPhoneNumber",Be(d,o))})).apply(this,arguments)}function er(){return(er=(0,h.Z)(function*(d,o){const a=yield nn(d,"POST","/v1/accounts:signInWithPhoneNumber",Be(d,o));if(a.temporaryProof)throw $r(d,"account-exists-with-different-credential",a);return a})).apply(this,arguments)}const Vl={USER_NOT_FOUND:"user-not-found"};function yi(){return(yi=(0,h.Z)(function*(d,o){return nn(d,"POST","/v1/accounts:signInWithPhoneNumber",Be(d,Object.assign(Object.assign({},o),{operation:"REAUTH"})),Vl)})).apply(this,arguments)}class Gt extends En{constructor(o){super("phone","phone"),this.params=o}static _fromVerification(o,a){return new Gt({verificationId:o,verificationCode:a})}static _fromTokenResponse(o,a){return new Gt({phoneNumber:o,temporaryProof:a})}_getIdTokenResponse(o){return function xc(d,o){return Ia.apply(this,arguments)}(o,this._makeVerificationRequest())}_linkToIdToken(o,a){return function fo(d,o){return er.apply(this,arguments)}(o,Object.assign({idToken:a},this._makeVerificationRequest()))}_getReauthenticationResolver(o){return function Fc(d,o){return yi.apply(this,arguments)}(o,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:o,phoneNumber:a,verificationId:f,verificationCode:v}=this.params;return o&&a?{temporaryProof:o,phoneNumber:a}:{sessionInfo:f,code:v}}toJSON(){const o={providerId:this.providerId};return this.params.phoneNumber&&(o.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(o.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(o.verificationCode=this.params.verificationCode),this.params.verificationId&&(o.verificationId=this.params.verificationId),o}static fromJSON(o){"string"==typeof o&&(o=JSON.parse(o));const{verificationId:a,verificationCode:f,phoneNumber:v,temporaryProof:b}=o;return f||a||v||b?new Gt({verificationId:a,verificationCode:f,phoneNumber:v,temporaryProof:b}):null}}class tr{constructor(o){var a,f,v,b,C,A;const H=(0,x.zd)((0,x.pd)(o)),Y=null!==(a=H.apiKey)&&void 0!==a?a:null,J=null!==(f=H.oobCode)&&void 0!==f?f:null,Q=function po(d){switch(d){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(v=H.mode)&&void 0!==v?v:null);U(Y&&J&&Q,"argument-error"),this.apiKey=Y,this.operation=Q,this.code=J,this.continueUrl=null!==(b=H.continueUrl)&&void 0!==b?b:null,this.languageCode=null!==(C=H.languageCode)&&void 0!==C?C:null,this.tenantId=null!==(A=H.tenantId)&&void 0!==A?A:null}static parseLink(o){const a=function Wl(d){const o=(0,x.zd)((0,x.pd)(d)).link,a=o?(0,x.zd)((0,x.pd)(o)).deep_link_id:null,f=(0,x.zd)((0,x.pd)(d)).deep_link_id;return(f?(0,x.zd)((0,x.pd)(f)).link:null)||f||a||o||d}(o);try{return new tr(a)}catch(f){return null}}}let oi=(()=>{class d{constructor(){this.providerId=d.PROVIDER_ID}static credential(a,f){return Xi._fromEmailAndPassword(a,f)}static credentialWithLink(a,f){const v=tr.parseLink(f);return U(v,"argument-error"),Xi._fromEmailAndCode(a,v.code,v.tenantId)}}return d.PROVIDER_ID="password",d.EMAIL_PASSWORD_SIGN_IN_METHOD="password",d.EMAIL_LINK_SIGN_IN_METHOD="emailLink",d})();class Ht{constructor(o){this.providerId=o,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(o){this.defaultLanguageCode=o}setCustomParameters(o){return this.customParameters=o,this}getCustomParameters(){return this.customParameters}}class bi extends Ht{constructor(){super(...arguments),this.scopes=[]}addScope(o){return this.scopes.includes(o)||this.scopes.push(o),this}getScopes(){return[...this.scopes]}}class Ni extends bi{static credentialFromJSON(o){const a="string"==typeof o?JSON.parse(o):o;return U("providerId"in a&&"signInMethod"in a,"argument-error"),on._fromParams(a)}credential(o){return this._credential(Object.assign(Object.assign({},o),{nonce:o.rawNonce}))}_credential(o){return U(o.idToken||o.accessToken,"argument-error"),on._fromParams(Object.assign(Object.assign({},o),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(o){return Ni.oauthCredentialFromTaggedObject(o)}static credentialFromError(o){return Ni.oauthCredentialFromTaggedObject(o.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{oauthIdToken:a,oauthAccessToken:f,oauthTokenSecret:v,pendingToken:b,nonce:C,providerId:A}=o;if(!f&&!v&&!a&&!b||!A)return null;try{return new Ni(A)._credential({idToken:a,accessToken:f,nonce:C,pendingToken:b})}catch(H){return null}}}let Da=(()=>{class d extends bi{constructor(){super("facebook.com")}static credential(a){return on._fromParams({providerId:d.PROVIDER_ID,signInMethod:d.FACEBOOK_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return d.credentialFromTaggedObject(a)}static credentialFromError(a){return d.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return d.credential(a.oauthAccessToken)}catch(f){return null}}}return d.FACEBOOK_SIGN_IN_METHOD="facebook.com",d.PROVIDER_ID="facebook.com",d})(),Sa=(()=>{class d extends bi{constructor(){super("google.com"),this.addScope("profile")}static credential(a,f){return on._fromParams({providerId:d.PROVIDER_ID,signInMethod:d.GOOGLE_SIGN_IN_METHOD,idToken:a,accessToken:f})}static credentialFromResult(a){return d.credentialFromTaggedObject(a)}static credentialFromError(a){return d.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthIdToken:f,oauthAccessToken:v}=a;if(!f&&!v)return null;try{return d.credential(f,v)}catch(b){return null}}}return d.GOOGLE_SIGN_IN_METHOD="google.com",d.PROVIDER_ID="google.com",d})(),go=(()=>{class d extends bi{constructor(){super("github.com")}static credential(a){return on._fromParams({providerId:d.PROVIDER_ID,signInMethod:d.GITHUB_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return d.credentialFromTaggedObject(a)}static credentialFromError(a){return d.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return d.credential(a.oauthAccessToken)}catch(f){return null}}}return d.GITHUB_SIGN_IN_METHOD="github.com",d.PROVIDER_ID="github.com",d})();class Ti extends En{constructor(o,a){super(o,o),this.pendingToken=a}_getIdTokenResponse(o){return sn(o,this.buildRequest())}_linkToIdToken(o,a){const f=this.buildRequest();return f.idToken=a,sn(o,f)}_getReauthenticationResolver(o){const a=this.buildRequest();return a.autoCreate=!1,sn(o,a)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o,{providerId:f,signInMethod:v,pendingToken:b}=a;return f&&v&&b&&f===v?new Ti(f,b):null}static _create(o,a){return new Ti(o,a)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class rs extends Ht{constructor(o){U(o.startsWith("saml."),"argument-error"),super(o)}static credentialFromResult(o){return rs.samlCredentialFromTaggedObject(o)}static credentialFromError(o){return rs.samlCredentialFromTaggedObject(o.customData||{})}static credentialFromJSON(o){const a=Ti.fromJSON(o);return U(a,"argument-error"),a}static samlCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{pendingToken:a,providerId:f}=o;if(!a||!f)return null;try{return Ti._create(f,a)}catch(v){return null}}}let _o=(()=>{class d extends bi{constructor(){super("twitter.com")}static credential(a,f){return on._fromParams({providerId:d.PROVIDER_ID,signInMethod:d.TWITTER_SIGN_IN_METHOD,oauthToken:a,oauthTokenSecret:f})}static credentialFromResult(a){return d.credentialFromTaggedObject(a)}static credentialFromError(a){return d.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthAccessToken:f,oauthTokenSecret:v}=a;if(!f||!v)return null;try{return d.credential(f,v)}catch(b){return null}}}return d.TWITTER_SIGN_IN_METHOD="twitter.com",d.PROVIDER_ID="twitter.com",d})();function mo(d,o){return ss.apply(this,arguments)}function ss(){return(ss=(0,h.Z)(function*(d,o){return nn(d,"POST","/v1/accounts:signUp",Be(d,o))})).apply(this,arguments)}class kt{constructor(o){this.user=o.user,this.providerId=o.providerId,this._tokenResponse=o._tokenResponse,this.operationType=o.operationType}static _fromIdTokenResponse(o,a,f,v=!1){return(0,h.Z)(function*(){const b=yield it._fromIdTokenResponse(o,f,v),C=ka(f);return new kt({user:b,providerId:C,_tokenResponse:f,operationType:a})})()}static _forOperation(o,a,f){return(0,h.Z)(function*(){yield o._updateTokensIfNecessary(f,!0);const v=ka(f);return new kt({user:o,providerId:v,_tokenResponse:f,operationType:a})})()}}function ka(d){return d.providerId?d.providerId:"phoneNumber"in d?"phone":null}function os(){return(os=(0,h.Z)(function*(d){var o;const a=Ze(d);if(yield a._initializationPromise,null===(o=a.currentUser)||void 0===o?void 0:o.isAnonymous)return new kt({user:a.currentUser,providerId:null,operationType:"signIn"});const f=yield mo(a,{returnSecureToken:!0}),v=yield kt._fromIdTokenResponse(a,"signIn",f,!0);return yield a._updateCurrentUser(v.user),v})).apply(this,arguments)}class nr extends x.ZR{constructor(o,a,f,v){var b;super(a.code,a.message),this.operationType=f,this.user=v,Object.setPrototypeOf(this,nr.prototype),this.customData={appName:o.name,tenantId:null!==(b=o.tenantId)&&void 0!==b?b:void 0,_serverResponse:a.customData._serverResponse,operationType:f}}static _fromErrorAndOperation(o,a,f,v){return new nr(o,a,f,v)}}function ir(d,o,a,f){return("reauthenticate"===o?a._getReauthenticationResolver(d):a._getIdTokenResponse(d)).catch(b=>{throw"auth/multi-factor-auth-required"===b.code?nr._fromErrorAndOperation(d,b,o,f):b})}function vo(d){return new Set(d.map(({providerId:o})=>o).filter(o=>!!o))}function _e(){return(_e=(0,h.Z)(function*(d,o){const a=(0,x.m9)(d);yield an(!0,a,o);const{providerUserInfo:f}=yield Fl(a.auth,{idToken:yield a.getIdToken(),deleteProvider:[o]}),v=vo(f||[]);return a.providerData=a.providerData.filter(b=>v.has(b.providerId)),v.has("phone")||(a.phoneNumber=null),yield a.auth._persistUserIfCurrent(a),a})).apply(this,arguments)}function ge(d,o){return ae.apply(this,arguments)}function ae(){return(ae=(0,h.Z)(function*(d,o,a=!1){const f=yield $t(d,o._linkToIdToken(d.auth,yield d.getIdToken()),a);return kt._forOperation(d,"link",f)})).apply(this,arguments)}function an(d,o,a){return De.apply(this,arguments)}function De(){return(De=(0,h.Z)(function*(d,o,a){yield ri(o);const v=!1===d?"provider-already-linked":"no-such-provider";U(vo(o.providerData).has(a)===d,o.auth,v)})).apply(this,arguments)}function yo(d,o){return Ma.apply(this,arguments)}function Ma(){return(Ma=(0,h.Z)(function*(d,o,a=!1){const{auth:f}=d,v="reauthenticate";try{const b=yield $t(d,ir(f,v,o,d),a);U(b.idToken,f,"internal-error");const C=wn(b.idToken);U(C,f,"internal-error");const{sub:A}=C;return U(d.uid===A,f,"user-mismatch"),kt._forOperation(d,v,b)}catch(b){throw"auth/user-not-found"===(null==b?void 0:b.code)&&Te(f,"user-mismatch"),b}})).apply(this,arguments)}function wi(d,o){return as.apply(this,arguments)}function as(){return(as=(0,h.Z)(function*(d,o,a=!1){const f="signIn",v=yield ir(d,f,o),b=yield kt._fromIdTokenResponse(d,f,v);return a||(yield d._updateCurrentUser(b.user)),b})).apply(this,arguments)}function Me(d,o){return le.apply(this,arguments)}function le(){return(le=(0,h.Z)(function*(d,o){return wi(Ze(d),o)})).apply(this,arguments)}function yt(d,o){return Pa.apply(this,arguments)}function Pa(){return(Pa=(0,h.Z)(function*(d,o){const a=(0,x.m9)(d);return yield an(!1,a,o.providerId),ge(a,o)})).apply(this,arguments)}function bo(d,o){return wt.apply(this,arguments)}function wt(){return(wt=(0,h.Z)(function*(d,o){return yo((0,x.m9)(d),o)})).apply(this,arguments)}function $l(d,o){return xa.apply(this,arguments)}function xa(){return(xa=(0,h.Z)(function*(d,o){return nn(d,"POST","/v1/accounts:signInWithCustomToken",Be(d,o))})).apply(this,arguments)}function No(){return(No=(0,h.Z)(function*(d,o){const a=Ze(d),f=yield $l(a,{token:o,returnSecureToken:!0}),v=yield kt._fromIdTokenResponse(a,"signIn",f);return yield a._updateCurrentUser(v.user),v})).apply(this,arguments)}class Cn{constructor(o,a){this.factorId=o,this.uid=a.mfaEnrollmentId,this.enrollmentTime=new Date(a.enrolledAt).toUTCString(),this.displayName=a.displayName}static _fromServerResponse(o,a){return"phoneInfo"in a?rr._fromServerResponse(o,a):Te(o,"internal-error")}}class rr extends Cn{constructor(o){super("phone",o),this.phoneNumber=o.phoneInfo}static _fromServerResponse(o,a){return new rr(a)}}function jn(d,o,a){var f;U((null===(f=a.url)||void 0===f?void 0:f.length)>0,d,"invalid-continue-uri"),U(void 0===a.dynamicLinkDomain||a.dynamicLinkDomain.length>0,d,"invalid-dynamic-link-domain"),o.continueUrl=a.url,o.dynamicLinkDomain=a.dynamicLinkDomain,o.canHandleCodeInApp=a.handleCodeInApp,a.iOS&&(U(a.iOS.bundleId.length>0,d,"missing-ios-bundle-id"),o.iOSBundleId=a.iOS.bundleId),a.android&&(U(a.android.packageName.length>0,d,"missing-android-pkg-name"),o.androidInstallApp=a.android.installApp,o.androidMinimumVersionCode=a.android.minimumVersion,o.androidPackageName=a.android.packageName)}function To(){return(To=(0,h.Z)(function*(d,o,a){const f=(0,x.m9)(d),v={requestType:"PASSWORD_RESET",email:o};a&&jn(f,v,a),yield vi(f,v)})).apply(this,arguments)}function wo(){return(wo=(0,h.Z)(function*(d,o,a){yield Wn((0,x.m9)(d),{oobCode:o,newPassword:a})})).apply(this,arguments)}function Eo(){return(Eo=(0,h.Z)(function*(d,o){yield io((0,x.m9)(d),{oobCode:o})})).apply(this,arguments)}function La(d,o){return In.apply(this,arguments)}function In(){return(In=(0,h.Z)(function*(d,o){const a=(0,x.m9)(d),f=yield Wn(a,{oobCode:o}),v=f.requestType;switch(U(v,a,"internal-error"),v){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":U(f.newEmail,a,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":U(f.mfaInfo,a,"internal-error");default:U(f.email,a,"internal-error")}let b=null;return f.mfaInfo&&(b=Cn._fromServerResponse(Ze(a),f.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===f.requestType?f.newEmail:f.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===f.requestType?f.email:f.newEmail)||null,multiFactorInfo:b},operation:v}})).apply(this,arguments)}function Ei(){return(Ei=(0,h.Z)(function*(d,o){const{data:a}=yield La((0,x.m9)(d),o);return a.email})).apply(this,arguments)}function cs(){return(cs=(0,h.Z)(function*(d,o,a){const f=Ze(d),v=yield mo(f,{returnSecureToken:!0,email:o,password:a}),b=yield kt._fromIdTokenResponse(f,"signIn",v);return yield f._updateCurrentUser(b.user),b})).apply(this,arguments)}function Ot(){return(Ot=(0,h.Z)(function*(d,o,a){const f=(0,x.m9)(d),v={requestType:"EMAIL_SIGNIN",email:o};U(a.handleCodeInApp,f,"argument-error"),a&&jn(f,v,a),yield Ji(f,v)})).apply(this,arguments)}function Co(){return(Co=(0,h.Z)(function*(d,o,a){const f=(0,x.m9)(d),v=oi.credentialWithLink(o,a||ie());return U(v._tenantId===(f.tenantId||null),f,"tenant-id-mismatch"),Me(f,v)})).apply(this,arguments)}function Io(d,o){return sr.apply(this,arguments)}function sr(){return(sr=(0,h.Z)(function*(d,o){return Ie(d,"POST","/v1/accounts:createAuthUri",Be(d,o))})).apply(this,arguments)}function ds(){return(ds=(0,h.Z)(function*(d,o){const f={identifier:o,continueUri:ke()?ie():"http://localhost"},{signinMethods:v}=yield Io((0,x.m9)(d),f);return v||[]})).apply(this,arguments)}function hs(){return(hs=(0,h.Z)(function*(d,o){const a=(0,x.m9)(d),v={requestType:"VERIFY_EMAIL",idToken:yield d.getIdToken()};o&&jn(a.auth,v,o);const{email:b}=yield so(a.auth,v);b!==d.email&&(yield d.reload())})).apply(this,arguments)}function fs(){return(fs=(0,h.Z)(function*(d,o,a){const f=(0,x.m9)(d),b={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield d.getIdToken(),newEmail:o};a&&jn(f.auth,b,a);const{email:C}=yield lo(f.auth,b);C!==d.email&&(yield d.reload())})).apply(this,arguments)}function Ba(d,o){return Do.apply(this,arguments)}function Do(){return(Do=(0,h.Z)(function*(d,o){return Ie(d,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function or(){return(or=(0,h.Z)(function*(d,{displayName:o,photoURL:a}){if(void 0===o&&void 0===a)return;const f=(0,x.m9)(d),b={idToken:yield f.getIdToken(),displayName:o,photoUrl:a,returnSecureToken:!0},C=yield $t(f,Ba(f.auth,b));f.displayName=C.displayName||null,f.photoURL=C.photoUrl||null;const A=f.providerData.find(({providerId:H})=>"password"===H);A&&(A.displayName=f.displayName,A.photoURL=f.photoURL),yield f._updateTokensIfNecessary(C)})).apply(this,arguments)}function Ga(d,o,a){return Ii.apply(this,arguments)}function Ii(){return(Ii=(0,h.Z)(function*(d,o,a){const{auth:f}=d,b={idToken:yield d.getIdToken(),returnSecureToken:!0};o&&(b.email=o),a&&(b.password=a);const C=yield $t(d,Xr(f,b));yield d._updateTokensIfNecessary(C,!0)})).apply(this,arguments)}class qt{constructor(o,a,f={}){this.isNewUser=o,this.providerId=a,this.profile=f}}class cn extends qt{constructor(o,a,f,v){super(o,a,f),this.username=v}}class ar extends qt{constructor(o,a){super(o,"facebook.com",a)}}class oe extends cn{constructor(o,a){super(o,"github.com",a,"string"==typeof(null==a?void 0:a.login)?null==a?void 0:a.login:null)}}class Jl extends qt{constructor(o,a){super(o,"google.com",a)}}class lr extends cn{constructor(o,a,f){super(o,"twitter.com",a,f)}}function Ql(d){const{user:o,_tokenResponse:a}=d;return o.isAnonymous&&!a?{providerId:null,isNewUser:!1,profile:null}:function So(d){var o,a;if(!d)return null;const{providerId:f}=d,v=d.rawUserInfo?JSON.parse(d.rawUserInfo):{},b=d.isNewUser||"identitytoolkit#SignupNewUserResponse"===d.kind;if(!f&&(null==d?void 0:d.idToken)){const C=null===(a=null===(o=wn(d.idToken))||void 0===o?void 0:o.firebase)||void 0===a?void 0:a.sign_in_provider;if(C)return new qt(b,"anonymous"!==C&&"custom"!==C?C:null)}if(!f)return null;switch(f){case"facebook.com":return new ar(b,v);case"github.com":return new oe(b,v);case"google.com":return new Jl(b,v);case"twitter.com":return new lr(b,v,d.screenName||null);case"custom":case"anonymous":return new qt(b,null);default:return new qt(b,f,v)}}(a)}class Di{constructor(o,a){this.type=o,this.credential=a}static _fromIdtoken(o){return new Di("enroll",o)}static _fromMfaPendingCredential(o){return new Di("signin",o)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(o){var a,f;if(null==o?void 0:o.multiFactorSession){if(null===(a=o.multiFactorSession)||void 0===a?void 0:a.pendingCredential)return Di._fromMfaPendingCredential(o.multiFactorSession.pendingCredential);if(null===(f=o.multiFactorSession)||void 0===f?void 0:f.idToken)return Di._fromIdtoken(o.multiFactorSession.idToken)}return null}}class Ao{constructor(o,a,f){this.session=o,this.hints=a,this.signInResolver=f}static _fromError(o,a){const f=Ze(o),v=a.customData._serverResponse,b=(v.mfaInfo||[]).map(A=>Cn._fromServerResponse(f,A));U(v.mfaPendingCredential,f,"internal-error");const C=Di._fromMfaPendingCredential(v.mfaPendingCredential);return new Ao(C,b,function(){var A=(0,h.Z)(function*(H){const Y=yield H._process(f,C);delete v.mfaInfo,delete v.mfaPendingCredential;const J=Object.assign(Object.assign({},v),{idToken:Y.idToken,refreshToken:Y.refreshToken});switch(a.operationType){case"signIn":const Q=yield kt._fromIdTokenResponse(f,a.operationType,J);return yield f._updateCurrentUser(Q.user),Q;case"reauthenticate":return U(a.user,f,"internal-error"),kt._forOperation(a.user,a.operationType,J);default:Te(f,"internal-error")}});return function(H){return A.apply(this,arguments)}}())}resolveSignIn(o){var a=this;return(0,h.Z)(function*(){return a.signInResolver(o)})()}}function Wa(d,o){return Ie(d,"POST","/v2/accounts/mfaEnrollment:start",Be(d,o))}class ai{constructor(o){this.user=o,this.enrolledFactors=[],o._onReload(a=>{a.mfaInfo&&(this.enrolledFactors=a.mfaInfo.map(f=>Cn._fromServerResponse(o.auth,f)))})}static _fromUser(o){return new ai(o)}getSession(){var o=this;return(0,h.Z)(function*(){return Di._fromIdtoken(yield o.user.getIdToken())})()}enroll(o,a){var f=this;return(0,h.Z)(function*(){const v=o,b=yield f.getSession(),C=yield $t(f.user,v._process(f.user.auth,b,a));return yield f.user._updateTokensIfNecessary(C),f.user.reload()})()}unenroll(o){var a=this;return(0,h.Z)(function*(){const f="string"==typeof o?o:o.uid,v=yield a.user.getIdToken(),b=yield $t(a.user,function gs(d,o){return Ie(d,"POST","/v2/accounts/mfaEnrollment:withdraw",Be(d,o))}(a.user.auth,{idToken:v,mfaEnrollmentId:f}));a.enrolledFactors=a.enrolledFactors.filter(({uid:C})=>C!==f),yield a.user._updateTokensIfNecessary(b);try{yield a.user.reload()}catch(C){if("auth/user-token-expired"!==C.code)throw C}})()}}const ko=new WeakMap,li="__sak";class $a{constructor(o,a){this.storageRetriever=o,this.type=a}_isAvailable(){try{return this.storage?(this.storage.setItem(li,"1"),this.storage.removeItem(li),Promise.resolve(!0)):Promise.resolve(!1)}catch(o){return Promise.resolve(!1)}}_set(o,a){return this.storage.setItem(o,JSON.stringify(a)),Promise.resolve()}_get(o){const a=this.storage.getItem(o);return Promise.resolve(a?JSON.parse(a):null)}_remove(o){return this.storage.removeItem(o),Promise.resolve()}get storage(){return this.storageRetriever()}}const ur=(()=>{class d extends $a{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(a,f)=>this.onStorageEvent(a,f),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function Oo(){const d=(0,x.z$)();return ct(d)||Ve(d)}()&&function $i(){try{return!(!window||window===window.top)}catch(d){return!1}}(),this.fallbackToPolling=eo(),this._shouldAllowMigration=!0}forAllChangedKeys(a){for(const f of Object.keys(this.listeners)){const v=this.storage.getItem(f),b=this.localCache[f];v!==b&&a(f,b,v)}}onStorageEvent(a,f=!1){if(!a.key)return void this.forAllChangedKeys((A,H,Y)=>{this.notifyListeners(A,Y)});const v=a.key;if(f?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const A=this.storage.getItem(v);if(a.newValue!==A)null!==a.newValue?this.storage.setItem(v,a.newValue):this.storage.removeItem(v);else if(this.localCache[v]===a.newValue&&!f)return}const b=()=>{const A=this.storage.getItem(v);!f&&this.localCache[v]===A||this.notifyListeners(v,A)},C=this.storage.getItem(v);!function Xs(){return(0,x.w1)()&&10===document.documentMode}()||C===a.newValue||a.newValue===a.oldValue?b():setTimeout(b,10)}notifyListeners(a,f){this.localCache[a]=f;const v=this.listeners[a];if(v)for(const b of Array.from(v))b(f&&JSON.parse(f))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((a,f,v)=>{this.onStorageEvent(new StorageEvent("storage",{key:a,oldValue:f,newValue:v}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(a,f){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[a]||(this.listeners[a]=new Set,this.localCache[a]=this.storage.getItem(a)),this.listeners[a].add(f)}_removeListener(a,f){this.listeners[a]&&(this.listeners[a].delete(f),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(a,f){var v=()=>super._set,b=this;return(0,h.Z)(function*(){yield v().call(b,a,f),b.localCache[a]=JSON.stringify(f)})()}_get(a){var f=()=>super._get,v=this;return(0,h.Z)(function*(){const b=yield f().call(v,a);return v.localCache[a]=JSON.stringify(b),b})()}_remove(a){var f=()=>super._remove,v=this;return(0,h.Z)(function*(){yield f().call(v,a),delete v.localCache[a]})()}}return d.type="LOCAL",d})(),un=(()=>{class d extends $a{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(a,f){}_removeListener(a,f){}}return d.type="SESSION",d})();let ci=(()=>{class d{constructor(a){this.eventTarget=a,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(a){const f=this.receivers.find(b=>b.isListeningto(a));if(f)return f;const v=new d(a);return this.receivers.push(v),v}isListeningto(a){return this.eventTarget===a}handleEvent(a){var f=this;return(0,h.Z)(function*(){const v=a,{eventId:b,eventType:C,data:A}=v.data,H=f.handlersMap[C];if(!(null==H?void 0:H.size))return;v.ports[0].postMessage({status:"ack",eventId:b,eventType:C});const Y=Array.from(H).map(function(){var Q=(0,h.Z)(function*(we){return we(v.origin,A)});return function(we){return Q.apply(this,arguments)}}()),J=yield function Hc(d){return Promise.all(d.map(function(){var o=(0,h.Z)(function*(a){try{return{fulfilled:!0,value:yield a}}catch(f){return{fulfilled:!1,reason:f}}});return function(a){return o.apply(this,arguments)}}()))}(Y);v.ports[0].postMessage({status:"done",eventId:b,eventType:C,response:J})})()}_subscribe(a,f){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[a]||(this.handlersMap[a]=new Set),this.handlersMap[a].add(f)}_unsubscribe(a,f){this.handlersMap[a]&&f&&this.handlersMap[a].delete(f),(!f||0===this.handlersMap[a].size)&&delete this.handlersMap[a],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return d.receivers=[],d})();function dr(d="",o=10){let a="";for(let f=0;f<o;f++)a+=Math.floor(10*Math.random());return d+a}class Ya{constructor(o){this.target=o,this.handlers=new Set}removeMessageHandler(o){o.messageChannel&&(o.messageChannel.port1.removeEventListener("message",o.onMessage),o.messageChannel.port1.close()),this.handlers.delete(o)}_send(o,a,f=50){var v=this;return(0,h.Z)(function*(){const b="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!b)throw new Error("connection_unavailable");let C,A;return new Promise((H,Y)=>{const J=dr("",20);b.port1.start();const Q=setTimeout(()=>{Y(new Error("unsupported_event"))},f);A={messageChannel:b,onMessage(we){const _t=we;if(_t.data.eventId===J)switch(_t.data.status){case"ack":clearTimeout(Q),C=setTimeout(()=>{Y(new Error("timeout"))},3e3);break;case"done":clearTimeout(C),H(_t.data.response);break;default:clearTimeout(Q),clearTimeout(C),Y(new Error("invalid_response"))}}},v.handlers.add(A),b.port1.addEventListener("message",A.onMessage),v.target.postMessage({eventType:o,eventId:J,data:a},[b.port2])}).finally(()=>{A&&v.removeMessageHandler(A)})})()}}function We(){return window}function $n(){return void 0!==We().WorkerGlobalScope&&"function"==typeof We().importScripts}function hr(){return(hr=(0,h.Z)(function*(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch(d){return null}})).apply(this,arguments)}const ic="firebaseLocalStorageDb",Sn="firebaseLocalStorage",Ka="fbase_key";class _s{constructor(o){this.request=o}toPromise(){return new Promise((o,a)=>{this.request.addEventListener("success",()=>{o(this.request.result)}),this.request.addEventListener("error",()=>{a(this.request.error)})})}}function bt(d,o){return d.transaction([Sn],o?"readwrite":"readonly").objectStore(Sn)}function fr(){const d=indexedDB.open(ic,1);return new Promise((o,a)=>{d.addEventListener("error",()=>{a(d.error)}),d.addEventListener("upgradeneeded",()=>{const f=d.result;try{f.createObjectStore(Sn,{keyPath:Ka})}catch(v){a(v)}}),d.addEventListener("success",(0,h.Z)(function*(){const f=d.result;f.objectStoreNames.contains(Sn)?o(f):(f.close(),yield function ms(){const d=indexedDB.deleteDatabase(ic);return new _s(d).toPromise()}(),o(yield fr()))}))})}function vs(d,o,a){return dn.apply(this,arguments)}function dn(){return(dn=(0,h.Z)(function*(d,o,a){const f=bt(d,!0).put({[Ka]:o,value:a});return new _s(f).toPromise()})).apply(this,arguments)}function Rn(){return(Rn=(0,h.Z)(function*(d,o){const a=bt(d,!1).get(o),f=yield new _s(a).toPromise();return void 0===f?null:f.value})).apply(this,arguments)}function ui(d,o){const a=bt(d,!0).delete(o);return new _s(a).toPromise()}const hn=(()=>{class d{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var a=this;return(0,h.Z)(function*(){return a.db||(a.db=yield fr()),a.db})()}_withRetries(a){var f=this;return(0,h.Z)(function*(){let v=0;for(;;)try{const b=yield f._openDb();return yield a(b)}catch(b){if(v++>3)throw b;f.db&&(f.db.close(),f.db=void 0)}})()}initializeServiceWorkerMessaging(){var a=this;return(0,h.Z)(function*(){return $n()?a.initializeReceiver():a.initializeSender()})()}initializeReceiver(){var a=this;return(0,h.Z)(function*(){a.receiver=ci._getInstance(function Vc(){return $n()?self:null}()),a.receiver._subscribe("keyChanged",function(){var f=(0,h.Z)(function*(v,b){return{keyProcessed:(yield a._poll()).includes(b.key)}});return function(v,b){return f.apply(this,arguments)}}()),a.receiver._subscribe("ping",function(){var f=(0,h.Z)(function*(v,b){return["keyChanged"]});return function(v,b){return f.apply(this,arguments)}}())})()}initializeSender(){var a=this;return(0,h.Z)(function*(){var f,v;if(a.activeServiceWorker=yield function Vt(){return hr.apply(this,arguments)}(),!a.activeServiceWorker)return;a.sender=new Ya(a.activeServiceWorker);const b=yield a.sender._send("ping",{},800);!b||(null===(f=b[0])||void 0===f?void 0:f.fulfilled)&&(null===(v=b[0])||void 0===v?void 0:v.value.includes("keyChanged"))&&(a.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(a){var f=this;return(0,h.Z)(function*(){if(f.sender&&f.activeServiceWorker&&function za(){var d;return(null===(d=null==navigator?void 0:navigator.serviceWorker)||void 0===d?void 0:d.controller)||null}()===f.activeServiceWorker)try{yield f.sender._send("keyChanged",{key:a},f.serviceWorkerReceiverAvailable?800:50)}catch(v){}})()}_isAvailable(){return(0,h.Z)(function*(){try{if(!indexedDB)return!1;const a=yield fr();return yield vs(a,li,"1"),yield ui(a,li),!0}catch(a){}return!1})()}_withPendingWrite(a){var f=this;return(0,h.Z)(function*(){f.pendingWrites++;try{yield a()}finally{f.pendingWrites--}})()}_set(a,f){var v=this;return(0,h.Z)(function*(){return v._withPendingWrite((0,h.Z)(function*(){return yield v._withRetries(b=>vs(b,a,f)),v.localCache[a]=f,v.notifyServiceWorker(a)}))})()}_get(a){var f=this;return(0,h.Z)(function*(){const v=yield f._withRetries(b=>function rt(d,o){return Rn.apply(this,arguments)}(b,a));return f.localCache[a]=v,v})()}_remove(a){var f=this;return(0,h.Z)(function*(){return f._withPendingWrite((0,h.Z)(function*(){return yield f._withRetries(v=>ui(v,a)),delete f.localCache[a],f.notifyServiceWorker(a)}))})()}_poll(){var a=this;return(0,h.Z)(function*(){const f=yield a._withRetries(C=>{const A=bt(C,!1).getAll();return new _s(A).toPromise()});if(!f)return[];if(0!==a.pendingWrites)return[];const v=[],b=new Set;for(const{fbase_key:C,value:A}of f)b.add(C),JSON.stringify(a.localCache[C])!==JSON.stringify(A)&&(a.notifyListeners(C,A),v.push(C));for(const C of Object.keys(a.localCache))a.localCache[C]&&!b.has(C)&&(a.notifyListeners(C,null),v.push(C));return v})()}notifyListeners(a,f){this.localCache[a]=f;const v=this.listeners[a];if(v)for(const b of Array.from(v))b(f)}startPolling(){var a=this;this.stopPolling(),this.pollTimer=setInterval((0,h.Z)(function*(){return a._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(a,f){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[a]||(this.listeners[a]=new Set,this._get(a)),this.listeners[a].add(f)}_removeListener(a,f){this.listeners[a]&&(this.listeners[a].delete(f),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return d.type="LOCAL",d})();function Mo(d,o){return Ie(d,"POST","/v2/accounts/mfaSignIn:start",Be(d,o))}function kn(){return(kn=(0,h.Z)(function*(d){return(yield Ie(d,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function Si(d){return new Promise((o,a)=>{const f=document.createElement("script");f.setAttribute("src",d),f.onload=o,f.onerror=v=>{const b=ve("internal-error");b.customData=v,a(b)},f.type="text/javascript",f.charset="UTF-8",function Po(){var d,o;return null!==(o=null===(d=document.getElementsByTagName("head"))||void 0===d?void 0:d[0])&&void 0!==o?o:document}().appendChild(f)})}function di(d){return`__${d}${Math.floor(1e6*Math.random())}`}const Se=1e12;class fn{constructor(o){this.auth=o,this.counter=Se,this._widgets=new Map}render(o,a){const f=this.counter;return this._widgets.set(f,new Ri(o,this.auth.name,a||{})),this.counter++,f}reset(o){var a;const f=o||Se;null===(a=this._widgets.get(f))||void 0===a||a.delete(),this._widgets.delete(f)}getResponse(o){var a;return(null===(a=this._widgets.get(o||Se))||void 0===a?void 0:a.getResponse())||""}execute(o){var a=this;return(0,h.Z)(function*(){var f;return null===(f=a._widgets.get(o||Se))||void 0===f||f.execute(),""})()}}class Ri{constructor(o,a,f){this.params=f,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const v="string"==typeof o?document.getElementById(o):o;U(v,"argument-error",{appName:a}),this.container=v,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function gr(d){const o=[],a="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let f=0;f<d;f++)o.push(a.charAt(Math.floor(Math.random()*a.length)));return o.join("")}(50);const{callback:o,"expired-callback":a}=this.params;if(o)try{o(this.responseToken)}catch(f){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,a)try{a()}catch(f){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Ns=di("rcb"),xo=new Oe(3e4,6e4);class rc{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!We().grecaptcha}load(o,a=""){return U(function hi(d){return d.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(d)}(a),o,"argument-error"),this.shouldResolveImmediately(a)?Promise.resolve(We().grecaptcha):new Promise((f,v)=>{const b=We().setTimeout(()=>{v(ve(o,"network-request-failed"))},xo.get());We()[Ns]=()=>{We().clearTimeout(b),delete We()[Ns];const A=We().grecaptcha;if(!A)return void v(ve(o,"internal-error"));const H=A.render;A.render=(Y,J)=>{const Q=H(Y,J);return this.counter++,Q},this.hostLanguage=a,f(A)},Si(`https://www.google.com/recaptcha/api.js??${(0,x.xO)({onload:Ns,render:"explicit",hl:a})}`).catch(()=>{clearTimeout(b),v(ve(o,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(o){return!!We().grecaptcha&&(o===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Ts{load(o){return(0,h.Z)(function*(){return new fn(o)})()}clearedOneInstance(){}}const Ct="recaptcha",Fo={theme:"light",type:"image"};class zn{constructor(o,a=Object.assign({},Fo),f){this.parameters=a,this.type=Ct,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Ze(f),this.isInvisible="invisible"===this.parameters.size,U("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const v="string"==typeof o?document.getElementById(o):o;U(v,this.auth,"argument-error"),this.container=v,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Ts:new rc,this.validateStartingState()}verify(){var o=this;return(0,h.Z)(function*(){o.assertNotDestroyed();const a=yield o.render(),f=o.getAssertedRecaptcha();return f.getResponse(a)||new Promise(b=>{const C=A=>{!A||(o.tokenChangeListeners.delete(C),b(A))};o.tokenChangeListeners.add(C),o.isInvisible&&f.execute(a)})})()}render(){try{this.assertNotDestroyed()}catch(o){return Promise.reject(o)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(o=>{throw this.renderPromise=null,o})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(o=>{this.container.removeChild(o)})}validateStartingState(){U(!this.parameters.sitekey,this.auth,"argument-error"),U(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),U("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(o){return a=>{if(this.tokenChangeListeners.forEach(f=>f(a)),"function"==typeof o)o(a);else if("string"==typeof o){const f=We()[o];"function"==typeof f&&f(a)}}}assertNotDestroyed(){U(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var o=this;return(0,h.Z)(function*(){if(yield o.init(),!o.widgetId){let a=o.container;if(!o.isInvisible){const f=document.createElement("div");a.appendChild(f),a=f}o.widgetId=o.getAssertedRecaptcha().render(a,o.parameters)}return o.widgetId})()}init(){var o=this;return(0,h.Z)(function*(){U(ke()&&!$n(),o.auth,"internal-error"),yield function ws(){let d=null;return new Promise(o=>{"complete"!==document.readyState?(d=()=>o(),window.addEventListener("load",d)):o()}).catch(o=>{throw d&&window.removeEventListener("load",d),o})}(),o.recaptcha=yield o._recaptchaLoader.load(o.auth,o.auth.languageCode||void 0);const a=yield function pr(d){return kn.apply(this,arguments)}(o.auth);U(a,o.auth,"internal-error"),o.parameters.sitekey=a})()}getAssertedRecaptcha(){return U(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Lo{constructor(o,a){this.verificationId=o,this.onConfirmation=a}confirm(o){const a=Gt._fromVerification(this.verificationId,o);return this.onConfirmation(a)}}function Uo(){return(Uo=(0,h.Z)(function*(d,o,a){const f=Ze(d),v=yield Cs(f,o,(0,x.m9)(a));return new Lo(v,b=>Me(f,b))})).apply(this,arguments)}function Es(){return(Es=(0,h.Z)(function*(d,o,a){const f=(0,x.m9)(d);yield an(!1,f,"phone");const v=yield Cs(f.auth,o,(0,x.m9)(a));return new Lo(v,b=>yt(f,b))})).apply(this,arguments)}function pn(){return(pn=(0,h.Z)(function*(d,o,a){const f=(0,x.m9)(d),v=yield Cs(f.auth,o,(0,x.m9)(a));return new Lo(v,b=>bo(f,b))})).apply(this,arguments)}function Cs(d,o,a){return Is.apply(this,arguments)}function Is(){return(Is=(0,h.Z)(function*(d,o,a){var f;const v=yield a.verify();try{let b;if(U("string"==typeof v,d,"argument-error"),U(a.type===Ct,d,"argument-error"),b="string"==typeof o?{phoneNumber:o}:o,"session"in b){const C=b.session;if("phoneNumber"in b)return U("enroll"===C.type,d,"internal-error"),(yield Wa(d,{idToken:C.credential,phoneEnrollmentInfo:{phoneNumber:b.phoneNumber,recaptchaToken:v}})).phoneSessionInfo.sessionInfo;{U("signin"===C.type,d,"internal-error");const A=(null===(f=b.multiFactorHint)||void 0===f?void 0:f.uid)||b.multiFactorUid;return U(A,d,"missing-multi-factor-info"),(yield Mo(d,{mfaPendingCredential:C.credential,mfaEnrollmentId:A,phoneSignInInfo:{recaptchaToken:v}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:C}=yield Hl(d,{phoneNumber:b.phoneNumber,recaptchaToken:v});return C}}finally{a._reset()}})).apply(this,arguments)}function Ja(){return(Ja=(0,h.Z)(function*(d,o){yield ge((0,x.m9)(d),o)})).apply(this,arguments)}let Ai=(()=>{class d{constructor(a){this.providerId=d.PROVIDER_ID,this.auth=Ze(a)}verifyPhoneNumber(a,f){return Cs(this.auth,a,(0,x.m9)(f))}static credential(a,f){return Gt._fromVerification(a,f)}static credentialFromResult(a){return d.credentialFromTaggedObject(a)}static credentialFromError(a){return d.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{phoneNumber:f,temporaryProof:v}=a;return f&&v?Gt._fromTokenResponse(f,v):null}}return d.PROVIDER_ID="phone",d.PHONE_SIGN_IN_METHOD="phone",d})();function gt(d,o){return o?B(o):(U(d._popupRedirectResolver,d,"argument-error"),d._popupRedirectResolver)}class Qa extends En{constructor(o){super("custom","custom"),this.params=o}_getIdTokenResponse(o){return sn(o,this._buildIdpRequest())}_linkToIdToken(o,a){return sn(o,this._buildIdpRequest(a))}_getReauthenticationResolver(o){return sn(o,this._buildIdpRequest())}_buildIdpRequest(o){const a={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return o&&(a.idToken=o),a}}function Bo(d){return wi(d.auth,new Qa(d),d.bypassAuthState)}function Go(d){const{auth:o,user:a}=d;return U(a,o,"internal-error"),yo(a,new Qa(d),d.bypassAuthState)}function lc(d){return _r.apply(this,arguments)}function _r(){return(_r=(0,h.Z)(function*(d){const{auth:o,user:a}=d;return U(a,o,"internal-error"),ge(a,new Qa(d),d.bypassAuthState)})).apply(this,arguments)}class cc{constructor(o,a,f,v,b=!1){this.auth=o,this.resolver=f,this.user=v,this.bypassAuthState=b,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(a)?a:[a]}execute(){var o=this;return new Promise(function(){var a=(0,h.Z)(function*(f,v){o.pendingPromise={resolve:f,reject:v};try{o.eventManager=yield o.resolver._initialize(o.auth),yield o.onExecution(),o.eventManager.registerConsumer(o)}catch(b){o.reject(b)}});return function(f,v){return a.apply(this,arguments)}}())}onAuthEvent(o){var a=this;return(0,h.Z)(function*(){const{urlResponse:f,sessionId:v,postBody:b,tenantId:C,error:A,type:H}=o;if(A)return void a.reject(A);const Y={auth:a.auth,requestUri:f,sessionId:v,tenantId:C||void 0,postBody:b||void 0,user:a.user,bypassAuthState:a.bypassAuthState};try{a.resolve(yield a.getIdpTask(H)(Y))}catch(J){a.reject(J)}})()}onError(o){this.reject(o)}getIdpTask(o){switch(o){case"signInViaPopup":case"signInViaRedirect":return Bo;case"linkViaPopup":case"linkViaRedirect":return lc;case"reauthViaPopup":case"reauthViaRedirect":return Go;default:Te(this.auth,"internal-error")}}resolve(o){L(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(o),this.unregisterAndCleanUp()}reject(o){L(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(o),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Xa=new Oe(2e3,1e4);function Ho(){return(Ho=(0,h.Z)(function*(d,o,a){const f=Ze(d);lt(d,o,Ht);const v=gt(f,a);return new nl(f,"signInViaPopup",o,v).executeNotNull()})).apply(this,arguments)}function el(){return(el=(0,h.Z)(function*(d,o,a){const f=(0,x.m9)(d);lt(f.auth,o,Ht);const v=gt(f.auth,a);return new nl(f.auth,"reauthViaPopup",o,v,f).executeNotNull()})).apply(this,arguments)}function mr(){return(mr=(0,h.Z)(function*(d,o,a){const f=(0,x.m9)(d);lt(f.auth,o,Ht);const v=gt(f.auth,a);return new nl(f.auth,"linkViaPopup",o,v,f).executeNotNull()})).apply(this,arguments)}let nl=(()=>{class d extends cc{constructor(a,f,v,b,C){super(a,f,b,C),this.provider=v,this.authWindow=null,this.pollId=null,d.currentPopupAction&&d.currentPopupAction.cancel(),d.currentPopupAction=this}executeNotNull(){var a=this;return(0,h.Z)(function*(){const f=yield a.execute();return U(f,a.auth,"internal-error"),f})()}onExecution(){var a=this;return(0,h.Z)(function*(){L(1===a.filter.length,"Popup operations only handle one event");const f=dr();a.authWindow=yield a.resolver._openPopup(a.auth,a.provider,a.filter[0],f),a.authWindow.associatedEvent=f,a.resolver._originValidation(a.auth).catch(v=>{a.reject(v)}),a.resolver._isIframeWebStorageSupported(a.auth,v=>{v||a.reject(ve(a.auth,"web-storage-unsupported"))}),a.pollUserCancellation()})()}get eventId(){var a;return(null===(a=this.authWindow)||void 0===a?void 0:a.associatedEvent)||null}cancel(){this.reject(ve(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,d.currentPopupAction=null}pollUserCancellation(){const a=()=>{var f,v;this.pollId=(null===(v=null===(f=this.authWindow)||void 0===f?void 0:f.window)||void 0===v?void 0:v.closed)?window.setTimeout(()=>{this.pollId=null,this.reject(ve(this.auth,"popup-closed-by-user"))},2e3):window.setTimeout(a,Xa.get())};a()}}return d.currentPopupAction=null,d})();const Vo=new Map;class Zc extends cc{constructor(o,a,f=!1){super(o,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],a,void 0,f),this.eventId=null}execute(){var o=()=>super.execute,a=this;return(0,h.Z)(function*(){let f=Vo.get(a.auth._key());if(!f){try{const b=(yield function il(d,o){return vr.apply(this,arguments)}(a.resolver,a.auth))?yield o().call(a):null;f=()=>Promise.resolve(b)}catch(v){f=()=>Promise.reject(v)}Vo.set(a.auth._key(),f)}return a.bypassAuthState||Vo.set(a.auth._key(),()=>Promise.resolve(null)),f()})()}onAuthEvent(o){var a=()=>super.onAuthEvent,f=this;return(0,h.Z)(function*(){if("signInViaRedirect"===o.type)return a().call(f,o);if("unknown"!==o.type){if(o.eventId){const v=yield f.auth._redirectUserForId(o.eventId);if(v)return f.user=v,a().call(f,o);f.resolve(null)}}else f.resolve(null)})()}onExecution(){return(0,h.Z)(function*(){})()}cleanUp(){}}function vr(){return(vr=(0,h.Z)(function*(d,o){const a=Wo(o),f=rl(d);if(!(yield f._isAvailable()))return!1;const v="true"===(yield f._get(a));return yield f._remove(a),v})).apply(this,arguments)}function Ds(d,o){return Ss.apply(this,arguments)}function Ss(){return(Ss=(0,h.Z)(function*(d,o){return rl(d)._set(Wo(o),"true")})).apply(this,arguments)}function rl(d){return B(d._redirectPersistence)}function Wo(d){return Gn("pendingRedirect",d.config.apiKey,d.name)}function jo(){return(jo=(0,h.Z)(function*(d,o,a){const f=Ze(d);lt(d,o,Ht);const v=gt(f,a);return yield Ds(v,f),v._openRedirect(f,o,"signInViaRedirect")})).apply(this,arguments)}function sl(){return(sl=(0,h.Z)(function*(d,o,a){const f=(0,x.m9)(d);lt(f.auth,o,Ht);const v=gt(f.auth,a);yield Ds(v,f.auth);const b=yield br(f);return v._openRedirect(f.auth,o,"reauthViaRedirect",b)})).apply(this,arguments)}function ol(){return(ol=(0,h.Z)(function*(d,o,a){const f=(0,x.m9)(d);lt(f.auth,o,Ht);const v=gt(f.auth,a);yield an(!1,f,o.providerId),yield Ds(v,f.auth);const b=yield br(f);return v._openRedirect(f.auth,o,"linkViaRedirect",b)})).apply(this,arguments)}function $o(){return($o=(0,h.Z)(function*(d,o){return yield Ze(d)._initializationPromise,fi(d,o,!1)})).apply(this,arguments)}function fi(d,o){return yr.apply(this,arguments)}function yr(){return(yr=(0,h.Z)(function*(d,o,a=!1){const f=Ze(d),v=gt(f,o),C=yield new Zc(f,v,a).execute();return C&&!a&&(delete C.user._redirectEventId,yield f._persistUserIfCurrent(C.user),yield f._setRedirectUser(null,o)),C})).apply(this,arguments)}function br(d){return Rs.apply(this,arguments)}function Rs(){return(Rs=(0,h.Z)(function*(d){const o=dr(`${d.uid}:::`);return d._redirectEventId=o,yield d.auth._setRedirectUser(d),yield d.auth._persistUserIfCurrent(d),o})).apply(this,arguments)}class Yo{constructor(o){this.auth=o,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(o){this.consumers.add(o),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,o)&&(this.sendToConsumer(this.queuedRedirectEvent,o),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(o){this.consumers.delete(o)}onEvent(o){if(this.hasEventBeenHandled(o))return!1;let a=!1;return this.consumers.forEach(f=>{this.isEventForConsumer(o,f)&&(a=!0,this.sendToConsumer(o,f),this.saveEventToCache(o))}),this.hasHandledPotentialRedirect||!function al(d){switch(d.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return As(d);default:return!1}}(o)||(this.hasHandledPotentialRedirect=!0,a||(this.queuedRedirectEvent=o,a=!0)),a}sendToConsumer(o,a){var f;if(o.error&&!As(o)){const v=(null===(f=o.error.code)||void 0===f?void 0:f.split("auth/")[1])||"internal-error";a.onError(ve(this.auth,v))}else a.onAuthEvent(o)}isEventForConsumer(o,a){const f=null===a.eventId||!!o.eventId&&o.eventId===a.eventId;return a.filter.includes(o.type)&&f}hasEventBeenHandled(o){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(zo(o))}saveEventToCache(o){this.cachedEventUids.add(zo(o)),this.lastProcessedEventTime=Date.now()}}function zo(d){return[d.type,d.eventId,d.sessionId,d.tenantId].filter(o=>o).join("-")}function As({type:d,error:o}){return"unknown"===d&&"auth/no-auth-event"===(null==o?void 0:o.code)}function ll(d){return Zo.apply(this,arguments)}function Zo(){return(Zo=(0,h.Z)(function*(d,o={}){return Ie(d,"GET","/v1/projects",o)})).apply(this,arguments)}const cl=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Zn=/^https?/;function ks(){return(ks=(0,h.Z)(function*(d){if(d.config.emulator)return;const{authorizedDomains:o}=yield ll(d);for(const a of o)try{if(Kn(a))return}catch(f){}Te(d,"unauthorized-domain")})).apply(this,arguments)}function Kn(d){const o=ie(),{protocol:a,hostname:f}=new URL(o);if(d.startsWith("chrome-extension://")){const C=new URL(d);return""===C.hostname&&""===f?"chrome-extension:"===a&&d.replace("chrome-extension://","")===o.replace("chrome-extension://",""):"chrome-extension:"===a&&C.hostname===f}if(!Zn.test(a))return!1;if(cl.test(d))return f===d;const v=d.replace(/\./g,"\\.");return new RegExp("^(.+\\."+v+"|"+v+")$","i").test(f)}const Os=new Oe(3e4,6e4);function Nr(){const d=We().___jsl;if(null==d?void 0:d.H)for(const o of Object.keys(d.H))if(d.H[o].r=d.H[o].r||[],d.H[o].L=d.H[o].L||[],d.H[o].r=[...d.H[o].L],d.CP)for(let a=0;a<d.CP.length;a++)d.CP[a]=null}let Ms=null;function dl(d){return Ms=Ms||function pc(d){return new Promise((o,a)=>{var f,v,b;function C(){Nr(),gapi.load("gapi.iframes",{callback:()=>{o(gapi.iframes.getContext())},ontimeout:()=>{Nr(),a(ve(d,"network-request-failed"))},timeout:Os.get()})}if(null===(v=null===(f=We().gapi)||void 0===f?void 0:f.iframes)||void 0===v?void 0:v.Iframe)o(gapi.iframes.getContext());else{if(!(null===(b=We().gapi)||void 0===b?void 0:b.load)){const A=di("iframefcb");return We()[A]=()=>{gapi.load?C():a(ve(d,"network-request-failed"))},Si(`https://apis.google.com/js/api.js?onload=${A}`).catch(H=>a(H))}C()}}).catch(o=>{throw Ms=null,o})}(d),Ms}const Ko=new Oe(5e3,15e3),pi={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Ps=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function gc(d){const o=d.config;U(o.authDomain,d,"auth-domain-config-required");const a=o.emulator?Qe(o,"emulator/auth/iframe"):`https://${d.config.authDomain}/__/auth/iframe`,f={apiKey:o.apiKey,appName:d.name,v:$e.SDK_VERSION},v=Ps.get(d.config.apiHost);v&&(f.eid=v);const b=d._getFrameworks();return b.length&&(f.fw=b.join(",")),`${a}?${(0,x.xO)(f).slice(1)}`}function hl(){return hl=(0,h.Z)(function*(d){const o=yield dl(d),a=We().gapi;return U(a,d,"internal-error"),o.open({where:document.body,url:gc(d),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:pi,dontclear:!0},f=>new Promise(function(){var v=(0,h.Z)(function*(b,C){yield f.restyle({setHideOnLeave:!1});const A=ve(d,"network-request-failed"),H=We().setTimeout(()=>{C(A)},Ko.get());function Y(){We().clearTimeout(H),b(f)}f.ping(Y).then(Y,()=>{C(A)})});return function(b,C){return v.apply(this,arguments)}}()))}),hl.apply(this,arguments)}const fl={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class mc{constructor(o){this.window=o,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(o){}}}function wr(d,o,a,f,v,b){U(d.config.authDomain,d,"auth-domain-config-required"),U(d.config.apiKey,d,"invalid-api-key");const C={apiKey:d.config.apiKey,appName:d.name,authType:a,redirectUrl:f,v:$e.SDK_VERSION,eventId:v};if(o instanceof Ht){o.setDefaultLanguage(d.languageCode),C.providerId=o.providerId||"",(0,x.xb)(o.getCustomParameters())||(C.customParameters=JSON.stringify(o.getCustomParameters()));for(const[H,Y]of Object.entries(b||{}))C[H]=Y}if(o instanceof bi){const H=o.getScopes().filter(Y=>""!==Y);H.length>0&&(C.scopes=H.join(","))}d.tenantId&&(C.tid=d.tenantId);const A=C;for(const H of Object.keys(A))void 0===A[H]&&delete A[H];return`${function Qo({config:d}){return d.emulator?Qe(d,"emulator/auth/handler"):`https://${d.authDomain}/__/auth/handler`}(d)}?${(0,x.xO)(A).slice(1)}`}const Er="webStorageSupport";class ki extends class ru{constructor(o){this.factorId=o}_process(o,a,f){switch(a.type){case"enroll":return this._finalizeEnroll(o,a.credential,f);case"signin":return this._finalizeSignIn(o,a.credential);default:return M("unexpected MultiFactorSessionType")}}}{constructor(o){super("phone"),this.credential=o}static _fromCredential(o){return new ki(o)}_finalizeEnroll(o,a,f){return function cr(d,o){return Ie(d,"POST","/v2/accounts/mfaEnrollment:finalize",Be(d,o))}(o,{idToken:a,displayName:f,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(o,a){return function qa(d,o){return Ie(d,"POST","/v2/accounts/mfaSignIn:finalize",Be(d,o))}(o,{mfaPendingCredential:a,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let su=(()=>{class d{constructor(){}static assertion(a){return ki._fromCredential(a)}}return d.FACTOR_ID="phone",d})();var Nc="@firebase/auth",ea="0.19.11";class gl{constructor(o){this.auth=o,this.internalListeners=new Map}getUid(){var o;return this.assertAuthConfigured(),(null===(o=this.auth.currentUser)||void 0===o?void 0:o.uid)||null}getToken(o){var a=this;return(0,h.Z)(function*(){return a.assertAuthConfigured(),yield a.auth._initializationPromise,a.auth.currentUser?{accessToken:yield a.auth.currentUser.getIdToken(o)}:null})()}addAuthTokenListener(o){if(this.assertAuthConfigured(),this.internalListeners.has(o))return;const a=this.auth.onIdTokenChanged(f=>{var v;o((null===(v=f)||void 0===v?void 0:v.stsTokenManager.accessToken)||null)});this.internalListeners.set(o,a),this.updateProactiveRefresh()}removeAuthTokenListener(o){this.assertAuthConfigured();const a=this.internalListeners.get(o);!a||(this.internalListeners.delete(o),a(),this.updateProactiveRefresh())}assertAuthConfigured(){U(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function qn(){return window}function Cr(){return(Cr=(0,h.Z)(function*(d,o,a){var f;const{BuildInfo:v}=qn();L(o.sessionId,"AuthEvent did not contain a session ID");const b=yield Tc(o.sessionId),C={};return Ve()?C.ibi=v.packageName:Yt()?C.apn=v.packageName:Te(d,"operation-not-supported-in-this-environment"),v.displayName&&(C.appDisplayName=v.displayName),C.sessionId=b,wr(d,a,o.type,void 0,null!==(f=o.eventId)&&void 0!==f?f:void 0,C)})).apply(this,arguments)}function xs(){return(xs=(0,h.Z)(function*(d){const{BuildInfo:o}=qn(),a={};Ve()?a.iosBundleId=o.packageName:Yt()?a.androidPackageName=o.packageName:Te(d,"operation-not-supported-in-this-environment"),yield ll(d,a)})).apply(this,arguments)}function Oi(){return(Oi=(0,h.Z)(function*(d,o,a){const{cordova:f}=qn();let v=()=>{};try{yield new Promise((b,C)=>{let A=null;function H(){var Q;b();const we=null===(Q=f.plugins.browsertab)||void 0===Q?void 0:Q.close;"function"==typeof we&&we(),"function"==typeof(null==a?void 0:a.close)&&a.close()}function Y(){A||(A=window.setTimeout(()=>{C(ve(d,"redirect-cancelled-by-user"))},2e3))}function J(){"visible"===(null==document?void 0:document.visibilityState)&&Y()}o.addPassiveListener(H),document.addEventListener("resume",Y,!1),Yt()&&document.addEventListener("visibilitychange",J,!1),v=()=>{o.removePassiveListener(H),document.removeEventListener("resume",Y,!1),document.removeEventListener("visibilitychange",J,!1),A&&window.clearTimeout(A)}})}finally{v()}})).apply(this,arguments)}function Tc(d){return Mi.apply(this,arguments)}function Mi(){return(Mi=(0,h.Z)(function*(d){const o=vl(d),a=yield crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(a)).map(v=>v.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}function vl(d){if(L(/[0-9a-zA-Z]+/.test(d),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(d);const o=new ArrayBuffer(d.length),a=new Uint8Array(o);for(let f=0;f<d.length;f++)a[f]=d.charCodeAt(f);return a}!function Ge(d){(0,$e._registerComponent)(new te.wA("auth",(o,{options:a})=>{const f=o.getProvider("app").getImmediate(),v=o.getProvider("heartbeat"),{apiKey:b,authDomain:C}=f.options;return((A,H)=>{U(b&&!b.includes(":"),"invalid-api-key",{appName:A.name}),U(!(null==C?void 0:C.includes(":")),"argument-error",{appName:A.name});const Y={apiKey:b,authDomain:C,clientPlatform:d,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:to(d)},J=new Qr(A,H,Y);return function W(d,o){const a=(null==o?void 0:o.persistence)||[],f=(Array.isArray(a)?a:[a]).map(B);(null==o?void 0:o.errorMap)&&d._updateErrorMap(o.errorMap),d._initializeWithPersistence(f,null==o?void 0:o.popupRedirectResolver)}(J,a),J})(f,v)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((o,a,f)=>{o.getProvider("auth-internal").initialize()})),(0,$e._registerComponent)(new te.wA("auth-internal",o=>{const a=Ze(o.getProvider("auth").getImmediate());return new gl(a)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,$e.registerVersion)(Nc,ea,function Mt(d){switch(d){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(d)),(0,$e.registerVersion)(Nc,ea,"esm2017")}("Browser");class Jt extends Yo{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(o=>{this.resolveInialized=o})}addPassiveListener(o){this.passiveListeners.add(o)}removePassiveListener(o){this.passiveListeners.delete(o)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(o){return this.resolveInialized(),this.passiveListeners.forEach(a=>a(o)),super.onEvent(o)}initialized(){var o=this;return(0,h.Z)(function*(){yield o.initPromise})()}}function ia(d){return xi.apply(this,arguments)}function xi(){return(xi=(0,h.Z)(function*(d){const o=yield ra()._get(yl(d));return o&&(yield ra()._remove(yl(d))),o})).apply(this,arguments)}function Dr(){const d=[],o="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let a=0;a<20;a++){const f=Math.floor(Math.random()*o.length);d.push(o.charAt(f))}return d.join("")}function ra(){return B(ur)}function yl(d){return Gn("authEvent",d.config.apiKey,d.name)}function _i(d){if(!(null==d?void 0:d.includes("?")))return{};const[o,...a]=d.split("?");return(0,x.zd)(a.join("?"))}function Sr(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:ve("no-auth-event")}}function sa(){var d;return(null===(d=null==self?void 0:self.location)||void 0===d?void 0:d.protocol)||null}function Rr(d=(0,x.z$)()){return!("file:"!==sa()&&"ionic:"!==sa()||!d.toLowerCase().match(/iphone|ipad|ipod|android/))}function Ar(){try{const d=self.localStorage,o=dr();if(d)return d.setItem(o,"1"),d.removeItem(o),!function la(d=(0,x.z$)()){return function aa(){return(0,x.w1)()&&11===(null==document?void 0:document.documentMode)}()||function Nl(d=(0,x.z$)()){return/Edge\/\d+/.test(d)}(d)}()||(0,x.hl)()}catch(d){return ca()&&(0,x.hl)()}return!1}function ca(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function Fi(){return(function oa(){return"http:"===sa()||"https:"===sa()}()||(0,x.ru)()||Rr())&&!function Wt(){return(0,x.b$)()||(0,x.UG)()}()&&Ar()&&!ca()}function Tl(){return Rr()&&"undefined"!=typeof document}function _n(){return(_n=(0,h.Z)(function*(){return!!Tl()&&new Promise(d=>{const o=setTimeout(()=>{d(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(o),d(!0)})})})).apply(this,arguments)}const Pt={LOCAL:"local",NONE:"none",SESSION:"session"},Qn=U,kr="persistence";function Mr(d){return ua.apply(this,arguments)}function ua(){return(ua=(0,h.Z)(function*(d){yield d._initializationPromise;const o=wl(),a=Gn(kr,d.config.apiKey,d.name);o&&o.setItem(a,d._getPersistence())})).apply(this,arguments)}function wl(){var d;try{return(null===(d=function Cc(){return"undefined"!=typeof window?window:null}())||void 0===d?void 0:d.sessionStorage)||null}catch(o){return null}}const da=U;class mn{constructor(){this.browserResolver=B(class pl{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=un,this._completeRedirectFn=fi}_openPopup(o,a,f,v){var b=this;return(0,h.Z)(function*(){var C;L(null===(C=b.eventManagers[o._key()])||void 0===C?void 0:C.manager,"_initialize() not called before _openPopup()");const A=wr(o,a,f,ie(),v);return function Tr(d,o,a,f=500,v=600){const b=Math.max((window.screen.availHeight-v)/2,0).toString(),C=Math.max((window.screen.availWidth-f)/2,0).toString();let A="";const H=Object.assign(Object.assign({},fl),{width:f.toString(),height:v.toString(),top:b,left:C}),Y=(0,x.z$)().toLowerCase();a&&(A=At(Y)?"_blank":a),Rt(Y)&&(o=o||"http://localhost",H.scrollbars="yes");const J=Object.entries(H).reduce((we,[_t,Ws])=>`${we}${_t}=${Ws},`,"");if(function Jr(d=(0,x.z$)()){var o;return Ve(d)&&!!(null===(o=window.navigator)||void 0===o?void 0:o.standalone)}(Y)&&"_self"!==A)return function vc(d,o){const a=document.createElement("a");a.href=d,a.target=o;const f=document.createEvent("MouseEvent");f.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(f)}(o||"",A),new mc(null);const Q=window.open(o||"",A,J);U(Q,d,"popup-blocked");try{Q.focus()}catch(we){}return new mc(Q)}(o,A,dr())})()}_openRedirect(o,a,f,v){var b=this;return(0,h.Z)(function*(){return yield b._originValidation(o),function Dn(d){We().location.href=d}(wr(o,a,f,ie(),v)),new Promise(()=>{})})()}_initialize(o){const a=o._key();if(this.eventManagers[a]){const{manager:v,promise:b}=this.eventManagers[a];return v?Promise.resolve(v):(L(b,"If manager is not set, promise should be"),b)}const f=this.initAndGetManager(o);return this.eventManagers[a]={promise:f},f.catch(()=>{delete this.eventManagers[a]}),f}initAndGetManager(o){var a=this;return(0,h.Z)(function*(){const f=yield function tu(d){return hl.apply(this,arguments)}(o),v=new Yo(o);return f.register("authEvent",b=>(U(null==b?void 0:b.authEvent,o,"invalid-auth-event"),{status:v.onEvent(b.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),a.eventManagers[o._key()]={manager:v},a.iframes[o._key()]=f,v})()}_isIframeWebStorageSupported(o,a){this.iframes[o._key()].send(Er,{type:Er},v=>{var b;const C=null===(b=null==v?void 0:v[0])||void 0===b?void 0:b[Er];void 0!==C&&a(!!C),Te(o,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(o){const a=o._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function ul(d){return ks.apply(this,arguments)}(o)),this.originValidationPromises[a]}get _shouldInitProactively(){return eo()||ct()||Ve()}}),this.cordovaResolver=B(class wc{constructor(){this._redirectPersistence=un,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=fi}_initialize(o){var a=this;return(0,h.Z)(function*(){const f=o._key();let v=a.eventManagers.get(f);return v||(v=new Jt(o),a.eventManagers.set(f,v),a.attachCallbackListeners(o,v)),v})()}_openPopup(o){Te(o,"operation-not-supported-in-this-environment")}_openRedirect(o,a,f,v){var b=this;return(0,h.Z)(function*(){!function ml(d){var o,a,f,v,b,C,A,H,Y,J;const Q=qn();U("function"==typeof(null===(o=null==Q?void 0:Q.universalLinks)||void 0===o?void 0:o.subscribe),d,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),U(void 0!==(null===(a=null==Q?void 0:Q.BuildInfo)||void 0===a?void 0:a.packageName),d,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),U("function"==typeof(null===(b=null===(v=null===(f=null==Q?void 0:Q.cordova)||void 0===f?void 0:f.plugins)||void 0===v?void 0:v.browsertab)||void 0===b?void 0:b.openUrl),d,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),U("function"==typeof(null===(H=null===(A=null===(C=null==Q?void 0:Q.cordova)||void 0===C?void 0:C.plugins)||void 0===A?void 0:A.browsertab)||void 0===H?void 0:H.isAvailable),d,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),U("function"==typeof(null===(J=null===(Y=null==Q?void 0:Q.cordova)||void 0===Y?void 0:Y.InAppBrowser)||void 0===J?void 0:J.open),d,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(o);const C=yield b._initialize(o);yield C.initialized(),C.resetRedirect(),function Kc(){Vo.clear()}(),yield b._originValidation(o);const A=function gi(d,o,a=null){return{type:o,eventId:a,urlResponse:null,sessionId:Dr(),postBody:null,tenantId:d.tenantId,error:ve(d,"no-auth-event")}}(o,f,v);yield function Fs(d,o){return ra()._set(yl(d),o)}(o,A);const H=yield function _l(d,o,a){return Cr.apply(this,arguments)}(o,A,a),Y=yield function Jn(d){const{cordova:o}=qn();return new Promise(a=>{o.plugins.browsertab.isAvailable(f=>{let v=null;f?o.plugins.browsertab.openUrl(d):v=o.InAppBrowser.open(d,function Zt(d=(0,x.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(d)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(d)}()?"_blank":"_system","location=yes"),a(v)})})}(H);return function gn(d,o,a){return Oi.apply(this,arguments)}(o,C,Y)})()}_isIframeWebStorageSupported(o,a){throw new Error("Method not implemented.")}_originValidation(o){const a=o._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function Ir(d){return xs.apply(this,arguments)}(o)),this.originValidationPromises[a]}attachCallbackListeners(o,a){const{universalLinks:f,handleOpenURL:v,BuildInfo:b}=qn(),C=setTimeout((0,h.Z)(function*(){yield ia(o),a.onEvent(Sr())}),500),A=function(){var J=(0,h.Z)(function*(Q){clearTimeout(C);const we=yield ia(o);let _t=null;we&&(null==Q?void 0:Q.url)&&(_t=function On(d,o){var a,f;const v=function Mn(d){const o=_i(d),a=o.link?decodeURIComponent(o.link):void 0,f=_i(a).link,v=o.deep_link_id?decodeURIComponent(o.deep_link_id):void 0;return _i(v).link||v||f||a||d}(o);if(v.includes("/__/auth/callback")){const b=_i(v),C=b.firebaseError?function Ls(d){try{return JSON.parse(d)}catch(o){return null}}(decodeURIComponent(b.firebaseError)):null,A=null===(f=null===(a=null==C?void 0:C.code)||void 0===a?void 0:a.split("auth/"))||void 0===f?void 0:f[1],H=A?ve(A):null;return H?{type:d.type,eventId:d.eventId,tenantId:d.tenantId,error:H,urlResponse:null,sessionId:null,postBody:null}:{type:d.type,eventId:d.eventId,tenantId:d.tenantId,sessionId:d.sessionId,urlResponse:v,postBody:null}}return null}(we,Q.url)),a.onEvent(_t||Sr())});return function(we){return J.apply(this,arguments)}}();void 0!==f&&"function"==typeof f.subscribe&&f.subscribe(null,A);const H=v,Y=`${b.packageName.toLowerCase()}://`;qn().handleOpenURL=function(){var J=(0,h.Z)(function*(Q){if(Q.toLowerCase().startsWith(Y)&&A({url:Q}),"function"==typeof H)try{H(Q)}catch(we){console.error(we)}});return function(Q){return J.apply(this,arguments)}}()}}),this.underlyingResolver=null,this._redirectPersistence=un,this._completeRedirectFn=fi}_initialize(o){var a=this;return(0,h.Z)(function*(){return yield a.selectUnderlyingResolver(),a.assertedUnderlyingResolver._initialize(o)})()}_openPopup(o,a,f,v){var b=this;return(0,h.Z)(function*(){return yield b.selectUnderlyingResolver(),b.assertedUnderlyingResolver._openPopup(o,a,f,v)})()}_openRedirect(o,a,f,v){var b=this;return(0,h.Z)(function*(){return yield b.selectUnderlyingResolver(),b.assertedUnderlyingResolver._openRedirect(o,a,f,v)})()}_isIframeWebStorageSupported(o,a){this.assertedUnderlyingResolver._isIframeWebStorageSupported(o,a)}_originValidation(o){return this.assertedUnderlyingResolver._originValidation(o)}get _shouldInitProactively(){return Tl()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return da(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var o=this;return(0,h.Z)(function*(){if(o.underlyingResolver)return;const a=yield function Li(){return _n.apply(this,arguments)}();o.underlyingResolver=a?o.cordovaResolver:o.browserResolver})()}}function El(d){return d.unwrap()}function ha(d){return Bs(d)}function Bs(d){const{_tokenResponse:o}=d instanceof x.ZR?d.customData:d;if(!o)return null;if(!(d instanceof x.ZR)&&"temporaryProof"in o&&"phoneNumber"in o)return Ai.credentialFromResult(d);const a=o.providerId;if(!a||"password"===a)return null;let f;switch(a){case"google.com":f=Sa;break;case"facebook.com":f=Da;break;case"github.com":f=go;break;case"twitter.com":f=_o;break;default:const{oauthIdToken:v,oauthAccessToken:b,oauthTokenSecret:C,pendingToken:A,nonce:H}=o;return b||C||v||A?A?a.startsWith("saml.")?Ti._create(a,A):on._fromParams({providerId:a,signInMethod:a,pendingToken:A,idToken:v,accessToken:b}):new Ni(a).credential({idToken:v,accessToken:b,rawNonce:H}):null}return d instanceof x.ZR?f.credentialFromError(d):f.credentialFromResult(d)}function qe(d,o){return o.catch(a=>{throw a instanceof x.ZR&&function fa(d,o){var a;const f=null===(a=o.customData)||void 0===a?void 0:a._tokenResponse;if("auth/multi-factor-auth-required"===o.code)o.resolver=new ga(d,function Va(d,o){var a;const f=(0,x.m9)(d),v=o;return U(o.customData.operationType,f,"argument-error"),U(null===(a=v.customData._serverResponse)||void 0===a?void 0:a.mfaPendingCredential,f,"argument-error"),Ao._fromError(f,v)}(d,o));else if(f){const v=Bs(o),b=o;v&&(b.credential=v,b.tenantId=f.tenantId||void 0,b.email=f.email||void 0,b.phoneNumber=f.phoneNumber||void 0)}}(d,a),a}).then(a=>{const v=a.user;return{operationType:a.operationType,credential:ha(a),additionalUserInfo:Ql(a),user:It.getOrCreate(v)}})}function Xt(d,o){return pa.apply(this,arguments)}function pa(){return(pa=(0,h.Z)(function*(d,o){const a=yield o;return{verificationId:a.verificationId,confirm:f=>qe(d,a.confirm(f))}})).apply(this,arguments)}class ga{constructor(o,a){this.resolver=a,this.auth=function Cl(d){return d.wrapped()}(o)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(o){return qe(El(this.auth),this.resolver.resolveSignIn(o))}}class It{constructor(o){this._delegate=o,this.multiFactor=function ja(d){const o=(0,x.m9)(d);return ko.has(o)||ko.set(o,ai._fromUser(o)),ko.get(o)}(o)}static getOrCreate(o){return It.USER_MAP.has(o)||It.USER_MAP.set(o,new It(o)),It.USER_MAP.get(o)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(o){return this._delegate.getIdTokenResult(o)}getIdToken(o){return this._delegate.getIdToken(o)}linkAndRetrieveDataWithCredential(o){return this.linkWithCredential(o)}linkWithCredential(o){var a=this;return(0,h.Z)(function*(){return qe(a.auth,yt(a._delegate,o))})()}linkWithPhoneNumber(o,a){var f=this;return(0,h.Z)(function*(){return Xt(f.auth,function oc(d,o,a){return Es.apply(this,arguments)}(f._delegate,o,a))})()}linkWithPopup(o){var a=this;return(0,h.Z)(function*(){return qe(a.auth,function tl(d,o,a){return mr.apply(this,arguments)}(a._delegate,o,mn))})()}linkWithRedirect(o){var a=this;return(0,h.Z)(function*(){return yield Mr(Ze(a.auth)),function st(d,o,a){return function dc(d,o,a){return ol.apply(this,arguments)}(d,o,a)}(a._delegate,o,mn)})()}reauthenticateAndRetrieveDataWithCredential(o){return this.reauthenticateWithCredential(o)}reauthenticateWithCredential(o){var a=this;return(0,h.Z)(function*(){return qe(a.auth,bo(a._delegate,o))})()}reauthenticateWithPhoneNumber(o,a){return Xt(this.auth,function ac(d,o,a){return pn.apply(this,arguments)}(this._delegate,o,a))}reauthenticateWithPopup(o){return qe(this.auth,function Yc(d,o,a){return el.apply(this,arguments)}(this._delegate,o,mn))}reauthenticateWithRedirect(o){var a=this;return(0,h.Z)(function*(){return yield Mr(Ze(a.auth)),function Qc(d,o,a){return function Xc(d,o,a){return sl.apply(this,arguments)}(d,o,a)}(a._delegate,o,mn)})()}sendEmailVerification(o){return function Ua(d,o){return hs.apply(this,arguments)}(this._delegate,o)}unlink(o){var a=this;return(0,h.Z)(function*(){return yield function Oa(d,o){return _e.apply(this,arguments)}(a._delegate,o),a})()}updateEmail(o){return function Fe(d,o){return Ga((0,x.m9)(d),o,null)}(this._delegate,o)}updatePassword(o){return function ql(d,o){return Ga((0,x.m9)(d),null,o)}(this._delegate,o)}updatePhoneNumber(o){return function $c(d,o){return Ja.apply(this,arguments)}(this._delegate,o)}updateProfile(o){return function Kl(d,o){return or.apply(this,arguments)}(this._delegate,o)}verifyBeforeUpdateEmail(o,a){return function Ci(d,o,a){return fs.apply(this,arguments)}(this._delegate,o,a)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}It.USER_MAP=new WeakMap;const Gs=U;let Ui=(()=>{class d{constructor(a,f){if(this.app=a,f.isInitialized())return this._delegate=f.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:v}=a.options;Gs(v,"invalid-api-key",{appName:a.name}),Gs(v,"invalid-api-key",{appName:a.name});const b="undefined"!=typeof window?mn:void 0;this._delegate=f.initialize({options:{persistence:Il(v,a.name),popupRedirectResolver:b}}),this._delegate._updateErrorMap(V),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?It.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(a){this._delegate.languageCode=a}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(a){this._delegate.tenantId=a}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(a,f){!function Ea(d,o,a){const f=Ze(d);U(f._canInitEmulator,f,"emulator-config-failed"),U(/^https?:\/\//.test(o),f,"invalid-emulator-scheme");const v=!!(null==a?void 0:a.disableWarnings),b=Vn(o),{host:C,port:A}=function Ul(d){const o=Vn(d),a=/(\/\/)?([^?#/]+)/.exec(d.substr(o.length));if(!a)return{host:"",port:null};const f=a[2].split("@").pop()||"",v=/^(\[[^\]]+\])(:|$)/.exec(f);if(v){const b=v[1];return{host:b,port:no(f.substr(b.length+1))}}{const[b,C]=f.split(":");return{host:b,port:no(C)}}}(o);f.config.emulator={url:`${b}//${C}${null===A?"":`:${A}`}/`},f.settings.appVerificationDisabledForTesting=!0,f.emulatorConfig=Object.freeze({host:C,port:A,protocol:b.replace(":",""),options:Object.freeze({disableWarnings:v})}),v||function Yi(){function d(){const o=document.createElement("p"),a=o.style;o.innerText="Running in emulator mode. Do not use with production credentials.",a.position="fixed",a.width="100%",a.backgroundColor="#ffffff",a.border=".1em solid #000000",a.color="#b50000",a.bottom="0px",a.left="0px",a.margin="0px",a.zIndex="10000",a.textAlign="center",o.classList.add("firebase-emulator-warning"),document.body.appendChild(o)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",d):d())}()}(this._delegate,a,f)}applyActionCode(a){return function Yl(d,o){return Eo.apply(this,arguments)}(this._delegate,a)}checkActionCode(a){return La(this._delegate,a)}confirmPasswordReset(a,f){return function Fa(d,o,a){return wo.apply(this,arguments)}(this._delegate,a,f)}createUserWithEmailAndPassword(a,f){var v=this;return(0,h.Z)(function*(){return qe(v._delegate,function ls(d,o,a){return cs.apply(this,arguments)}(v._delegate,a,f))})()}fetchProvidersForEmail(a){return this.fetchSignInMethodsForEmail(a)}fetchSignInMethodsForEmail(a){return function Zl(d,o){return ds.apply(this,arguments)}(this._delegate,a)}isSignInWithEmailLink(a){return function zl(d,o){const a=tr.parseLink(o);return"EMAIL_SIGNIN"===(null==a?void 0:a.operation)}(0,a)}getRedirectResult(){var a=this;return(0,h.Z)(function*(){Gs(Fi(),a._delegate,"operation-not-supported-in-this-environment");const f=yield function hc(d,o){return $o.apply(this,arguments)}(a._delegate,mn);return f?qe(a._delegate,Promise.resolve(f)):{credential:null,user:null}})()}addFrameworkForLogging(a){!function Us(d,o){Ze(d)._logFramework(o)}(this._delegate,a)}onAuthStateChanged(a,f,v){const{next:b,error:C,complete:A}=_a(a,f,v);return this._delegate.onAuthStateChanged(b,C,A)}onIdTokenChanged(a,f,v){const{next:b,error:C,complete:A}=_a(a,f,v);return this._delegate.onIdTokenChanged(b,C,A)}sendSignInLinkToEmail(a,f){return function us(d,o,a){return Ot.apply(this,arguments)}(this._delegate,a,f)}sendPasswordResetEmail(a,f){return function Uc(d,o,a){return To.apply(this,arguments)}(this._delegate,a,f||void 0)}setPersistence(a){var f=this;return(0,h.Z)(function*(){let v;switch(function Or(d,o){Qn(Object.values(Pt).includes(o),d,"invalid-persistence-type"),(0,x.b$)()?Qn(o!==Pt.SESSION,d,"unsupported-persistence-type"):(0,x.UG)()?Qn(o===Pt.NONE,d,"unsupported-persistence-type"):ca()?Qn(o===Pt.NONE||o===Pt.LOCAL&&(0,x.hl)(),d,"unsupported-persistence-type"):Qn(o===Pt.NONE||Ar(),d,"unsupported-persistence-type")}(f._delegate,a),a){case Pt.SESSION:v=un;break;case Pt.LOCAL:v=(yield B(hn)._isAvailable())?hn:ur;break;case Pt.NONE:v=ye;break;default:return Te("argument-error",{appName:f._delegate.name})}return f._delegate.setPersistence(v)})()}signInAndRetrieveDataWithCredential(a){return this.signInWithCredential(a)}signInAnonymously(){return qe(this._delegate,function jl(d){return os.apply(this,arguments)}(this._delegate))}signInWithCredential(a){return qe(this._delegate,Me(this._delegate,a))}signInWithCustomToken(a){return qe(this._delegate,function Lc(d,o){return No.apply(this,arguments)}(this._delegate,a))}signInWithEmailAndPassword(a,f){return qe(this._delegate,function ln(d,o,a){return Me((0,x.m9)(d),oi.credential(o,a))}(this._delegate,a,f))}signInWithEmailLink(a,f){return qe(this._delegate,function Et(d,o,a){return Co.apply(this,arguments)}(this._delegate,a,f))}signInWithPhoneNumber(a,f){return Xt(this._delegate,function sc(d,o,a){return Uo.apply(this,arguments)}(this._delegate,a,f))}signInWithPopup(a){var f=this;return(0,h.Z)(function*(){return Gs(Fi(),f._delegate,"operation-not-supported-in-this-environment"),qe(f._delegate,function uc(d,o,a){return Ho.apply(this,arguments)}(f._delegate,a,mn))})()}signInWithRedirect(a){var f=this;return(0,h.Z)(function*(){return Gs(Fi(),f._delegate,"operation-not-supported-in-this-environment"),yield Mr(f._delegate),function qc(d,o,a){return function Jc(d,o,a){return jo.apply(this,arguments)}(d,o,a)}(f._delegate,a,mn)})()}updateCurrentUser(a){return this._delegate.updateCurrentUser(a)}verifyPasswordResetCode(a){return function de(d,o){return Ei.apply(this,arguments)}(this._delegate,a)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return d.Persistence=Pt,d})();function _a(d,o,a){let f=d;"function"!=typeof d&&({next:f,error:o,complete:a}=d);const v=f;return{next:C=>v(C&&It.getOrCreate(C)),error:o,complete:a}}function Il(d,o){const a=function Ic(d,o){const a=wl();if(!a)return[];const f=Gn(kr,d,o);switch(a.getItem(f)){case Pt.NONE:return[ye];case Pt.LOCAL:return[hn,un];case Pt.SESSION:return[un];default:return[]}}(d,o);if("undefined"!=typeof self&&!a.includes(hn)&&a.push(hn),"undefined"!=typeof window)for(const f of[ur,un])a.includes(f)||a.push(f);return a.includes(ye)||a.push(ye),a}class Pr{constructor(){this.providerId="phone",this._delegate=new Ai(El(ne.Z.auth()))}static credential(o,a){return Ai.credential(o,a)}verifyPhoneNumber(o,a){return this._delegate.verifyPhoneNumber(o,a)}unwrap(){return this._delegate}}Pr.PHONE_SIGN_IN_METHOD=Ai.PHONE_SIGN_IN_METHOD,Pr.PROVIDER_ID=Ai.PROVIDER_ID;const ma=U;class xr{constructor(o,a,f=ne.Z.app()){var v;ma(null===(v=f.options)||void 0===v?void 0:v.apiKey,"invalid-api-key",{appName:f.name}),this._delegate=new zn(o,a,f.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function Vs(d){d.INTERNAL.registerComponent(new te.wA("auth-compat",o=>{const a=o.getProvider("app-compat").getImmediate(),f=o.getProvider("auth");return new Ui(a,f)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:oi,FacebookAuthProvider:Da,GithubAuthProvider:go,GoogleAuthProvider:Sa,OAuthProvider:Ni,SAMLAuthProvider:rs,PhoneAuthProvider:Pr,PhoneMultiFactorGenerator:su,RecaptchaVerifier:xr,TwitterAuthProvider:_o,Auth:Ui,AuthCredential:En,Error:x.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),d.registerVersion("@firebase/auth-compat","0.2.11")}(ne.Z)},3753:(Vr,Dt,F)=>{F.d(Dt,{R:()=>he});var h=F(2916),ne=F(6688),x=F(7043),$e=F(4850);function he(re,Le,dt,St){return(0,x.m)(dt)&&(St=dt,dt=void 0),St?he(re,Le,dt).pipe((0,$e.U)(V=>(0,ne.k)(V)?St(...V):St(V))):new h.y(V=>{te(re,Le,function Ft(Ee){V.next(arguments.length>1?Array.prototype.slice.call(arguments):Ee)},V,dt)})}function te(re,Le,dt,St,V){let Ft;if(function He(re){return re&&"function"==typeof re.addEventListener&&"function"==typeof re.removeEventListener}(re)){const Ee=re;re.addEventListener(Le,dt,V),Ft=()=>Ee.removeEventListener(Le,dt,V)}else if(function ee(re){return re&&"function"==typeof re.on&&"function"==typeof re.off}(re)){const Ee=re;re.on(Le,dt),Ft=()=>Ee.off(Le,dt)}else if(function se(re){return re&&"function"==typeof re.addListener&&"function"==typeof re.removeListener}(re)){const Ee=re;re.addListener(Le,dt),Ft=()=>Ee.removeListener(Le,dt)}else{if(!re||!re.length)throw new TypeError("Invalid event target");for(let Ee=0,Zs=re.length;Ee<Zs;Ee++)te(re[Ee],Le,dt,St,V)}St.add(Ft)}},8723:(Vr,Dt,F)=>{F.d(Dt,{H:()=>at});var h=F(2916),ne=F(353),x=F(4241),$e=F(2866);function at(te=0,se,ee){let He=-1;return(0,x.k)(se)?He=Number(se)<1?1:Number(se):(0,$e.K)(se)&&(ee=se),(0,$e.K)(ee)||(ee=ne.P),new h.y(re=>{const Le=(0,x.k)(te)?te:+te-ee.now();return ee.schedule(he,Le,{index:0,period:He,subscriber:re})})}function he(te){const{index:se,period:ee,subscriber:He}=te;if(He.next(se),!He.closed){if(-1===ee)return He.complete();te.index=se+1,this.schedule(te,ee)}}},5778:(Vr,Dt,F)=>{F.d(Dt,{x:()=>ne});var h=F(3489);function ne(at,he){return te=>te.lift(new x(at,he))}class x{constructor(he,te){this.compare=he,this.keySelector=te}call(he,te){return te.subscribe(new $e(he,this.compare,this.keySelector))}}class $e extends h.L{constructor(he,te,se){super(he),this.keySelector=se,this.hasKey=!1,"function"==typeof te&&(this.compare=te)}compare(he,te){return he===te}_next(he){let te;try{const{keySelector:ee}=this;te=ee?ee(he):he}catch(ee){return this.destination.error(ee)}let se=!1;if(this.hasKey)try{const{compare:ee}=this;se=ee(this.key,te)}catch(ee){return this.destination.error(ee)}else this.hasKey=!0;se||(this.key=te,this.destination.next(he))}}},7625:(Vr,Dt,F)=>{F.d(Dt,{R:()=>ne});var h=F(1177);function ne(at){return he=>he.lift(new x(at))}class x{constructor(he){this.notifier=he}call(he,te){const se=new $e(he),ee=(0,h.ft)(this.notifier,new h.IY(se));return ee&&!se.seenValue?(se.add(ee),te.subscribe(se)):se}}class $e extends h.Ds{constructor(he){super(he),this.seenValue=!1}notifyNext(){this.seenValue=!0,this.complete()}notifyComplete(){}}},7168:(Vr,Dt,F)=>{F.d(Dt,{M:()=>x});var h=F(826),ne=F(448);function x(...he){return te=>{let se;return"function"==typeof he[he.length-1]&&(se=he.pop()),te.lift(new $e(he,se))}}class $e{constructor(te,se){this.observables=te,this.project=se}call(te,se){return se.subscribe(new at(te,this.observables,this.project))}}class at extends h.L{constructor(te,se,ee){super(te),this.observables=se,this.project=ee,this.toRespond=[];const He=se.length;this.values=new Array(He);for(let re=0;re<He;re++)this.toRespond.push(re);for(let re=0;re<He;re++)this.add((0,ne.D)(this,se[re],void 0,re))}notifyNext(te,se,ee){this.values[ee]=se;const He=this.toRespond;if(He.length>0){const re=He.indexOf(ee);-1!==re&&He.splice(re,1)}}notifyComplete(){}_next(te){if(0===this.toRespond.length){const se=[te,...this.values];this.project?this._tryProject(se):this.destination.next(se)}}_tryProject(te){let se;try{se=this.project.apply(this,te)}catch(ee){return void this.destination.error(ee)}this.destination.next(se)}}},655:(Vr,Dt,F)=>{function $e(M,L){var G={};for(var B in M)Object.prototype.hasOwnProperty.call(M,B)&&L.indexOf(B)<0&&(G[B]=M[B]);if(null!=M&&"function"==typeof Object.getOwnPropertySymbols){var Z=0;for(B=Object.getOwnPropertySymbols(M);Z<B.length;Z++)L.indexOf(B[Z])<0&&Object.prototype.propertyIsEnumerable.call(M,B[Z])&&(G[B[Z]]=M[B[Z]])}return G}function at(M,L,G,B){var ie,Z=arguments.length,W=Z<3?L:null===B?B=Object.getOwnPropertyDescriptor(L,G):B;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)W=Reflect.decorate(M,L,G,B);else for(var ke=M.length-1;ke>=0;ke--)(ie=M[ke])&&(W=(Z<3?ie(W):Z>3?ie(L,G,W):ie(L,G))||W);return Z>3&&W&&Object.defineProperty(L,G,W),W}function te(M,L){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(M,L)}function se(M,L,G,B){return new(G||(G=Promise))(function(W,ie){function ke(Ce){try{ue(B.next(Ce))}catch(Oe){ie(Oe)}}function Lt(Ce){try{ue(B.throw(Ce))}catch(Oe){ie(Oe)}}function ue(Ce){Ce.done?W(Ce.value):function Z(W){return W instanceof G?W:new G(function(ie){ie(W)})}(Ce.value).then(ke,Lt)}ue((B=B.apply(M,L||[])).next())})}F.d(Dt,{_T:()=>$e,gn:()=>at,w6:()=>te,mG:()=>se})},9644:(Vr,Dt,F)=>{F.d(Dt,{FF:()=>da,bz:()=>mn,IJ:()=>Pn});var h=F(5e3),ne=F(9808),x=F(6688),$e=F(3009),at=F(826),he=F(448);class se{call(l,i){return i.subscribe(new ee(l))}}class ee extends at.L{constructor(l){super(l),this.hasFirst=!1,this.observables=[],this.subscriptions=[]}_next(l){this.observables.push(l)}_complete(){const l=this.observables,i=l.length;if(0===i)this.destination.complete();else{for(let u=0;u<i&&!this.hasFirst;u++){const m=(0,he.D)(this,l[u],void 0,u);this.subscriptions&&this.subscriptions.push(m),this.add(m)}this.observables=null}}notifyNext(l,i,u){if(!this.hasFirst){this.hasFirst=!0;for(let g=0;g<this.subscriptions.length;g++)if(g!==u){let m=this.subscriptions[g];m.unsubscribe(),this.remove(m)}this.subscriptions=null}this.destination.next(i)}}var He=F(2916),re=F(7876);new He.y(re.Z);var St=F(3489),V=F(5430),Ft=F(1177);function Ee(...s){const l=s[s.length-1];return"function"==typeof l&&s.pop(),(0,$e.n)(s,void 0).lift(new Zs(l))}class Zs{constructor(l){this.resultSelector=l}call(l,i){return i.subscribe(new ti(l,this.resultSelector))}}class ti extends St.L{constructor(l,i,u=Object.create(null)){super(l),this.resultSelector=i,this.iterators=[],this.active=0,this.resultSelector="function"==typeof i?i:void 0}_next(l){const i=this.iterators;(0,x.k)(l)?i.push(new Te(l)):i.push("function"==typeof l[V.hZ]?new Hi(l[V.hZ]()):new ve(this.destination,this,l))}_complete(){const l=this.iterators,i=l.length;if(this.unsubscribe(),0!==i){this.active=i;for(let u=0;u<i;u++){let g=l[u];g.stillUnsubscribed?this.destination.add(g.subscribe()):this.active--}}else this.destination.complete()}notifyInactive(){this.active--,0===this.active&&this.destination.complete()}checkIterators(){const l=this.iterators,i=l.length,u=this.destination;for(let w=0;w<i;w++){let I=l[w];if("function"==typeof I.hasValue&&!I.hasValue())return}let g=!1;const m=[];for(let w=0;w<i;w++){let I=l[w],D=I.next();if(I.hasCompleted()&&(g=!0),D.done)return void u.complete();m.push(D.value)}this.resultSelector?this._tryresultSelector(m):u.next(m),g&&u.complete()}_tryresultSelector(l){let i;try{i=this.resultSelector.apply(this,l)}catch(u){return void this.destination.error(u)}this.destination.next(i)}}class Hi{constructor(l){this.iterator=l,this.nextResult=l.next()}hasValue(){return!0}next(){const l=this.nextResult;return this.nextResult=this.iterator.next(),l}hasCompleted(){const l=this.nextResult;return Boolean(l&&l.done)}}class Te{constructor(l){this.array=l,this.index=0,this.length=0,this.length=l.length}[V.hZ](){return this}next(l){const i=this.index++;return i<this.length?{value:this.array[i],done:!1}:{value:null,done:!0}}hasValue(){return this.array.length>this.index}hasCompleted(){return this.array.length===this.index}}class ve extends Ft.Ds{constructor(l,i,u){super(l),this.parent=i,this.observable=u,this.stillUnsubscribed=!0,this.buffer=[],this.isComplete=!1}[V.hZ](){return this}next(){const l=this.buffer;return 0===l.length&&this.isComplete?{value:null,done:!0}:{value:l.shift(),done:!1}}hasValue(){return this.buffer.length>0}hasCompleted(){return 0===this.buffer.length&&this.isComplete}notifyComplete(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()}notifyNext(l){this.buffer.push(l),this.parent.checkIterators()}subscribe(){return(0,Ft.ft)(this.observable,new Ft.IY(this))}}var Je=F(8896),lt=F(1086),ht=F(8929),U=F(3753),M=F(8723),B=(F(591),F(6053),F(1221));F(353),F(9312);var ze=F(7625),Be=F(2198),Ie=F(2986),Nn=F(4850),nn=(F(1059),F(5778),F(7545)),Wi=F(2994),jr=F(7168),Ks=F(4182);Math,Math,Math;const os=["*"],In=["dialog"];function Vt(s){return null!=s}function Sn(s){return(s||document.body).getBoundingClientRect()}"undefined"!=typeof Element&&!Element.prototype.closest&&(Element.prototype.closest=function(s){let l=this;if(!document.documentElement.contains(l))return null;do{if(l.matches(s))return l;l=l.parentElement||l.parentNode}while(null!==l&&1===l.nodeType);return null});const ms={animation:!0,transitionTimerDelayMs:5},fr=()=>{},{transitionTimerDelayMs:vs}=ms,dn=new Map,rt=(s,l,i,u)=>{let g=u.context||{};const m=dn.get(l);if(m)switch(u.runningTransition){case"continue":return Je.E;case"stop":s.run(()=>m.transition$.complete()),g=Object.assign(m.context,g),dn.delete(l)}const w=i(l,u.animation,g)||fr;if(!u.animation||"none"===window.getComputedStyle(l).transitionProperty)return s.run(()=>w()),(0,lt.of)(void 0).pipe(function Ka(s){return l=>new He.y(i=>l.subscribe({next:w=>s.run(()=>i.next(w)),error:w=>s.run(()=>i.error(w)),complete:()=>s.run(()=>i.complete())}))}(s));const I=new ht.xQ,D=new ht.xQ,k=I.pipe(function Z(...s){return l=>(0,B.z)(l,(0,lt.of)(...s))}(!0));dn.set(l,{transition$:I,complete:()=>{D.next(),D.complete()},context:g});const P=function bt(s){const{transitionDelay:l,transitionDuration:i}=window.getComputedStyle(s);return 1e3*(parseFloat(l)+parseFloat(i))}(l);return s.runOutsideAngular(()=>{const q=(0,U.R)(l,"transitionend").pipe((0,ze.R)(k),(0,Be.h)(({target:z})=>z===l));(function te(...s){if(1===s.length){if(!(0,x.k)(s[0]))return s[0];s=s[0]}return(0,$e.n)(s,void 0).lift(new se)})((0,M.H)(P+vs).pipe((0,ze.R)(k)),q,D).pipe((0,ze.R)(k)).subscribe(()=>{dn.delete(l),s.run(()=>{w(),I.next(),I.complete()})})}),I.asObservable()};let ys=(()=>{class s{constructor(){this.animation=ms.animation}}return s.\u0275fac=function(i){return new(i||s)},s.\u0275prov=h.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})(),bs=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=h.oAB({type:s}),s.\u0275inj=h.cJS({imports:[[ne.ez]]}),s})(),Ri=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=h.oAB({type:s}),s.\u0275inj=h.cJS({imports:[[ne.ez]]}),s})(),Ts=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=h.oAB({type:s}),s.\u0275inj=h.cJS({}),s})(),Is=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=h.oAB({type:s}),s.\u0275inj=h.cJS({imports:[[ne.ez]]}),s})(),Ai=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=h.oAB({type:s}),s.\u0275inj=h.cJS({}),s})();var st=(()=>{return(s=st||(st={}))[s.Tab=9]="Tab",s[s.Enter=13]="Enter",s[s.Escape=27]="Escape",s[s.Space=32]="Space",s[s.PageUp=33]="PageUp",s[s.PageDown=34]="PageDown",s[s.End=35]="End",s[s.Home=36]="Home",s[s.ArrowLeft=37]="ArrowLeft",s[s.ArrowUp=38]="ArrowUp",s[s.ArrowRight=39]="ArrowRight",s[s.ArrowDown=40]="ArrowDown",st;var s})();"undefined"!=typeof navigator&&navigator.userAgent&&(/iPad|iPhone|iPod/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2||/Android/.test(navigator.userAgent));const Yo=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])","[contenteditable]",'[tabindex]:not([tabindex="-1"])'].join(", ");function zo(s){const l=Array.from(s.querySelectorAll(Yo)).filter(i=>-1!==i.tabIndex);return[l[0],l[l.length-1]]}new Date(1882,10,12),new Date(2174,10,25);let Rr=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=h.oAB({type:s}),s.\u0275inj=h.cJS({imports:[[ne.ez,Ks.u5]]}),s})(),Li=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=h.oAB({type:s}),s.\u0275inj=h.cJS({}),s})();class _n{constructor(l,i,u){this.nodes=l,this.viewRef=i,this.componentRef=u}}let Pt=(()=>{class s{constructor(i,u){this._el=i,this._zone=u}ngOnInit(){this._zone.onStable.asObservable().pipe((0,Ie.q)(1)).subscribe(()=>{rt(this._zone,this._el.nativeElement,(i,u)=>{u&&Sn(i),i.classList.add("show")},{animation:this.animation,runningTransition:"continue"})})}hide(){return rt(this._zone,this._el.nativeElement,({classList:i})=>i.remove("show"),{animation:this.animation,runningTransition:"stop"})}}return s.\u0275fac=function(i){return new(i||s)(h.Y36(h.SBq),h.Y36(h.R0b))},s.\u0275cmp=h.Xpm({type:s,selectors:[["ngb-modal-backdrop"]],hostAttrs:[2,"z-index","1055"],hostVars:6,hostBindings:function(i,u){2&i&&(h.Tol("modal-backdrop"+(u.backdropClass?" "+u.backdropClass:"")),h.ekj("show",!u.animation)("fade",u.animation))},inputs:{animation:"animation",backdropClass:"backdropClass"},decls:0,vars:0,template:function(i,u){},encapsulation:2}),s})();class Qn{close(l){}dismiss(l){}}class kr{constructor(l,i,u,g){this._windowCmptRef=l,this._contentRef=i,this._backdropCmptRef=u,this._beforeDismiss=g,this._closed=new ht.xQ,this._dismissed=new ht.xQ,this._hidden=new ht.xQ,l.instance.dismissEvent.subscribe(m=>{this.dismiss(m)}),this.result=new Promise((m,w)=>{this._resolve=m,this._reject=w}),this.result.then(null,()=>{})}get componentInstance(){if(this._contentRef&&this._contentRef.componentRef)return this._contentRef.componentRef.instance}get closed(){return this._closed.asObservable().pipe((0,ze.R)(this._hidden))}get dismissed(){return this._dismissed.asObservable().pipe((0,ze.R)(this._hidden))}get hidden(){return this._hidden.asObservable()}get shown(){return this._windowCmptRef.instance.shown.asObservable()}close(l){this._windowCmptRef&&(this._closed.next(l),this._resolve(l),this._removeModalElements())}_dismiss(l){this._dismissed.next(l),this._reject(l),this._removeModalElements()}dismiss(l){if(this._windowCmptRef)if(this._beforeDismiss){const i=this._beforeDismiss();!function hr(s){return s&&s.then}(i)?!1!==i&&this._dismiss(l):i.then(u=>{!1!==u&&this._dismiss(l)},()=>{})}else this._dismiss(l)}_removeModalElements(){const l=this._windowCmptRef.instance.hide(),i=this._backdropCmptRef?this._backdropCmptRef.instance.hide():(0,lt.of)(void 0);l.subscribe(()=>{const{nativeElement:u}=this._windowCmptRef.location;u.parentNode.removeChild(u),this._windowCmptRef.destroy(),this._contentRef&&this._contentRef.viewRef&&this._contentRef.viewRef.destroy(),this._windowCmptRef=null,this._contentRef=null}),i.subscribe(()=>{if(this._backdropCmptRef){const{nativeElement:u}=this._backdropCmptRef.location;u.parentNode.removeChild(u),this._backdropCmptRef.destroy(),this._backdropCmptRef=null}}),Ee(l,i).subscribe(()=>{this._hidden.next(),this._hidden.complete()})}}var Or=(()=>{return(s=Or||(Or={}))[s.BACKDROP_CLICK=0]="BACKDROP_CLICK",s[s.ESC=1]="ESC",Or;var s})();let Mr=(()=>{class s{constructor(i,u,g){this._document=i,this._elRef=u,this._zone=g,this._closed$=new ht.xQ,this._elWithFocus=null,this.backdrop=!0,this.keyboard=!0,this.dismissEvent=new h.vpe,this.shown=new ht.xQ,this.hidden=new ht.xQ}dismiss(i){this.dismissEvent.emit(i)}ngOnInit(){this._elWithFocus=this._document.activeElement,this._zone.onStable.asObservable().pipe((0,Ie.q)(1)).subscribe(()=>{this._show()})}ngOnDestroy(){this._disableEventHandling()}hide(){const{nativeElement:i}=this._elRef,u={animation:this.animation,runningTransition:"stop"},w=Ee(rt(this._zone,i,()=>i.classList.remove("show"),u),rt(this._zone,this._dialogEl.nativeElement,()=>{},u));return w.subscribe(()=>{this.hidden.next(),this.hidden.complete()}),this._disableEventHandling(),this._restoreFocus(),w}_show(){const i={animation:this.animation,runningTransition:"continue"};Ee(rt(this._zone,this._elRef.nativeElement,(m,w)=>{w&&Sn(m),m.classList.add("show")},i),rt(this._zone,this._dialogEl.nativeElement,()=>{},i)).subscribe(()=>{this.shown.next(),this.shown.complete()}),this._enableEventHandling(),this._setFocus()}_enableEventHandling(){const{nativeElement:i}=this._elRef;this._zone.runOutsideAngular(()=>{(0,U.R)(i,"keydown").pipe((0,ze.R)(this._closed$),(0,Be.h)(g=>g.which===st.Escape)).subscribe(g=>{this.keyboard?requestAnimationFrame(()=>{g.defaultPrevented||this._zone.run(()=>this.dismiss(Or.ESC))}):"static"===this.backdrop&&this._bumpBackdrop()});let u=!1;(0,U.R)(this._dialogEl.nativeElement,"mousedown").pipe((0,ze.R)(this._closed$),(0,Wi.b)(()=>u=!1),(0,nn.w)(()=>(0,U.R)(i,"mouseup").pipe((0,ze.R)(this._closed$),(0,Ie.q)(1))),(0,Be.h)(({target:g})=>i===g)).subscribe(()=>{u=!0}),(0,U.R)(i,"click").pipe((0,ze.R)(this._closed$)).subscribe(({target:g})=>{i===g&&("static"===this.backdrop?this._bumpBackdrop():!0===this.backdrop&&!u&&this._zone.run(()=>this.dismiss(Or.BACKDROP_CLICK))),u=!1})})}_disableEventHandling(){this._closed$.next()}_setFocus(){const{nativeElement:i}=this._elRef;if(!i.contains(document.activeElement)){const u=i.querySelector("[ngbAutofocus]"),g=zo(i)[0];(u||g||i).focus()}}_restoreFocus(){const i=this._document.body,u=this._elWithFocus;let g;g=u&&u.focus&&i.contains(u)?u:i,this._zone.runOutsideAngular(()=>{setTimeout(()=>g.focus()),this._elWithFocus=null})}_bumpBackdrop(){"static"===this.backdrop&&rt(this._zone,this._elRef.nativeElement,({classList:i})=>(i.add("modal-static"),()=>i.remove("modal-static")),{animation:this.animation,runningTransition:"continue"})}}return s.\u0275fac=function(i){return new(i||s)(h.Y36(ne.K0),h.Y36(h.SBq),h.Y36(h.R0b))},s.\u0275cmp=h.Xpm({type:s,selectors:[["ngb-modal-window"]],viewQuery:function(i,u){if(1&i&&h.Gf(In,7),2&i){let g;h.iGM(g=h.CRH())&&(u._dialogEl=g.first)}},hostAttrs:["role","dialog","tabindex","-1"],hostVars:7,hostBindings:function(i,u){2&i&&(h.uIk("aria-modal",!0)("aria-labelledby",u.ariaLabelledBy)("aria-describedby",u.ariaDescribedBy),h.Tol("modal d-block"+(u.windowClass?" "+u.windowClass:"")),h.ekj("fade",u.animation))},inputs:{animation:"animation",ariaLabelledBy:"ariaLabelledBy",ariaDescribedBy:"ariaDescribedBy",backdrop:"backdrop",centered:"centered",keyboard:"keyboard",scrollable:"scrollable",size:"size",windowClass:"windowClass",modalDialogClass:"modalDialogClass"},outputs:{dismissEvent:"dismiss"},ngContentSelectors:os,decls:4,vars:2,consts:[["role","document"],["dialog",""],[1,"modal-content"]],template:function(i,u){1&i&&(h.F$t(),h.TgZ(0,"div",0,1)(2,"div",2),h.Hsn(3),h.qZA()()),2&i&&h.Tol("modal-dialog"+(u.size?" modal-"+u.size:"")+(u.centered?" modal-dialog-centered":"")+(u.scrollable?" modal-dialog-scrollable":"")+(u.modalDialogClass?" "+u.modalDialogClass:""))},styles:["ngb-modal-window .component-host-scrollable{display:flex;flex-direction:column;overflow:hidden}\n"],encapsulation:2}),s})(),ua=(()=>{class s{constructor(i){this._document=i}hide(){const i=Math.abs(window.innerWidth-this._document.documentElement.clientWidth),u=this._document.body,g=u.style,{overflow:m,paddingRight:w}=g;if(i>0){const I=parseFloat(window.getComputedStyle(u).paddingRight);g.paddingRight=`${I+i}px`}return g.overflow="hidden",()=>{i>0&&(g.paddingRight=w),g.overflow=m}}}return s.\u0275fac=function(i){return new(i||s)(h.LFG(ne.K0))},s.\u0275prov=h.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})(),Ic=(()=>{class s{constructor(i,u,g,m,w,I){this._applicationRef=i,this._injector=u,this._document=g,this._scrollBar=m,this._rendererFactory=w,this._ngZone=I,this._activeWindowCmptHasChanged=new ht.xQ,this._ariaHiddenValues=new Map,this._backdropAttributes=["animation","backdropClass"],this._modalRefs=[],this._windowAttributes=["animation","ariaLabelledBy","ariaDescribedBy","backdrop","centered","keyboard","scrollable","size","windowClass","modalDialogClass"],this._windowCmpts=[],this._activeInstances=new h.vpe,this._activeWindowCmptHasChanged.subscribe(()=>{if(this._windowCmpts.length){const D=this._windowCmpts[this._windowCmpts.length-1];((s,l,i,u=!1)=>{this._ngZone.runOutsideAngular(()=>{const g=(0,U.R)(l,"focusin").pipe((0,ze.R)(i),(0,Nn.U)(m=>m.target));(0,U.R)(l,"keydown").pipe((0,ze.R)(i),(0,Be.h)(m=>m.which===st.Tab),(0,jr.M)(g)).subscribe(([m,w])=>{const[I,D]=zo(l);(w===I||w===l)&&m.shiftKey&&(D.focus(),m.preventDefault()),w===D&&!m.shiftKey&&(I.focus(),m.preventDefault())}),u&&(0,U.R)(l,"click").pipe((0,ze.R)(i),(0,jr.M)(g),(0,Nn.U)(m=>m[1])).subscribe(m=>m.focus())})})(0,D.location.nativeElement,this._activeWindowCmptHasChanged),this._revertAriaHidden(),this._setAriaHidden(D.location.nativeElement)}})}open(i,u,g,m){const w=m.container instanceof HTMLElement?m.container:Vt(m.container)?this._document.querySelector(m.container):this._document.body,I=this._rendererFactory.createRenderer(null,null),D=this._scrollBar.hide(),k=()=>{this._modalRefs.length||(I.removeClass(this._document.body,"modal-open"),this._revertAriaHidden())};if(!w)throw new Error(`The specified modal container "${m.container||"body"}" was not found in the DOM.`);const P=new Qn,q=this._getContentRef(i,m.injector||u,g,P,m);let $=!1!==m.backdrop?this._attachBackdrop(i,w):void 0,z=this._attachWindowComponent(i,w,q),ce=new kr(z,q,$,m.beforeDismiss);return this._registerModalRef(ce),this._registerWindowCmpt(z),ce.result.then(D,D),ce.result.then(k,k),P.close=X=>{ce.close(X)},P.dismiss=X=>{ce.dismiss(X)},this._applyWindowOptions(z.instance,m),1===this._modalRefs.length&&I.addClass(this._document.body,"modal-open"),$&&$.instance&&(this._applyBackdropOptions($.instance,m),$.changeDetectorRef.detectChanges()),z.changeDetectorRef.detectChanges(),ce}get activeInstances(){return this._activeInstances}dismissAll(i){this._modalRefs.forEach(u=>u.dismiss(i))}hasOpenModals(){return this._modalRefs.length>0}_attachBackdrop(i,u){let m=i.resolveComponentFactory(Pt).create(this._injector);return this._applicationRef.attachView(m.hostView),u.appendChild(m.location.nativeElement),m}_attachWindowComponent(i,u,g){let w=i.resolveComponentFactory(Mr).create(this._injector,g.nodes);return this._applicationRef.attachView(w.hostView),u.appendChild(w.location.nativeElement),w}_applyWindowOptions(i,u){this._windowAttributes.forEach(g=>{Vt(u[g])&&(i[g]=u[g])})}_applyBackdropOptions(i,u){this._backdropAttributes.forEach(g=>{Vt(u[g])&&(i[g]=u[g])})}_getContentRef(i,u,g,m,w){return g?g instanceof h.Rgc?this._createFromTemplateRef(g,m):function We(s){return"string"==typeof s}(g)?this._createFromString(g):this._createFromComponent(i,u,g,m,w):new _n([])}_createFromTemplateRef(i,u){const m=i.createEmbeddedView({$implicit:u,close(w){u.close(w)},dismiss(w){u.dismiss(w)}});return this._applicationRef.attachView(m),new _n([m.rootNodes],m)}_createFromString(i){const u=this._document.createTextNode(`${i}`);return new _n([[u]])}_createFromComponent(i,u,g,m,w){const I=i.resolveComponentFactory(g),D=h.zs3.create({providers:[{provide:Qn,useValue:m}],parent:u}),k=I.create(D),P=k.location.nativeElement;return w.scrollable&&P.classList.add("component-host-scrollable"),this._applicationRef.attachView(k.hostView),new _n([[P]],k.hostView,k)}_setAriaHidden(i){const u=i.parentElement;u&&i!==this._document.body&&(Array.from(u.children).forEach(g=>{g!==i&&"SCRIPT"!==g.nodeName&&(this._ariaHiddenValues.set(g,g.getAttribute("aria-hidden")),g.setAttribute("aria-hidden","true"))}),this._setAriaHidden(u))}_revertAriaHidden(){this._ariaHiddenValues.forEach((i,u)=>{i?u.setAttribute("aria-hidden",i):u.removeAttribute("aria-hidden")}),this._ariaHiddenValues.clear()}_registerModalRef(i){const u=()=>{const g=this._modalRefs.indexOf(i);g>-1&&(this._modalRefs.splice(g,1),this._activeInstances.emit(this._modalRefs))};this._modalRefs.push(i),this._activeInstances.emit(this._modalRefs),i.result.then(u,u)}_registerWindowCmpt(i){this._windowCmpts.push(i),this._activeWindowCmptHasChanged.next(),i.onDestroy(()=>{const u=this._windowCmpts.indexOf(i);u>-1&&(this._windowCmpts.splice(u,1),this._activeWindowCmptHasChanged.next())})}}return s.\u0275fac=function(i){return new(i||s)(h.LFG(h.z2F),h.LFG(h.zs3),h.LFG(ne.K0),h.LFG(ua),h.LFG(h.FYo),h.LFG(h.R0b))},s.\u0275prov=h.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})(),wl=(()=>{class s{constructor(i){this._ngbConfig=i,this.backdrop=!0,this.keyboard=!0}get animation(){return void 0===this._animation?this._ngbConfig.animation:this._animation}set animation(i){this._animation=i}}return s.\u0275fac=function(i){return new(i||s)(h.LFG(ys))},s.\u0275prov=h.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})(),da=(()=>{class s{constructor(i,u,g,m){this._moduleCFR=i,this._injector=u,this._modalStack=g,this._config=m}open(i,u={}){const g=Object.assign(Object.assign(Object.assign({},this._config),{animation:this._config.animation}),u);return this._modalStack.open(this._moduleCFR,this._injector,i,g)}get activeInstances(){return this._modalStack.activeInstances}dismissAll(i){this._modalStack.dismissAll(i)}hasOpenModals(){return this._modalStack.hasOpenModals()}}return s.\u0275fac=function(i){return new(i||s)(h.LFG(h._Vd),h.LFG(h.zs3),h.LFG(Ic),h.LFG(wl))},s.\u0275prov=h.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})(),mn=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=h.oAB({type:s}),s.\u0275inj=h.cJS({providers:[da]}),s})(),_a=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=h.oAB({type:s}),s.\u0275inj=h.cJS({imports:[[ne.ez]]}),s})(),v=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=h.oAB({type:s}),s.\u0275inj=h.cJS({imports:[[ne.ez]]}),s})(),Sl=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=h.oAB({type:s}),s.\u0275inj=h.cJS({imports:[[ne.ez]]}),s})(),Fr=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=h.oAB({type:s}),s.\u0275inj=h.cJS({imports:[[ne.ez]]}),s})(),va=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=h.oAB({type:s}),s.\u0275inj=h.cJS({imports:[[ne.ez]]}),s})(),vn=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=h.oAB({type:s}),s.\u0275inj=h.cJS({imports:[[ne.ez]]}),s})(),uu=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=h.oAB({type:s}),s.\u0275inj=h.cJS({imports:[[ne.ez]]}),s})(),du=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=h.oAB({type:s}),s.\u0275inj=h.cJS({}),s})();new h.OlP("live announcer delay",{providedIn:"root",factory:function ku(){return 100}});let hu=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=h.oAB({type:s}),s.\u0275inj=h.cJS({imports:[[ne.ez]]}),s})();const Ou=[bs,Ri,Ts,Is,Ai,Rr,Li,mn,_a,v,Sl,Fr,va,vn,uu,du,hu];let Pn=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=h.oAB({type:s}),s.\u0275inj=h.cJS({imports:[Ou,bs,Ri,Ts,Is,Ai,Rr,Li,mn,_a,v,Sl,Fr,va,vn,uu,du,hu]}),s})()}}]);