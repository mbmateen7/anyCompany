"use strict";(self.webpackChunkhumphree=self.webpackChunkhumphree||[]).push([[890],{6890:(_t,T,s)=>{s.r(T),s.d(T,{HistoryModule:()=>lt});var _=s(9808),m=s(7587),P=s(2212),b=s(88),t=s(5e3),d=s(2340),u=s(4312),A=s(520);let w=(()=>{class n{constructor(o){this.http=o}listing(o={}){return this.http.post(`${d.N.apiUrl+u.j.historyListing}`,o)}reorder(o={}){return this.http.post(`${d.N.apiUrl+u.j.historyReorder}`,o)}downloadHistory(o={}){return this.http.post(`${d.N.apiUrl+u.j.historyDownload}`,o)}}return n.\u0275fac=function(o){return new(o||n)(t.LFG(A.eN))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var U=s(9644),J=s(9634),N=s(629),v=s(6783),p=s(4182),h=s(7051),D=s(8601);function k(n,i){if(1&n){const o=t.EpF();t.TgZ(0,"i-feather",40),t.NdJ("click",function(){return t.CHM(o),t.oxw().startDate=null}),t.qZA()}}function x(n,i){if(1&n){const o=t.EpF();t.TgZ(0,"i-feather",40),t.NdJ("click",function(){return t.CHM(o),t.oxw().endDate=null}),t.qZA()}}function Y(n,i){1&n&&t._UZ(0,"i",41)}function I(n,i){1&n&&t._UZ(0,"i",42)}function q(n,i){1&n&&t._UZ(0,"i",41)}function S(n,i){1&n&&t._UZ(0,"i",42)}function M(n,i){1&n&&t._UZ(0,"i",41)}function Q(n,i){1&n&&t._UZ(0,"i",42)}function j(n,i){1&n&&t._UZ(0,"i",41)}function F(n,i){1&n&&t._UZ(0,"i",42)}function O(n,i){1&n&&t._UZ(0,"i",41)}function E(n,i){1&n&&t._UZ(0,"i",42)}function L(n,i){1&n&&t._UZ(0,"i",41)}function z(n,i){1&n&&t._UZ(0,"i",42)}function V(n,i){1&n&&t._UZ(0,"i",41)}function $(n,i){1&n&&t._UZ(0,"i",42)}function B(n,i){1&n&&t._UZ(0,"i",41)}function R(n,i){1&n&&t._UZ(0,"i",42)}function X(n,i){1&n&&t._UZ(0,"i",41)}function W(n,i){1&n&&t._UZ(0,"i",42)}function G(n,i){1&n&&(t.TgZ(0,"p",34),t._UZ(1,"i-feather",52),t.qZA())}function K(n,i){1&n&&(t.TgZ(0,"p",34),t._uU(1,"-"),t.qZA())}function tt(n,i){if(1&n){const o=t.EpF();t.TgZ(0,"a",50),t.NdJ("click",function(){t.CHM(o);const a=t.oxw(),r=a.$implicit,c=a.index;return t.oxw().addJobNote(r.id,c)}),t._UZ(1,"i-feather",53),t.qZA()}}function et(n,i){if(1&n){const o=t.EpF();t.TgZ(0,"a",54),t.NdJ("click",function(){t.CHM(o);const a=t.oxw(),r=a.$implicit,c=a.index;return t.oxw().addJobNote(r.id,c)}),t._uU(1," View "),t.qZA()}}function nt(n,i){if(1&n){const o=t.EpF();t.TgZ(0,"div",55)(1,"div",56)(2,"a",57),t.NdJ("click",function(){t.CHM(o);const a=t.oxw(),r=a.$implicit,c=a.index;return t.oxw().addJobNote(r.id,c)}),t._uU(3," Add Note "),t._UZ(4,"i-feather",58),t.qZA()(),t._UZ(5,"div",59),t.TgZ(6,"div",60),t._uU(7),t.ALo(8,"date"),t.qZA()()}if(2&n){const o=t.oxw().$implicit;t.xp6(5),t.Q6J("innerHtml",o.latest_job_note.description,t.oJD),t.xp6(2),t.hij(" ",t.xi3(8,2,o.latest_job_note.created_at,"h:mm a | dd LLLL, yyyy")," ")}}function ot(n,i){if(1&n){const o=t.EpF();t.TgZ(0,"a",50),t.NdJ("click",function(){t.CHM(o);const a=t.oxw(),r=a.$implicit,c=a.index;return t.oxw().reorder(r,c)}),t._UZ(1,"i-feather",61),t.qZA()}}function at(n,i){if(1&n){const o=t.EpF();t.TgZ(0,"tr",43)(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td")(4,"p",34),t._uU(5),t.qZA()(),t.TgZ(6,"td")(7,"p",34),t._uU(8),t.qZA()(),t.TgZ(9,"td")(10,"p",34),t._uU(11),t.qZA()(),t.TgZ(12,"td")(13,"p",34),t._uU(14),t.qZA()(),t.TgZ(15,"td")(16,"p",34),t._uU(17),t.qZA()(),t.TgZ(18,"td"),t.YNc(19,G,2,0,"p",44),t.YNc(20,K,2,0,"p",44),t.qZA(),t.TgZ(21,"td")(22,"p",34),t._uU(23),t.qZA()(),t.TgZ(24,"td")(25,"p",34),t._uU(26),t.qZA()(),t.TgZ(27,"td")(28,"p",34),t._uU(29),t.qZA()(),t.TgZ(30,"td")(31,"p",34),t._uU(32),t.qZA()(),t.TgZ(33,"td")(34,"div",45),t.YNc(35,tt,2,0,"a",46),t.YNc(36,et,2,0,"a",47),t.YNc(37,nt,9,5,"div",48),t.qZA()(),t.TgZ(38,"td")(39,"div",49),t.YNc(40,ot,2,0,"a",46),t.TgZ(41,"a",50),t.NdJ("click",function(){const a=t.CHM(o),r=a.$implicit,c=a.index;return t.oxw().viewTimeline(r,c)}),t._UZ(42,"img",51),t.qZA()()()()}if(2&n){const o=i.$implicit,e=t.oxw();let a,r,c,l,f,g,Z,C,y;t.xp6(2),t.Oqu(o.work_number),t.xp6(3),t.Oqu(null!==(a=o.location)&&void 0!==a?a:"-"),t.xp6(3),t.Oqu(null!==(r=o.customer.name)&&void 0!==r?r:"-"),t.xp6(3),t.Oqu(null!==(c=o.contract)&&void 0!==c?c:"-"),t.xp6(3),t.Oqu(null!==(l=o.product.name)&&void 0!==l?l:"-"),t.xp6(3),t.Oqu(null!==(f=o.status)&&void 0!==f?f:"-"),t.xp6(2),t.Q6J("ngIf",o.fsc),t.xp6(1),t.Q6J("ngIf",!o.fsc),t.xp6(3),t.Oqu(null!==(g=o.delivery)&&void 0!==g?g:"-"),t.xp6(3),t.Oqu(null!==(Z=o.order_number)&&void 0!==Z?Z:"-"),t.xp6(3),t.Oqu(null!==(C=o.invoice_no)&&void 0!==C?C:"-"),t.xp6(3),t.Oqu(null!==(y=o.schedule_ref)&&void 0!==y?y:"-"),t.xp6(3),t.Q6J("ngIf","0"==o.job_notes_count),t.xp6(1),t.Q6J("ngIf","0"!=o.job_notes_count),t.xp6(1),t.Q6J("ngIf","0"!=o.job_notes_count&&o.latest_job_note.description),t.xp6(3),t.Q6J("ngIf",e._auth.checkPermissions("history","write"))}}const H=function(){return{isAnimated:!0,dateInputFormat:"DD-MMM-YYYY",containerClass:"theme-red",selectFromOtherMonth:!0}},it=[{path:"",component:(()=>{class n{constructor(o,e,a,r,c,l){this._history=o,this.datePipe=e,this._modal=a,this.router=r,this.helper=c,this._auth=l,this.histories=[],this.searchParams={search:"",start_date:"",end_date:"",page_size:10,page:1,sort_column:"work_number",sort_value:"DESC"},this.pageFrom=1,this.pageTo=10,this.totalCount=10,this.modalConfig={animated:!0,keyboard:!1,backdrop:!1,ignoreBackdropClick:!0,windowClass:"modal-roles"},this.dateToday=new Date}ngOnInit(){this.getHistoryListing()}getHistoryListing(){this._history.listing(this.searchParams).subscribe(o=>{this.histories=o.data.data,this.searchParams.page_size=o.data.per_page,this.searchParams.page=o.data.current_page,this.totalPages=o.data.last_page,this.pageFrom=o.data.from,this.pageTo=o.data.to,this.totalCount=o.data.total})}searchOrder(o){this.searchParams.page=1,"search"==o&&(0==this.searchParams.search.length||this.searchParams.search.length>=3)&&this.getHistoryListing(),setTimeout(()=>{"date"==o&&(this.startDate&&this.endDate||!this.startDate&&!this.endDate)&&(this.searchParams.start_date=this.startDate?this.datePipe.transform(this.startDate,"YYYY-MM-dd"):null,this.searchParams.end_date=this.endDate?this.datePipe.transform(this.endDate,"YYYY-MM-dd"):null,this.getHistoryListing())},50)}addJobNote(o,e){this.modalConfig.windowClass="modal-roles job-notes-modal";const a=this._modal.open(P._,this.modalConfig);a.componentInstance.orderId=o,a.componentInstance.response.subscribe(r=>{r.success&&!r.close&&(this.histories[e]=r.data),r.close&&(this.getHistoryListing(),a.dismiss(),this.modalConfig.windowClass="modal-roles")})}viewTimeline(o,e){this.modalConfig.windowClass="modal-roles timeline";const a=this._modal.open(b.z,this.modalConfig);a.componentInstance.rod=o,a.componentInstance.response.subscribe(r=>{r.success&&this.router.navigate(["rod/delivery-notes",o.id]),r.data&&(this.histories[e]=r.data),a.dismiss(),this.modalConfig.windowClass="modal-roles"})}changePage(o){this.searchParams.page=o,this.getHistoryListing()}ChangePageSize(o){this.searchParams.page=1,this.searchParams.page_size=o,this.getHistoryListing()}reorder(o,e){this._history.reorder({id:o.id}).subscribe(a=>{this.histories.splice(e,1),this.helper.toastSuccess(a.message)})}downloadData(o){this.searchParams.type=o,this._history.downloadHistory(this.searchParams).subscribe(e=>{window.open(e.data.link)})}sortData(o){this.searchParams.sort_column=o,this.searchParams.sort_value="ASC"==this.searchParams.sort_value?"DESC":"ASC",this.getHistoryListing()}}return n.\u0275fac=function(o){return new(o||n)(t.Y36(w),t.Y36(_.uU),t.Y36(U.FF),t.Y36(m.F0),t.Y36(J.B),t.Y36(N.e))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-history"]],decls:107,vars:40,consts:[[1,"dashboard-main"],[1,"dashboard-content"],[1,"d-flex","align-items-center","mb-16","justify-content-between"],[1,"breadcrumb"],[1,"breadcrumb-item"],["href","javascript:void(0)",1,"breadcrumb-link"],["href","javascript:void(0)",1,"breadcrumb-link","active"],[1,"d-flex"],[1,"dropdown"],["type","button","id","dropdownMenuButton","data-toggle","dropdown","aria-haspopup","true","aria-expanded","false",1,"credit-check","dropdown-toggle"],["name","download",1,"download"],["aria-labelledby","dropdownMenuButton",1,"dropdown-menu","dropdown-menu-right"],[1,"dropdown-item","cursor-pointer",3,"click"],[1,"roles-main","delivery-list-table"],[1,"d-flex","align-items-center","justify-content-between","delivery-list-main","mb-2"],[1,"d-flex","for-media-setts"],[1,"form-group","sear-bar-roles","position-relative","mb-0"],["type","search","placeholder","Search..","id","email",1,"form-control","form-control-roles",3,"ngModel","input","ngModelChange"],["name","search",1,"search-ctm"],[1,"search-inputs","d-flex"],[1,"search-inputs","mr-10"],[1,"input-style"],[1,"type-pass"],["type","text","id","start_date","placeholder","From","name","start_date","bsDatepicker","",1,"ctm-input",3,"bsValue","bsConfig","maxDate","bsValueChange"],[1,"icon-eye","d-flex","align-items-center","justify-content-center"],["name","calendar",1,"calender"],["name","X","class","clear-filter",3,"click",4,"ngIf"],[1,"search-inputs"],["type","text","id","end_date","placeholder","To","name","end_date","bsDatepicker","",1,"ctm-input",3,"bsValue","bsConfig","minDate","bsValueChange"],[1,"tab-table"],[1,"tables-roles-main","tables-users-main"],[1,"table"],[1,"thead-ctm"],[1,"cursor-pointer",3,"click"],[1,"inner-cell"],["class","fa fa-arrow-down sorting-arrow","aria-hidden","true",4,"ngIf"],["class","fa fa-arrow-up sorting-arrow","aria-hidden","true",4,"ngIf"],[1,"t-body-ctm"],["class","active-row",4,"ngFor","ngForOf"],[3,"from","to","pageSize","currentPage","totalPages","total","changePage","ChangePageSize"],["name","X",1,"clear-filter",3,"click"],["aria-hidden","true",1,"fa","fa-arrow-down","sorting-arrow"],["aria-hidden","true",1,"fa","fa-arrow-up","sorting-arrow"],[1,"active-row"],["class","inner-cell",4,"ngIf"],[1,"inner-cell","view-anchor-tooltip"],["class","icon-anchor-list","href","javascript:void(0)",3,"click",4,"ngIf"],["class","view-anchor red","href","javascript:void(0)",3,"click",4,"ngIf"],["class","tooltiptext-view",4,"ngIf"],[1,"list-icons-talbe","d-flex","justify-content-center","align-items-center"],["href","javascript:void(0)",1,"icon-anchor-list",3,"click"],["src","assets/img/line-img-gray.svg","alt","img"],["name","check"],["name","plus",1,"icon-width"],["href","javascript:void(0)",1,"view-anchor","red",3,"click"],[1,"tooltiptext-view"],[1,"d-flex","align-items-center","justify-content-end"],["href","javascript:void(0)",1,"tooltip-anchor-modal",3,"click"],["name","plus",1,"icon-width","w15"],[1,"toop-hight",3,"innerHtml"],[1,"date-tooptip-iner"],["name","corner-up-left",1,"icon-width"]],template:function(o,e){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"ul",3)(4,"li",4)(5,"a",5),t._uU(6,"HISTORY"),t.qZA()(),t.TgZ(7,"li",4)(8,"a",6),t._uU(9),t.ALo(10,"date"),t.qZA()()(),t.TgZ(11,"div",7)(12,"div",8)(13,"button",9),t._UZ(14,"i-feather",10),t._uU(15," Download Data "),t.qZA(),t.TgZ(16,"div",11)(17,"a",12),t.NdJ("click",function(){return e.downloadData("displayed")}),t._uU(18,"Displayed"),t.qZA(),t.TgZ(19,"a",12),t.NdJ("click",function(){return e.downloadData("all")}),t._uU(20,"All"),t.qZA()()()()(),t.TgZ(21,"div",13)(22,"div",14)(23,"div",15)(24,"div",16)(25,"input",17),t.NdJ("input",function(){return e.searchOrder("search")})("ngModelChange",function(r){return e.searchParams.search=r}),t.qZA(),t._UZ(26,"i-feather",18),t.qZA(),t.TgZ(27,"div",19)(28,"div",20)(29,"div",21)(30,"div",22)(31,"input",23),t.NdJ("bsValueChange",function(){return e.searchOrder("date")})("bsValueChange",function(r){return e.startDate=r}),t.qZA(),t.TgZ(32,"div",24),t._UZ(33,"i-feather",25),t.qZA(),t.YNc(34,k,1,0,"i-feather",26),t.qZA()()(),t.TgZ(35,"div",27)(36,"div",21)(37,"div",22)(38,"input",28),t.NdJ("bsValueChange",function(){return e.searchOrder("date")})("bsValueChange",function(r){return e.endDate=r}),t.qZA(),t.TgZ(39,"div",24),t._UZ(40,"i-feather",25),t.qZA(),t.YNc(41,x,1,0,"i-feather",26),t.qZA()()()()()(),t.TgZ(42,"div",29)(43,"div",30)(44,"table",31)(45,"thead",32)(46,"tr")(47,"th",33),t.NdJ("click",function(){return e.sortData("work_number")}),t.TgZ(48,"p",34),t._uU(49,"Work# "),t.YNc(50,Y,1,0,"i",35),t.YNc(51,I,1,0,"i",36),t.qZA()(),t.TgZ(52,"th",33),t.NdJ("click",function(){return e.sortData("location")}),t.TgZ(53,"p",34),t._uU(54,"Location "),t.YNc(55,q,1,0,"i",35),t.YNc(56,S,1,0,"i",36),t.qZA()(),t.TgZ(57,"th",33),t.NdJ("click",function(){return e.sortData("customers.name")}),t.TgZ(58,"p",34),t._uU(59,"Customer "),t.YNc(60,M,1,0,"i",35),t.YNc(61,Q,1,0,"i",36),t.qZA()(),t.TgZ(62,"th",33),t.NdJ("click",function(){return e.sortData("contract")}),t.TgZ(63,"p",34),t._uU(64,"Contract "),t.YNc(65,j,1,0,"i",35),t.YNc(66,F,1,0,"i",36),t.qZA()(),t.TgZ(67,"th",33),t.NdJ("click",function(){return e.sortData("products.name")}),t.TgZ(68,"p",34),t._uU(69,"Product "),t.YNc(70,O,1,0,"i",35),t.YNc(71,E,1,0,"i",36),t.qZA()(),t.TgZ(72,"th")(73,"p",34),t._uU(74,"Status"),t.qZA()(),t.TgZ(75,"th",33),t.NdJ("click",function(){return e.sortData("fsc")}),t.TgZ(76,"p",34),t._uU(77,"FSC "),t.YNc(78,L,1,0,"i",35),t.YNc(79,z,1,0,"i",36),t.qZA()(),t.TgZ(80,"th",33),t.NdJ("click",function(){return e.sortData("delivery")}),t.TgZ(81,"p",34),t._uU(82,"Delivery Date "),t.YNc(83,V,1,0,"i",35),t.YNc(84,$,1,0,"i",36),t.qZA()(),t.TgZ(85,"th",33),t.NdJ("click",function(){return e.sortData("order_number")}),t.TgZ(86,"p",34),t._uU(87,"Order# "),t.YNc(88,B,1,0,"i",35),t.YNc(89,R,1,0,"i",36),t.qZA()(),t.TgZ(90,"th",33),t.NdJ("click",function(){return e.sortData("invoice_no")}),t.TgZ(91,"p",34),t._uU(92,"Invoice# "),t.YNc(93,X,1,0,"i",35),t.YNc(94,W,1,0,"i",36),t.qZA()(),t.TgZ(95,"th")(96,"p",34),t._uU(97,"Schedule Ref"),t.qZA()(),t.TgZ(98,"th")(99,"p",34),t._uU(100,"Job Notes"),t.qZA()(),t.TgZ(101,"th")(102,"p",34),t._uU(103,"Actions"),t.qZA()()()(),t.TgZ(104,"tbody",37),t.YNc(105,at,43,16,"tr",38),t.qZA()()(),t.TgZ(106,"app-pagination",39),t.NdJ("changePage",function(r){return e.changePage(r)})("ChangePageSize",function(r){return e.ChangePageSize(r)}),t.qZA()()()()()),2&o&&(t.xp6(9),t.hij("Week ",t.xi3(10,35,e.dateToday,"ww"),""),t.xp6(16),t.Q6J("ngModel",e.searchParams.search),t.xp6(6),t.Q6J("bsValue",e.startDate)("bsConfig",t.DdM(38,H))("maxDate",e.endDate),t.xp6(3),t.Q6J("ngIf",e.startDate),t.xp6(4),t.Q6J("bsValue",e.endDate)("bsConfig",t.DdM(39,H))("minDate",e.startDate),t.xp6(3),t.Q6J("ngIf",e.endDate),t.xp6(9),t.Q6J("ngIf","work_number"==e.searchParams.sort_column&&"DESC"==e.searchParams.sort_value),t.xp6(1),t.Q6J("ngIf","work_number"==e.searchParams.sort_column&&"ASC"==e.searchParams.sort_value),t.xp6(4),t.Q6J("ngIf","location"==e.searchParams.sort_column&&"DESC"==e.searchParams.sort_value),t.xp6(1),t.Q6J("ngIf","location"==e.searchParams.sort_column&&"ASC"==e.searchParams.sort_value),t.xp6(4),t.Q6J("ngIf","customers.name"==e.searchParams.sort_column&&"DESC"==e.searchParams.sort_value),t.xp6(1),t.Q6J("ngIf","customers.name"==e.searchParams.sort_column&&"ASC"==e.searchParams.sort_value),t.xp6(4),t.Q6J("ngIf","contract"==e.searchParams.sort_column&&"DESC"==e.searchParams.sort_value),t.xp6(1),t.Q6J("ngIf","contract"==e.searchParams.sort_column&&"ASC"==e.searchParams.sort_value),t.xp6(4),t.Q6J("ngIf","products.name"==e.searchParams.sort_column&&"DESC"==e.searchParams.sort_value),t.xp6(1),t.Q6J("ngIf","products.name"==e.searchParams.sort_column&&"ASC"==e.searchParams.sort_value),t.xp6(7),t.Q6J("ngIf","fsc"==e.searchParams.sort_column&&"DESC"==e.searchParams.sort_value),t.xp6(1),t.Q6J("ngIf","fsc"==e.searchParams.sort_column&&"ASC"==e.searchParams.sort_value),t.xp6(4),t.Q6J("ngIf","delivery"==e.searchParams.sort_column&&"DESC"==e.searchParams.sort_value),t.xp6(1),t.Q6J("ngIf","delivery"==e.searchParams.sort_column&&"ASC"==e.searchParams.sort_value),t.xp6(4),t.Q6J("ngIf","order_number"==e.searchParams.sort_column&&"DESC"==e.searchParams.sort_value),t.xp6(1),t.Q6J("ngIf","order_number"==e.searchParams.sort_column&&"ASC"==e.searchParams.sort_value),t.xp6(4),t.Q6J("ngIf","invoice_no"==e.searchParams.sort_column&&"DESC"==e.searchParams.sort_value),t.xp6(1),t.Q6J("ngIf","invoice_no"==e.searchParams.sort_column&&"ASC"==e.searchParams.sort_value),t.xp6(11),t.Q6J("ngForOf",e.histories),t.xp6(1),t.Q6J("from",e.pageFrom)("to",e.pageTo)("pageSize",e.searchParams.page_size)("currentPage",e.searchParams.page)("totalPages",e.totalPages)("total",e.totalCount))},directives:[v.u,p.Fj,p.JJ,p.On,h.Y5,h.Np,_.O5,_.sg,D.Q],pipes:[_.uU],styles:[""]}),n})()}];let rt=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[m.Bz.forChild(it)],m.Bz]}),n})();var st=s(5530),ct=s(9618);let lt=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[_.ez,p.u5,ct.m,rt,v.p.pick(st.kEt),h.kn]]}),n})()}}]);